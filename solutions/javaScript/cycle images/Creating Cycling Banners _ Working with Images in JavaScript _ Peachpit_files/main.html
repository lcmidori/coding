
<!-- saved from url=(0050)https://td.yieldify.com/0.0.1/tag/1.75.0/main.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><script>!function e(t,n,r){function s(i,u){if(!n[i]){if(!t[i]){var f="function"==typeof require&&require;if(!u&&f)return f(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var a=n[i]={exports:{}};t[i][0].call(a.exports,function(e){var n=t[i][1][e];return s(n?n:e)},a,a.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)s(r[i]);return s}({1:[function(require,module,exports){!function(){var Promise=require("../lib/Promise");eval("1"),!function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./messages"),i=e("../../lib/Logger"),s=e("../../sandbox/modules/BaseModule"),a="api",u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.start=function(e,t){this.store=e,this.versionInfo=t,i.logger.debug(null,"Started API Client")},t.prototype.getRoutingLabel=function(){return a},t.prototype["interface"]=function(){var e=this;return{sendToSandbox:function(t){return e.receiveFromHost(t)["catch"](function(e){throw e.name===o.WARNING_NAME?i.logger.warn({error:e},"YCP API Message failed in sandbox"):i.logger.error({error:e},"YCP API Message failed in sandbox"),e})}}},t.prototype.receiveFromHost=function(e){return void 0===this.store||void 0===this.versionInfo?Promise.reject(new Error("Received API Message in Sandbox before client started")):(i.logger.debug({message:e},"Received API Message in Sandbox"),"PING"===e.type?o.handlePingMessage(e,this.store):"EXTERNAL_VALUE_UPDATED"===e.type?o.handleExternalValueUpdate(e,this.store):"GET_VERSIONS"===e.type?o.handleGetVersionsMessage(e,this.versionInfo):Promise.reject(new Error("No message handler setup")))},t}(s.BaseModule);n.APIClient=u},{"../../lib/Logger":145,"../../sandbox/modules/BaseModule":164,"./messages":2}],2:[function(e,t,n){"use strict";function r(e){return"object"==typeof e&&"PING"===e.type&&"string"==typeof e.message}function o(e,t){return y.logger.debug({pingMessage:e.message},"API PING!"),Promise.resolve()}function i(e){return"object"==typeof e&&"EXTERNAL_VALUE_UPDATED"===e.type&&"string"==typeof e.name&&"string"==typeof e.pageType&&("string"==typeof e.value||"number"==typeof e.value||null===e.value)}function s(e,t){var n=d.externalValue(e.name,e.pageType)(t.getState());return void 0===n?Promise.reject(new Error("Invalid external value update")):u(e.pageType,t)?a(n.dataType,e)?(t.dispatch(g.pageElementValueUpdated(n.id,e.value)),Promise.resolve()):Promise.reject(new Error("External value type invalid")):Promise.reject(new h("Updating external value for inactive page type"))}function a(e,t){return null===t.value||("String"===e&&"string"!=typeof t.value?(y.logger.error({externalValueUpdate:t},"Invalid external value, expected a String"),!1):"Integer"!==e||"number"==typeof t.value&&t.value%1===0?"Float"!==e||"number"==typeof t.value||(y.logger.error({externalValueUpdate:t},"Invalid external value, expected a Float"),!1):(y.logger.error({externalValueUpdate:t},"Invalid external value, expected an Integer"),!1))}function u(e,t){return f.some(d.activePageTypes(t.getState()),function(t){return t.name===e})}function c(e){return"object"==typeof e&&"GET_VERSIONS"===e.type}function l(e,t){return Promise.resolve(t)}var p=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var f=e("@yieldify/gendry-dragonglass"),d=e("../redux/reducers/page-scraping"),g=e("../redux/actions/page-elements"),y=e("../../lib/Logger");n.WARNING_NAME="Warning";var h=function(e){function t(t){var r=e.call(this,t)||this;return r.name=n.WARNING_NAME,r}return p(t,e),t}(Error);n.Warning=h,n.messageValidators=[r,i,c],n.validatePingMessage=r,n.handlePingMessage=o,n.validateExternalValueUpdatedMessage=i,n.handleExternalValueUpdate=s,n.validateGetVersionsMessage=c,n.handleGetVersionsMessage=l},{"../../lib/Logger":145,"../redux/actions/page-elements":84,"../redux/reducers/page-scraping":103,"@yieldify/gendry-dragonglass":212}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ValueSourceDataType={STRING:"String",INTEGER:"Integer",FLOAT:"Float"}},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../lib/Logger"),o=e("../redux/reducers/user"),i=function(){function e(e,t){this.store=e,this.splitSelector=t}return e.prototype.selectCollection=function(e){var t=this.validateSplitsAndCollections(e);if(t)throw t;var n=o.user(this.store.getState()),i=e.experiment;if(null===i||void 0===i)return r.logger.debug({campaignId:e.id},"No experiment present, selecting its only collection"),e.collections[0];var s=this.splitSelector.selectSplit(i,n.id);r.logger.debug({campaignId:e.id,experimentId:i.id,splitId:s.id},"Selected Split for Experiment");var a=this.getCollectionDefinitionById(e.collections,s.collectionId);if(a)return r.logger.debug({campaignId:e.id,collection:a.id},"Selected Collection for Campaign"),a;throw r.logger.error({campaignId:e.id,experiment:i,selectedSplitId:s.id},"Unable to find Collection associated with selected split"),new Error("No collection found for split")},e.prototype.getCollectionDefinitionById=function(e,t){for(var n=0,r=e;n<r.length;n++){var o=r[n];if(o.id===t)return o}},e.prototype.validateSplitsAndCollections=function(e){if(0===e.collections.length)return new Error("Campaign "+e.id+" has no execution collections");if(e.experiment){if(e.collections.length!==e.experiment.splits.length)return new Error("Campaign "+e.id+" has a different number of splits / collections");for(var t=[],n=function(n){if(t.indexOf(n.id)!==-1)return{value:new Error("Campaign "+e.id+" has duplicate collection ids")};t.push(n.id);var r=e.experiment.splits.filter(function(e){return e.collectionId===n.id});return 1!==r.length?{value:new Error("Campaign "+e.id+" has mismatched split and collection ids")}:void 0},r=0,o=e.collections;r<o.length;r++){var i=o[r],s=n(i);if("object"==typeof s)return s.value}}else if(e.collections.length>1)return new Error("Campaign "+e.id+" has no experiment and more than one collection");return null},e}();n.CollectionSelector=i},{"../../lib/Logger":145,"../redux/reducers/user":110}],5:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./ExecutionComponent"),i=e("./events/ImpressionEvent"),s=function(e){function t(t,n,r,o,i){var s=e.call(this,t,n,r,o)||this;return s.timeProvider=i,s}return r(t,e),t.prototype._begin=function(){var e=this;this.publishEvent(new i.ImpressionEvent(this,this.timeProvider,(!0))),setTimeout(function(){e.done()},0)},t}(o.ExecutionComponent);n.ControlOverlay=s},{"./ExecutionComponent":10,"./events/ImpressionEvent":17}],6:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable"),i=function(e){function t(t,n,r,o){void 0===o&&(o=!1);var i=e.call(this)||this;return i.eventType=t,i.selector=n,i.domClient=r,i.preventDefault=o,i}return r(t,e),t.prototype.start=function(){var e=this;this.domClient.listen(this.selector,this.eventType,this.preventDefault).subscribe(function(t){e.publish(t)})},t.prototype.getSelector=function(){return this.selector},t}(o.Observable);n.EventListenerObservable=i},{"../../lib/Observable":146}],7:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var i,s=e("../preconditions/BooleanExpression"),a=e("../../lib/Logger"),u=e("../../lib/CachingObservable"),c=e("../../lib/Observable"),l=e("../../lib/Set"),p=e("./ExecutionComponent");!function(e){e[e.OFF=0]="OFF",e[e.PREPARING=1]="PREPARING",e[e.READY=2]="READY",e[e.TRIGGER_FIRED=3]="TRIGGER_FIRED",e[e.IN_PROGRESS=4]="IN_PROGRESS",e[e.DONE=5]="DONE"}(i=n.CollectionState||(n.CollectionState={}));var f=function(){function e(e,t,n,r){this.definition=e,this.setMetadata(e),this.expressionFactory=n,this.setupPrecondition(e.targetRules),this.stateObservable=new u.CachingObservable,this.eventObservable=new c.Observable;var i=e.components.filter(function(e){return e.device===r});if(this.isControlCollection(e.experimentSplitType)){var s=i.filter(function(e){return"Overlay"===e.type})[0];i=void 0===s?[]:[o({},s,{type:"ControlOverlay"})]}this.components=t.create(i,this)}return e.prototype.start=function(){this.updateStateModel(new g(this));for(var e=0,t=this.components;e<t.length;e++){var n=t[e];this.startComponent(n)}this.precondition.start()},e.prototype.prepareComponents=function(){this.components.forEach(function(e){return e.prepare()})},e.prototype.startComponentsPrecondition=function(){this.components.forEach(function(e){return e.startPrecondition()})},e.prototype.getState=function(){return this.stateModel.getState()},e.prototype.getStateObservable=function(){return this.stateObservable},e.prototype.getEventObservable=function(){return this.eventObservable},e.prototype.getComponents=function(){return this.components},e.prototype.getOverlayPositions=function(){var e=[];return this.definition.components.forEach(function(t){"Overlay"===t.type&&e.push(t.settings.position)}),new l.Set(e)},e.prototype.getMetadata=function(){return this.metadata},e.prototype.begin=function(){this.updateStateModel(this.stateModel.begin())},e.prototype.toJSON=function(){return{metadata:this.getMetadata(),components:this.components.map(function(e){return e.getId()})}},e.prototype.updateStateModel=function(e){this.stateModel&&e.getState()===this.getState()||(this.stateModel=e,this.stateModel.start(),this.updateState(this.stateModel.getState()))},e.prototype.isControlCollection=function(e){return null!==e&&"inc"===e.exptype&&"control"===e.splittype},e.prototype.setupPrecondition=function(e){var t=this;try{this.precondition=this.expressionFactory.createExpression(e)}catch(n){a.logger.error({error:n,rulesDef:e,collectionId:this.getMetadata().id},"Error parsing expression, returning alwaysFalse()."),this.precondition=s.alwaysFalse()}this.precondition.subscribe(function(e){t.updateStateModel(t.stateModel.processPreconditionChange(e))})},e.prototype.startComponent=function(e){var t=this;e.getStateObservable().subscribe(function(n){a.logger.debug({component:e,newState:p.ComponentState[n]},"Component changed state."),t.updateStateModel(t.stateModel.processComponentStateChange(e,n))}),e.getEventObservable().subscribe(function(e){t.eventObservable.publish(e)}),e.start()},e.prototype.updateState=function(e){this.stateObservable.publishIfChanged(e)},e.prototype.setMetadata=function(e){this.metadata={id:e.id,campaignId:e.campaignId,campaignName:e.campaignName,experimentId:e.experimentId,experimentUuid:e.experimentUuid,splitId:e.splitId,experimentSplitType:e.experimentSplitType}},e}();n.ExecutionCollection=f;var d=function(){function e(e){this.collection=e}return e.prototype.processPreconditionChange=function(e){return this},e.prototype.processComponentStateChange=function(e,t){throw new Error("Unable to evaluate state change in state "+i[this.getState()]+" with component changing state to "+p.ComponentState[t])},e.prototype.begin=function(){throw new Error("Unsupported operation begin() in state "+i[this.getState()])},e.prototype.start=function(){},e.prototype.getComponentsInState=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],r=0,o=this.collection.getComponents();r<o.length;r++){var i=o[r];e.indexOf(i.getState())>=0&&n.push(i)}return n},e}(),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getState=function(){return i.OFF},t.prototype.processPreconditionChange=function(e){return e?new y(this.collection):this},t.prototype.processComponentStateChange=function(t,n){return n===p.ComponentState.DORMANT?this:e.prototype.processComponentStateChange.call(this,t,n)},t}(d),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getState=function(){return i.PREPARING},t.prototype.start=function(){this.collection.prepareComponents()},t.prototype.processComponentStateChange=function(t,n){if(n===p.ComponentState.OFF){var r=this.getComponentsInState(p.ComponentState.OFF).length,o=this.collection.getComponents().length;return r===o?new h(this.collection):this}return n===p.ComponentState.PREPARING?this:e.prototype.processComponentStateChange.call(this,t,n)},t}(d),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getState=function(){return i.READY},t.prototype.start=function(){this.collection.startComponentsPrecondition()},t.prototype.processComponentStateChange=function(t,n){return n===p.ComponentState.OFF||n===p.ComponentState.READY?this:n===p.ComponentState.TRIGGER_FIRED?new v(this.collection):e.prototype.processComponentStateChange.call(this,t,n)},t}(d),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getState=function(){return i.TRIGGER_FIRED},t.prototype.begin=function(){var t=this.getComponentsInState(p.ComponentState.TRIGGER_FIRED);return t.length>0?(this.activatingComponent=t[0],this.activatingComponent.begin(),new m(this.collection,this.activatingComponent)):e.prototype.begin.call(this)},t.prototype.processComponentStateChange=function(t,n){return this.activatingComponent===t&&n===p.ComponentState.IN_PROGRESS?this:n===p.ComponentState.OFF||n===p.ComponentState.PREPARING||n===p.ComponentState.READY||n===p.ComponentState.TRIGGER_FIRED?this.getComponentsInState(p.ComponentState.TRIGGER_FIRED).length>0?this:this.getComponentsInState(p.ComponentState.READY).length>0?new h(this.collection):new g(this.collection):e.prototype.processComponentStateChange.call(this,t,n)},t}(d),m=function(e){function t(t,n){var r=e.call(this,t)||this;return r.activeComponent=n,r}return r(t,e),t.prototype.getState=function(){return i.IN_PROGRESS},t.prototype.processComponentStateChange=function(e,t){return this.activeComponent===e?this.processActiveComponentStateChange(e,t):this.activeComponent?this.processInactiveComponentStateChange(e,t):this.processStateChange(e,t)},t.prototype.processActiveComponentStateChange=function(t,n){if(n===p.ComponentState.DONE){this.activeComponent=void 0;var r=this.getComponentsInState(p.ComponentState.READY,p.ComponentState.PREPARING).length,o=this.getComponentsInState(p.ComponentState.TRIGGER_FIRED).length;if(r+o===0)return new b(this.collection);if(o>0){var i=this.getComponentsInState(p.ComponentState.TRIGGER_FIRED);return this.activeComponent=i[0],this.activeComponent.begin(),this}return this}return n===p.ComponentState.IN_PROGRESS?this:e.prototype.processComponentStateChange.call(this,t,n)},t.prototype.processInactiveComponentStateChange=function(t,n){return n===p.ComponentState.OFF||n===p.ComponentState.PREPARING||n===p.ComponentState.READY||n===p.ComponentState.TRIGGER_FIRED?this:e.prototype.processComponentStateChange.call(this,t,n)},t.prototype.processStateChange=function(t,n){return n===p.ComponentState.READY?this:n===p.ComponentState.OFF?0===this.getComponentsInState(p.ComponentState.READY).length?new b(this.collection):this:n===p.ComponentState.TRIGGER_FIRED?(this.activeComponent=t,this.activeComponent.begin(),this):e.prototype.processComponentStateChange.call(this,t,n)},t}(d),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getState=function(){return i.DONE},t}(d)},{"../../lib/CachingObservable":142,"../../lib/Logger":145,"../../lib/Observable":146,"../../lib/Set":150,"../preconditions/BooleanExpression":62,"./ExecutionComponent":10}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../redux/actions/blocked-impression"),o=e("./events/CloseEvent"),i=e("./events/ClickThroughEvent"),s=e("../../lib/Logger"),a=e("../../lib/Observable"),u=e("../../lib/Set"),c=e("./events/ImpressionEvent"),l=e("./events/FormSubmissionEvent"),p=e("./ExecutionCollection"),f=e("../redux/actions/impression"),d=e("../redux/actions/form-submit"),g=e("../redux/reducers/session"),y=e("../redux/actions/click-through"),h=e("../redux/actions/close-event");n.DEVICE_BLACKLIST=[];var v=function(){function e(e,t,n,r,o,i,s,u){this.campaignDefinitions=e,this.collectionCreator=t,this.collectionSelector=n,this.asyncWorker=r,this.randomSource=o,this.collections=[],this.eventObservable=new a.Observable,this.blacklisted=s.reduce(function(e,t){return e||t.test(i.userAgent)},!1),this.activeCollections=[],this.store=u}return e.prototype.getEventObservable=function(){return this.eventObservable},e.prototype.start=function(){var e=this;try{var t=this.campaignDefinitions.map(function(t){return e.collectionSelector.selectCollection(t)});this.collections=t.map(function(t){return e.collectionCreator.create(t)}),this.collections.forEach(function(t){e.startCollection(t)})}catch(n){s.logger.error({error:n},"Unable to select Collections to instantiate")}},e.prototype.toJSON=function(){return{campaignDefinitions:this.campaignDefinitions}},e.prototype.connectToStore=function(e){this.getEventObservable().subscribe(function(t){if(t instanceof c.ImpressionEvent){var n=t.getSource(),r=n.getParentCollection().getMetadata(),s="Overlay"===n.getType()?n.getDisplayOrder():0;e.dispatch(f.impression({campaignId:r.campaignId,campaignName:r.campaignName,collectionId:r.id,componentId:n.getId(),componentDisplayOrder:s,experimentId:r.experimentId,experimentUuid:r.experimentUuid,splitId:r.splitId,experimentSplitType:r.experimentSplitType,timestamp:t.getTimestamp(),control:t.isControl(),sessionCount:g.session(e.getState()).sessionCount}))}if(t instanceof i.ClickThroughEvent){var n=t.getSource(),r=n.getParentCollection().getMetadata(),s="Overlay"===n.getType()?n.getDisplayOrder():0;e.dispatch(y.clickThrough({campaignId:r.campaignId,campaignName:r.campaignName,collectionId:r.id,componentId:n.getId(),componentDisplayOrder:s,experimentId:r.experimentId,experimentUuid:r.experimentUuid,splitId:r.splitId,experimentSplitType:r.experimentSplitType,timestamp:t.getTimestamp(),control:t.isControl()}))}if(t instanceof o.CloseEvent){var n=t.getSource(),r=n.getParentCollection().getMetadata(),s="Overlay"===n.getType()?n.getDisplayOrder():0;e.dispatch(h.closeEvent({campaignId:r.campaignId,campaignName:r.campaignName,collectionId:r.id,componentId:n.getId(),componentDisplayOrder:s,experimentId:r.experimentId,experimentUuid:r.experimentUuid,splitId:r.splitId,experimentSplitType:r.experimentSplitType,timestamp:t.getTimestamp(),control:t.isControl()}))}if(t instanceof l.FormSubmissionEvent){var n=t.getSource(),r=n.getParentCollection().getMetadata(),s="Overlay"===n.getType()?n.getDisplayOrder():0;e.dispatch(d.formSubmit({campaignId:r.campaignId,campaignName:r.campaignName,collectionId:r.id,componentId:n.getId(),componentDisplayOrder:s,experimentId:r.experimentId,experimentUuid:r.experimentUuid,splitId:r.splitId,experimentSplitType:r.experimentSplitType,timestamp:t.getTimestamp(),control:t.isControl(),inputValues:t.getInputValues()}))}})},e.prototype.startCollection=function(e){var t=this;e.getStateObservable().subscribe(function(n){t.processCollectionStateChange(n,e)}),e.getEventObservable().subscribe(function(e){t.eventObservable.publish(e)}),e.start()},e.prototype.processCollectionStateChange=function(e,t){if(s.logger.debug({newState:p.CollectionState[e],collection:t},"Collection changed state."),this.activeCollections.indexOf(t)!==-1){if(e===p.CollectionState.DONE)this.activeCollections=this.activeCollections.filter(function(e){return e!==t}),this.asyncProcessTriggerFired();else if(e!==p.CollectionState.IN_PROGRESS)throw new Error("Unexpected state change to "+p.CollectionState[e]+" for active collection")}else if(0!==this.activeCollections.length){if(e===p.CollectionState.IN_PROGRESS||e===p.CollectionState.DONE)throw new Error("Unexpected state change to "+p.CollectionState[e]+" for inactive collection");this.asyncProcessTriggerFired()}else{if(e===p.CollectionState.IN_PROGRESS||e===p.CollectionState.DONE)throw new Error("Unexpected state change to "+p.CollectionState[e]+" for inactive collection");e===p.CollectionState.TRIGGER_FIRED&&this.asyncProcessTriggerFired()}},e.prototype.getCandidates=function(e){return e.filter(function(e){return e.getStateObservable().getCurrentValue()===p.CollectionState.TRIGGER_FIRED})},e.prototype.getPositionSet=function(e){var t=[];return e.forEach(function(e){t.push.apply(t,e.getOverlayPositions().values())}),new u.Set(t)},e.prototype.selectVisiblyCompatibleCollections=function(e,t){for(var n=[],r=[],o=new u.Set([]);0!==e.length;){var i=this.randomSource.getInteger(e.length-1),s=e[i];t.intersection(s.getOverlayPositions()).isEmpty()&&o.intersection(s.getOverlayPositions()).isEmpty()?(n.push(s),o=o.union(s.getOverlayPositions())):r.push(s),e.splice(i,1)}return{selected:n,blocked:r}},e.prototype.asyncProcessTriggerFired=function(){var e=this;this.blacklisted||this.asyncWorker.performAsyncCallback(function(){var t=e.getCandidates(e.collections);if(0!==t.length){var n=e.getPositionSet(e.activeCollections),o=e.selectVisiblyCompatibleCollections(t,n);(i=e.activeCollections).push.apply(i,o.selected),o.selected.forEach(function(e){e.begin()}),o.blocked.forEach(function(t){var n=t.getMetadata();e.store.dispatch(r.blockedImpression({campaignId:n.campaignId,collectionId:n.id,componentId:-1,experimentId:n.experimentId,experimentUuid:n.experimentUuid,splitId:n.splitId,experimentSplitType:n.experimentSplitType}))});var i}})},e}();n.ExecutionCollectionController=v},{"../../lib/Logger":145,"../../lib/Observable":146,"../../lib/Set":150,"../redux/actions/blocked-impression":72,"../redux/actions/click-through":73,"../redux/actions/close-event":74,"../redux/actions/form-submit":78,"../redux/actions/impression":80,"../redux/reducers/session":105,"./ExecutionCollection":7,"./events/ClickThroughEvent":14,"./events/CloseEvent":15,"./events/FormSubmissionEvent":16,"./events/ImpressionEvent":17}],9:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Creator"),i=e("./ExecutionCollection"),s=function(e){function t(t,n,r){var o=e.call(this)||this;return o.componentCreator=t,o.expressionFactory=n,o.deviceType=r,o}return r(t,e),t.prototype.create=function(e){return new i.ExecutionCollection(e,this.componentCreator,this.expressionFactory,this.deviceType)},t}(o.Creator);n.ExecutionCollectionCreator=s},{"../../lib/Creator":143,"./ExecutionCollection":7}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../preconditions/BooleanExpression"),o=e("../../lib/Logger"),i=e("../../lib/CachingObservable"),s=e("../../lib/Observable"),a=function(){function e(e,t,n,r){this.def=e,this.triggerFactory=t,this.expressionFactory=n,this.parentCollection=r,this.state=u.DORMANT,this.triggers=[],this.eventObservable=new s.Observable,this.stateObservable=new i.CachingObservable,this.uuid=e.uuid,this.id=e.id,this.type=e.type}return e.prototype.start=function(){if(!this.def.triggers)throw new Error("Missing triggers on component");if(!this.def.trigger_precondition)throw new Error("Missing trigger_precondition on component");this.updateState(this.state),this.setupTriggers(this.def.triggers),this.setupPrecondition(this.def.trigger_precondition)},e.prototype.prepare=function(){if(this.state!==u.DORMANT)throw new Error("Unsupported operation prepare in state "+u[this.state]);this.updateState(u.PREPARING),this._prepare()},e.prototype._prepare=function(){this.off()},e.prototype.off=function(){if(this.state!==u.PREPARING)throw new Error("Unsupported operation off in state "+u[this.state]);this.updateState(u.OFF)},e.prototype._off=function(){},e.prototype.startPrecondition=function(){this.precondition.start()},e.prototype.ready=function(){if(this.state!==u.OFF)throw new Error("Unsupported operation ready in state "+u[this.state]);this.updateState(u.READY);for(var e=0,t=this.triggers;e<t.length;e++){var n=t[e];n.prepare()}},e.prototype.triggerFired=function(){if(this.state!==u.READY)throw new Error("Unsupported operation triggerFired in state "+u[this.state]);this.updateState(u.TRIGGER_FIRED),this._triggerFired()},e.prototype._triggerFired=function(){},e.prototype.begin=function(){if(this.state!==u.TRIGGER_FIRED)throw new Error("Unsupported operation begin in state "+u[this.state]);this.updateState(u.IN_PROGRESS),this._begin()},e.prototype._begin=function(){},e.prototype.cancel=function(){if(this.state!==u.READY&&this.state!==u.TRIGGER_FIRED)throw new Error("Unsupported operation cancel in state "+u[this.state]);this.updateState(u.OFF);for(var e=0,t=this.triggers;e<t.length;e++){var n=t[e];n.cancel()}this._cancel()},e.prototype._cancel=function(){},e.prototype.done=function(){if(this.state!==u.IN_PROGRESS)throw new Error("Unsupported operation done in state "+u[this.state]);this.updateState(u.DONE)},e.prototype.publishEvent=function(e){this.eventObservable.publish(e)},e.prototype.updateState=function(e){this.state=e,this.stateObservable.publishIfChanged(e)},e.prototype.setupTriggers=function(e){var t=this;e.forEach(function(e){var n;try{n=t.triggerFactory.create(e)}catch(r){return void o.logger.error({error:r,triggerDef:e},"Unable to create trigger")}t.triggers.push(n),n.subscribe(function(){t.triggerFired()})})},e.prototype.setupPrecondition=function(e){var t=this;try{this.precondition=this.expressionFactory.createExpression(e)}catch(n){o.logger.error({error:n,rulesDef:e},"Error parsing expression, returning alwaysFalse()."),this.precondition=r.alwaysFalse()}this.precondition.subscribe(function(e){e===!0&&t.state===u.OFF?t.ready():e!==!1||t.state!==u.PREPARING&&t.state!==u.READY&&t.state!==u.TRIGGER_FIRED||t.cancel()})},e.prototype.getType=function(){return this.type},e.prototype.getId=function(){return this.id},e.prototype.getState=function(){return this.state},e.prototype.getPrecondition=function(){return this.precondition},e.prototype.getEventObservable=function(){return this.eventObservable},e.prototype.getStateObservable=function(){return this.stateObservable},e.prototype.getUuid=function(){return this.uuid},e.prototype.getParentCollection=function(){return this.parentCollection},e.prototype.getDefinition=function(){return this.def},e.prototype.toJSON=function(){return{uuid:this.uuid,id:this.id,state:this.state,type:this.type}},e.prototype.getCampaignId=function(){return this.getParentCollection().getMetadata().campaignId},e}();n.ExecutionComponent=a;var u;!function(e){e[e.DORMANT=0]="DORMANT",e[e.PREPARING=1]="PREPARING",e[e.OFF=2]="OFF",e[e.READY=3]="READY",e[e.TRIGGER_FIRED=4]="TRIGGER_FIRED",e[e.IN_PROGRESS=5]="IN_PROGRESS",e[e.DONE=6]="DONE"}(u=n.ComponentState||(n.ComponentState={}))},{"../../lib/CachingObservable":142,"../../lib/Logger":145,"../../lib/Observable":146,"../preconditions/BooleanExpression":62}],11:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Logger"),i=e("../../lib/Creator"),s=e("./Overlay"),a=e("./ControlOverlay"),u=e("../../sandbox/remote-windows/RemoteWindow"),c=function(e){function t(t,n,r,o,i,s,a,u,c,l){var p=e.call(this)||this;return p.domClient=t,p.windowClient=n,p.iframeClient=r,p.triggerFactory=o,p.expressionFactory=i,p.formCreator=s,p.window=a,p.timeProvider=u,p.store=c,p.tagVersion=l,p}return r(t,e),t.prototype.create=function(e,t){var n=this;return e.reduce(function(e,r){switch(r.type){case"Overlay":e.push(new s.Overlay(n.domClient,n.windowClient,n.iframeClient,r,n.triggerFactory,n.expressionFactory,t,n.formCreator,n.window,n.timeProvider,n.store,u.RemoteWindow.connect,n.tagVersion));break;case"ControlOverlay":e.push(new a.ControlOverlay(r,n.triggerFactory,n.expressionFactory,t,n.timeProvider));break;default:o.logger.warn({type:r.type},"Unknown Execution Component type in configuration")}return e},[])},t}(i.Creator);n.ExecutionComponentCreator=c},{"../../lib/Creator":143,"../../lib/Logger":145,"../../sandbox/remote-windows/RemoteWindow":181,"./ControlOverlay":5,"./Overlay":12}],12:[function(e,t,n){"use strict";function r(e,t){var n=!0,r=[];void 0!==e.pageUrl&&(n=e.pageUrl.encoded,r=l.entries(e.pageUrl.query));var o=l.parseUrl(t);(void 0!==o.query||r.length>0)&&(o=i({},o,{query:l.stringifyQueryParameters(l.getQueryParameters(o).concat(r))}));var s=l.stringifyUrl(o),a=/{{\s*page\.url\s*}}/g;return e.target.replace(a,n?encodeURIComponent(s):s)}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../redux/actions/overlay-status"),a=e("../redux/reducers/device"),u=e("../../lib/utils"),c=e("../../lib/Logger"),l=e("@yieldify/gendry-dragonglass"),p=e("../../lib/events/DOMEventType"),f=e("../../sandbox/modules/dom/Client"),d=e("../../sandbox/modules/redux-store/Agent"),g=e("./ExecutionComponent"),y=e("./EventListenerObservable"),h=e("./events/ImpressionEvent"),v=e("./events/ClickThroughEvent"),m=e("./events/CloseEvent"),b=e("./events/RedirectEvent"),_=e("../lib/utils"),E=e("../model/form/Form"),O=e("../layouts/OverlayLayout"),S=e("../layouts/NotificationLayout"),w=e("../redux/tag"),C=e("../redux/actionRelay"),P=e("../redux/reducers/overlay-status"),I=e("../redux/reducers/window-dimensions"),T=e("../redux/utils"),R=e("../redux/sagas/trackable"),x=e("../redux/reducers/page"),A=e("../redux/actions/last-component-submitted"),M=e("../redux/reducers/config"),L=e("../../lib/utils");
n.IFRAME_NAME_PREFIX="yie-iframe-";var N=300,D={display:"block",overflow:"hidden",width:"100%",height:"100%"},j={frameBorder:"0",marginWidth:"0",marginHeight:"0"},k=[100,200,400,550,600,700,1e3];n.MIN_BORDER=.1;var V=function(e){function t(t,n,r,o,i,s,a,u,c,l,p,f,d){var g=e.call(this,o,i,s,a)||this;return g.domClient=t,g.windowClient=n,g.iframeClient=r,g.settings=o.settings,g.formCreator=u,g.oneTimePrepareDone=!1,g.timeProvider=l,g.store=p,g.focused=!1,g.connectToRemoteWindow=f,g.window=c,g.tagVersion=d,g.layout=g.getLayout(g.settings),g.iframeSelector=g.layout.getIFrameParentSelector()+" iframe",g}return o(t,e),t.prototype._prepare=function(){var e=this;if(this.oneTimePrepareDone)this.off();else{this.oneTimePrepareDone=!0;var t=this.layout.renderElements(this.getDisplayState(),this.domClient);L.timeout(1e3,t,"Overlay "+this.uuid+": Initial render timed out").then(function(){var t=e.iframeClient.createIFrame({src:u.addHashParameters(e.settings.url,u.getHash(e.window)),parentElement:e.layout.getIFrameParentSelector(),name:n.IFRAME_NAME_PREFIX+e.uuid});return L.timeout(6e4,t,"Overlay "+e.uuid+": Iframe creation timed out")}).then(function(t){c.logger.debug({connection:t,overlayUuid:e.uuid},"Connection established");var n=e.createRemoteDomClient(),r=new d.ReduxStoreAgent(e.store),o={uuid:e.uuid,settings:e.settings,tagConfig:M.tagConfig(e.store.getState()),tagVersion:e.tagVersion||""},i={initConfig:JSON.stringify(o),provide:[n,r]};return L.timeout(1e3,e.connectToRemoteWindow(JSON,i)(t),"Overlay "+e.uuid+": RemoteWindow connection timed out")}).then(function(t){c.logger.debug({remoteWindow:t,overlayUuid:e.uuid},"Connected to RemoteWindow"),e.remoteOverlayWindow=t;var n=e.remoteOverlayWindow.getModuleByClass(f.DOMClient);if(!n)throw new Error("Missing overlay DOM client");e.overlayElements=e.createElements(e.getDefinition().settings.overlayElements,n),e.setupListeners(),e.styleIFrame(),e.redraw();var r=new Promise(function(t,n){var r=e.store.subscribe(function(){var o=e.store.getState();P.overlayReady(e.settings.url)(o)?(t(void 0),r()):P.overlayError(e.settings.url)(o)&&(n(new Error("Overlay "+e.uuid+": Overlay went into error state")),r())})}),o=e.remoteOverlayWindow.getModuleByClass(d.ReduxStoreAgent);return w.replicateDerivedState(e.store.getState(),o),e.store.dispatch(C.remoteStoreCreated(o,e.getUuid())),r}).then(function(){e.off()},function(e){c.logger.error({error:e},"Overlay preparation promise rejected")})}},t.prototype._begin=function(){this.redraw(),this.publishEvent(new h.ImpressionEvent(this,this.timeProvider))},t.prototype.close=function(){return this.done(),this.redraw()},t.prototype.getOverlayElements=function(){return this.overlayElements},t.prototype.getPosition=function(){return this.settings.position},t.prototype.getDisplayOrder=function(){return this.settings.displayOrder},t.prototype.updateState=function(t){switch(e.prototype.updateState.call(this,t),t){case g.ComponentState.PREPARING:this.store.dispatch(s.overlayLoading(this.settings.url));break;case g.ComponentState.IN_PROGRESS:this.store.dispatch(s.overlayVisible(this.settings.url));break;case g.ComponentState.DONE:this.store.dispatch(s.overlayClosed(this.settings.url))}},t.prototype.getLayout=function(e){var t=this.settings.position;switch(t){case"Centre":if(!this.settings.hasBackdrop)throw new Error("centre position overlays without a backdrop are not supported");if("undefined"!=typeof this.settings.margin)throw new Error("centre position overlays with a margin are not supported");return new O.OverlayLayout(this.uuid);case"TopRight":case"TopLeft":case"BottomRight":case"BottomLeft":case"Top":case"Right":case"Bottom":case"Left":if(this.settings.hasBackdrop)throw new Error("notification style overlays with a backdrop are not supported");return new S.NotificationLayout(this.uuid);default:throw c.logger.error({position:t},"Unsupported overlay position"),new Error("unsupported overlay position: "+t)}},t.prototype.redraw=function(){var e=this.getDisplayState();return c.logger.debug({state:e},"Redrawing overlay "+this.uuid),this.layout.updateElements(e,this.domClient)},t.prototype.setupListeners=function(){var e=this;this.overlayElements.forEach(function(t){t.start(),t instanceof E.Form&&t.getFocusObservable().subscribe(function(t){e.focused="focus"===t.type,k.forEach(function(t){setTimeout(function(){e.redraw()},t)})})}),T.onChange(I.windowDimensions,this.store,function(){return e.redraw()})},t.prototype.getDisplayState=function(){return{uuid:this.uuid,overlayState:this.getState(),settings:this.settings,windowDimensions:I.windowDimensions(this.store.getState()),deviceType:a.deviceType(this.store.getState()),focused:this.focused}},t.prototype.styleIFrame=function(){var e=this;return Promise.all(Object.keys(D).map(function(t){return e.domClient.setStyle(e.iframeSelector,t,D[t])}).concat(Object.keys(j).map(function(t){return e.domClient.modifyAttribute(e.iframeSelector,t,j[t])})))},t.prototype.createRemoteDomClient=function(){return new f.DOMClient},t.prototype.createElements=function(e,t){var n=this,r=e.reduce(function(e,r){switch(r.type){case"cta":c.logger.debug({cta:r},"Creating CTA");var o="click-to-call"!==r.onClick.type,i=new y.EventListenerObservable(p.DOMEventType.CLICK,_.getElementIdSelector(r.id),t,o);i.subscribe(function(){var e=r.onClick;n.handleCtaClick(e)}),e.push(i);break;case"form":c.logger.debug({form:r},"Creating Form");var s=n.formCreator.create(r,t);s.subscribe(function(e){e.setSource(n),n.publishEvent(e),n.handleCtaClick(e.getCtaAction())}),e.push(s)}return e},[]),o=new y.EventListenerObservable(p.DOMEventType.CLICK,this.layout.getCloseButtonSelector(),this.domClient);return o.subscribe(function(){n.publishEvent(new m.CloseEvent(n,n.timeProvider)),n.close()}),r.push(o),r},t.prototype.handleCtaClick=function(e){var t=this;switch(e.type){case"redirect":this.publishEvent(new v.ClickThroughEvent(this,this.timeProvider,"dismiss")),this.publishEvent(new b.RedirectEvent(this,this.timeProvider)),this.close(),L.timeout(N,R.waitForInFlightTrackables(this.store))["catch"](function(e){return[]}).then(function(){var n=r(e,x.currentPageUrl(t.store.getState()));t.windowClient.redirect(n)});break;case"next":this.publishEvent(new v.ClickThroughEvent(this,this.timeProvider,"next")),this.store.dispatch(A.updateLastComponentSubmitted(this.uuid)),this.close();break;case"dismiss":this.publishEvent(new v.ClickThroughEvent(this,this.timeProvider,"dismiss")),this.close();break;case"new-tab":c.logger.debug({ctaAction:e},"Open in new tab cta clicked");break;case"click-to-call":c.logger.debug({ctaAction:e},"Click to call clicked");break;default:throw new Error("Unknown cta action: "+e.type)}},t}(g.ExecutionComponent);n.Overlay=V,n.redirectUrl=r},{"../../lib/Logger":145,"../../lib/events/DOMEventType":156,"../../lib/utils":163,"../../sandbox/modules/dom/Client":169,"../../sandbox/modules/redux-store/Agent":175,"../layouts/NotificationLayout":23,"../layouts/OverlayLayout":24,"../lib/utils":31,"../model/form/Form":43,"../redux/actionRelay":70,"../redux/actions/last-component-submitted":81,"../redux/actions/overlay-status":83,"../redux/reducers/config":94,"../redux/reducers/device":95,"../redux/reducers/overlay-status":102,"../redux/reducers/page":104,"../redux/reducers/window-dimensions":111,"../redux/sagas/trackable":119,"../redux/tag":122,"../redux/utils":123,"./EventListenerObservable":6,"./ExecutionComponent":10,"./events/ClickThroughEvent":14,"./events/CloseEvent":15,"./events/ImpressionEvent":17,"./events/RedirectEvent":18,"@yieldify/gendry-dragonglass":212}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@yieldify/gendry-hash-util"),o=285899441,i=function(){function e(){}return e.prototype.selectSplit=function(e,t,n){void 0===n&&(n=r.murmur32);for(var i=e.splits.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),s=[t,e.uuid].join(""),a=n(s,o)/r.MURMUR_32_MAX_VALUE,u=i.reduce(function(e,t){return e+t.weight},0),c=a*u,l=0,p=0,f=i;p<f.length;p++){var d=f[p];if(l+=d.weight,l>c)return d}return i[i.length-1]},e}();n.SplitSelector=i},{"@yieldify/gendry-hash-util":227}],14:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UserJourneyEvent"),i=function(e){function t(t,n,r){var o=e.call(this,t,n)||this;return o.action=r,o}return r(t,e),t.prototype.shouldAdvanceOverlay=function(){return"next"===this.action},t.prototype.getAction=function(){return this.action},t}(o.UserJourneyEvent);n.ClickThroughEvent=i},{"./UserJourneyEvent":19}],15:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UserJourneyEvent"),i=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t}(o.UserJourneyEvent);n.CloseEvent=i},{"./UserJourneyEvent":19}],16:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UserJourneyEvent"),i=function(e){function t(t,n,r,o,i){var s=e.call(this,t,n)||this;return s.form=r,s.inputValues=o,s.ctaAction=i,s}return r(t,e),t.prototype.getForm=function(){return this.form},t.prototype.getInputValues=function(){return this.inputValues},t.prototype.getCtaAction=function(){return this.ctaAction},t}(o.UserJourneyEvent);n.FormSubmissionEvent=i},{"./UserJourneyEvent":19}],17:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UserJourneyEvent"),i=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t}(o.UserJourneyEvent);n.ImpressionEvent=i},{"./UserJourneyEvent":19}],18:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UserJourneyEvent"),i=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t}(o.UserJourneyEvent);n.RedirectEvent=i},{"./UserJourneyEvent":19}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t,n){this.control=!!n,this.timestamp=t.currentTime(),this.source=e}return e.prototype.getTimestamp=function(){return this.timestamp},e.prototype.getSource=function(){if(null===this.source)throw new Error("UserJourneyEvent source was null when read");return this.source},e.prototype.isControl=function(){return this.control},e.prototype.setSource=function(e){this.source=e},e}();n.UserJourneyEvent=r},{}],20:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../sandbox/modules/BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"analytics"},t.prototype["interface"]=function(){return{forwardEvent:this.forwardEvent}},t}(o.BaseModule);n.AnalyticsBase=i},{"../../../sandbox/modules/BaseModule":164}],21:[function(e,t,n){"use strict";function r(e,t,r){var s,a;if("IMPRESSION"===t.type||"CLICK_THROUGH"===t.type||"CLOSE_EVENT"===t.type||"FORM_SUBMIT"===t.type){if(s="IMPRESSION"!==t.type,n.isGaExperimentDataActive(r.getState()))a=i(t);else{if(t.control)return null;a=o(t)}return e.forwardEvent(a,p[t.type],s).then(l.identity,function(e){c.logger.error({error:e},"Error forwarding event")})}return null}function o(e){return"Campaign ("+e.campaignName+") - Overlay "+(e.componentDisplayOrder+1)}function i(e){var t,n=e.experimentSplitType?e.experimentSplitType.splittype:null;return n?(t="a"===n||"treatment"===n?"A":"b"===n?"B":"Control","Campaign ("+e.campaignName+") - "+t+" - Overlay "+(e.componentDisplayOrder+1)):o(e)}var s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./Base"),u=e("../../redux/reducers/config"),c=e("../../../lib/Logger"),l=e("@yieldify/gendry-dragonglass"),p={CLICK_THROUGH:"Click",CLOSE_EVENT:"Close",IMPRESSION:"Impression",FORM_SUBMIT:"Form Submit"},f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.forwardEvent=function(e,t,n){return this.invokeMethod("forwardEvent",e,t,n)},t}(a.AnalyticsBase);n.AnalyticsClient=f,n.isGaExperimentDataActive=u.websiteFlagActive("GA_EXPERIMENT_DATA"),n.forwardToAnalytics=r},{"../../../lib/Logger":145,"../../redux/reducers/config":94,"./Base":20,"@yieldify/gendry-dragonglass":212}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@yieldify/gendry-dragonglass"),o=function(){function e(e,t,n){this.id=[t.idPrefix,e].join("-"),this.definition=t,this.children=n?n:[],this.style={}}return e.prototype.render=function(e){this.style=this.filterUndefinedStyles(this.definition.getStyle(e));var t=this.children.map(function(t){return t.render(e)}).join(""),n=this.definition.elementType;return"<"+n+" "+this.renderAttributes(e)+">"+t+"</"+n+">"},e.prototype.update=function(e,t){var n=this,r=this.filterUndefinedStyles(this.definition.getStyle(e)),o=this.diffStyles(r);return this.style=r,Promise.all(Object.keys(o).map(function(e){return t.setStyle(n.getSelector(),e,o[e])}).concat(this.children.map(function(n){return n.update(e,t)}))).then(function(){})},e.prototype.getSelector=function(){return"#"+this.id},e.prototype.filterUndefinedStyles=function(e){var t={};for(var n in e){var r=e[n];void 0!==r&&(t[n]=r)}return t},e.prototype.diffStyles=function(e){var t={};for(var n in e){var r=this.style[n],o=e[n];o!==r&&(t[n]=o)}for(var n in this.style)void 0===e[n]&&(t[n]="");return t},e.prototype.getAttributes=function(e){return{id:this.id,style:this.renderStyle(e),"class":this.renderClass(e)}},e.prototype.renderAttributes=function(e){var t=this.getAttributes(e);return r.entries(this.filterUndefinedStyles(t)).map(function(e){var t=e.key,n=e.value;return t+'="'+n+'"'}).join(" ")},e.prototype.renderStyle=function(e){var t=this.definition.getStyle(e);return r.entries(this.filterUndefinedStyles(t)).map(function(e){var t=e.key,n=e.value;return t+": "+n+";"}).join(" ")},e.prototype.renderClass=function(e){var t=this.definition.getClasses(e);return t.length>0?t.join(" "):void 0},e}();n.LayoutElement=o},{"@yieldify/gendry-dragonglass":212}],23:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./fixes/iosFixes"),i=e("../../lib/browser/deviceUtil"),s=e("./commonElements"),a=e("./utils"),u=e("./fixes/mobileScaling"),c=e("./LayoutElement"),l=e("./OverlayLayout"),p=e("../execution-components/ExecutionComponent");n.DEFAULT_NOTIFICATION_MARGIN={horizontal:15,vertical:15};var f=function(){function e(e){this.closeButtonSelector=".yie_esc_"+e,this.iframeWrapper=new c.LayoutElement(e,d,[new c.LayoutElement(e,s.CLOSE_BUTTON)]),this.outerElement=new c.LayoutElement(e,n.OVERLAY_CONTAINER,[this.iframeWrapper]),this.referenceElement=new c.LayoutElement(e,g,[])}return e.prototype.renderElements=function(e,t){var n=r({},e,{referencePoint:{x:0,y:0}});return Promise.all([t.draw("body",this.outerElement.render(n)),t.draw("body",this.referenceElement.render(n))]).then(function(){})},e.prototype.updateElements=function(e,t){var n=this;return t.getBoundingClientRect(this.referenceElement.getSelector()).then(function(o){var i={x:o.left,y:o.top};return n.outerElement.update(r({},e,{referencePoint:i}),t)})},e.prototype.getOuterContainerSelector=function(){return this.outerElement.getSelector()},e.prototype.getIFrameParentSelector=function(){return this.iframeWrapper.getSelector()},e.prototype.getCloseButtonSelector=function(){return this.closeButtonSelector},e}();n.NotificationLayout=f,n.OVERLAY_CONTAINER={elementType:"div",idPrefix:"yie-overlay",getClasses:function(e){return[]},getStyle:function(e){var t=e.settings,s=e.overlayState,c=e.deviceType,f=e.windowDimensions,d=s===p.ComponentState.IN_PROGRESS,g=a.positionProperties(t.position),y=a.positionEdge(t.position),h=g.vertical,v=g.horizontal,m=t.margin||n.DEFAULT_NOTIFICATION_MARGIN,b=1,_=parseInt(t.dimensions.width,10),E=parseInt(t.dimensions.height,10);c!==i.DeviceType.DESKTOP&&(b=a.calculateScaling(e,m));var O="vertical"===y?f.height/2-E/2*b-m.vertical+"px":"0px",S="horizontal"===y?f.width/2-_/2*b-m.horizontal+"px":"0px",w=(C={position:"fixed"},C[h]=O,C[v]=S,C.visibility=d?"visible":"hidden",C.overflow=d?"visible":"hidden",C["max-width"]="none",C["max-height"]="none",C.width=d?t.dimensions.width:"0px",C.height=d?t.dimensions.height:"0px",C.margin=m.vertical+"px "+m.horizontal+"px",C["z-index"]=""+(l.OVERLAY_Z_INDEX-1),C["transform-origin"]=h+" "+v,C["-ms-transform-origin"]=h+" "+v,C["-webkit-transform-origin"]=h+" "+v,C);return r({},w,u.mobileScalingInNotifications(e,b),o.iosFixesInNotifications(e,m,b,g));var C}};var d={elementType:"div",idPrefix:"yie-overlay-wrapper",getClasses:function(e){return[]},getStyle:function(e){var t=e.settings;return{position:"absolute",top:"0px",left:"0px",width:t.dimensions.width,height:t.dimensions.height}}},g={elementType:"div",idPrefix:"yie-reference",getClasses:function(e){return[]},getStyle:function(e){var t=e.settings,n=a.positionProperties(t.position),r=n.vertical,o=n.horizontal;return i={position:"fixed",width:"0px",height:"0px"},i[r]="0px",i[o]="0px",i;var i}}},{"../../lib/browser/deviceUtil":155,"../execution-components/ExecutionComponent":10,"./LayoutElement":22,"./OverlayLayout":24,"./commonElements":25,"./fixes/iosFixes":27,"./fixes/mobileScaling":29,"./utils":30}],24:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./fixes/iosSoftKeyboardFix"),i=e("./utils"),s=e("../../lib/browser/deviceUtil"),a=e("./commonElements"),u=e("./fixes/mobileScaling"),c=e("./LayoutElement"),l=e("../execution-components/ExecutionComponent"),p=e("./fixes/iosFixedPositionInputsHack");n.OVERLAY_Z_INDEX=2147483646;var f=function(){function e(e){this.closeButtonSelector=".yie_esc_"+e,this.wrapper=new c.LayoutElement(e,y,[new c.LayoutElement(e,a.CLOSE_BUTTON)]),this.backdrop=new c.LayoutElement(e,a.BACKDROP),this.outerElement=new c.LayoutElement(e,d,[this.backdrop,new c.LayoutElement(e,g,[this.wrapper])])}return e.prototype.renderElements=function(e,t){var n=r({},e,{referencePoint:{x:0,y:0}});return t.draw("body",this.outerElement.render(n))},e.prototype.updateElements=function(e,t){var n=this;return t.getBoundingClientRect(this.backdrop.getSelector()).then(function(o){var i={x:o.left,y:o.top};return n.outerElement.update(r({},e,{referencePoint:i}),t)})},e.prototype.getOuterContainerSelector=function(){return this.outerElement.getSelector()},e.prototype.getIFrameParentSelector=function(){return this.wrapper.getSelector()},e.prototype.getCloseButtonSelector=function(){return this.closeButtonSelector},e}();n.OverlayLayout=f;var d={elementType:"div",idPrefix:"yie-overlay",getClasses:function(e){return[]},getStyle:function(e){var t=e.overlayState===l.ComponentState.IN_PROGRESS,o={position:"fixed",visibility:t?"visible":"hidden",top:"0px",left:"0px",overflow:t?"visible":"hidden",width:t?"100%":"0px",height:t?"200%":"0px","max-height":"none","max-width":"none","z-index":""+n.OVERLAY_Z_INDEX};return r({},o,p.iosFixedPositionInputsHackInOverlays(e))}},g={elementType:"div",idPrefix:"yie-inner-overlay",getClasses:function(e){return[]},getStyle:function(e){var t=e.settings,n=e.deviceType,a=e.windowDimensions,c=-parseInt(t.dimensions.height,10)/2,l=-parseInt(t.dimensions.width,10)/2,p=1,f={position:"absolute",top:"25%",left:"50%","max-width":"none","max-height":"none",width:t.dimensions.width,height:t.dimensions.height,"margin-top":c+"px","margin-left":l+"px"};if(n!==s.DeviceType.DESKTOP){var d={horizontal:.05*a.width,vertical:.05*a.height};p=i.calculateScaling(e,d)}return r({},f,u.mobileScalingInOverlays(e,p),o.iosSoftKeyboardFixInInnerOverlay(e,p))}},y={elementType:"div",idPrefix:"yie-overlay-wrapper",getClasses:function(e){return[]},getStyle:function(e){var t=e.settings;return{width:t.dimensions.width,height:t.dimensions.height}}}},{"../../lib/browser/deviceUtil":155,"../execution-components/ExecutionComponent":10,"./LayoutElement":22,"./commonElements":25,"./fixes/iosFixedPositionInputsHack":26,"./fixes/iosSoftKeyboardFix":28,"./fixes/mobileScaling":29,"./utils":30}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CLOSE_BUTTON={elementType:"span",idPrefix:"yie-close-button",getClasses:function(e){var t=e.uuid;return["yie_esc_"+t]},getStyle:function(e){var t=e.settings,n=t.closeButton,r=n&&n.position?n.position:{right:0,top:0},o=n&&n.iconUrl?"url("+n.iconUrl+")":void 0,i=n?"block":"none";return{cursor:"pointer",position:"absolute",right:r.right+"px",top:r.top+"px",display:i,width:"30px",height:"30px","background-image":o,"background-repeat":"no-repeat",margin:"-15px"}}},n.BACKDROP={elementType:"div",idPrefix:"yie-backdrop",getClasses:function(e){var t=e.uuid;return["yie_esc_"+t]},getStyle:function(e){return{position:"absolute",top:"0px",left:"0px",right:"0px",bottom:"0px",opacity:"0.7","background-color":"rgb(0, 0, 0)","-webkit-transform":"translateZ(0)","-moz-transform":"translateZ(0)","-ms-transform":"translateZ(0)","-o-transform":"translateZ(0)",transform:"translateZ(0)"}}}},{}],26:[function(e,t,n){"use strict";function r(e){return i.IS_IOS_11&&e.focused?{position:"absolute",top:e.windowDimensions._iOS11_top+"px"}:{}}function o(e,t,n,r){if(!i.IS_IOS_11||!e.focused||void 0===e.windowDimensions._iOS11_top)return{};var o=parseInt(e.settings.dimensions.height,10)*n+2*t.vertical,a=e.windowDimensions.height/s,u=a-o/2,c=Math.round(e.windowDimensions._iOS11_top+u);return{position:"absolute",top:c+"px",bottom:"unset","transform-origin":"top "+r.horizontal,"-ms-transform-origin":"top "+r.horizontal,"-webkit-transform-origin":"top "+r.horizontal}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/browser/WindowUtil"),s=3;n.iosFixedPositionInputsHackInOverlays=r,n.iosFixedPositionInputsHackInNotifications=o},{"../../../lib/browser/WindowUtil":154}],27:[function(e,t,n){"use strict";function r(e,t,n,r){return s.IS_IOS_11?o.iosFixedPositionInputsHackInNotifications(e,t,n,r):i.iosSoftKeyboardFix(e,t,n)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./iosFixedPositionInputsHack"),i=e("./iosSoftKeyboardFix"),s=e("../../../lib/browser/WindowUtil");n.iosFixesInNotifications=r},{"../../../lib/browser/WindowUtil":154,"./iosFixedPositionInputsHack":26,"./iosSoftKeyboardFix":28}],28:[function(e,t,n){"use strict";function r(e,t,n){function r(e){var t,n,r;return"vertical"===e?(t=p.height/u,r=l.y,"top"===g?(n=t-h/2,Math.round(n-r)):(n=t+h/2,Math.round(r-n))):(t=p.width/c,r=l.x,"left"===y?(n=t-v/2,Math.round(n-r)):(n=t+v/2,Math.round(r-n)))}var o=e.focused,i=e.deviceType,l=e.referencePoint,p=e.windowDimensions,f=e.settings;if(!o||i===s.DeviceType.DESKTOP)return{};var d=a.positionProperties(f.position),g=d.vertical,y=d.horizontal,h=parseInt(f.dimensions.height,10)*n+2*t.vertical,v=parseInt(f.dimensions.width,10)*n+2*t.horizontal,m={};return("top"===g&&0!==l.y||"bottom"===g&&l.y!==p.height)&&(m[g]=r("vertical")+"px"),("left"===y&&0!==l.x||"right"===y&&l.x!==p.width)&&(m[y]=r("horizontal")+"px"),m}function o(e,t){var n=e.deviceType,r=e.referencePoint,o=e.focused;if(n===s.DeviceType.DESKTOP)return{};var u=a.centredOffset(e,t),c=u.left,l=u.top;return(r.y<0||i.IS_IOS_11)&&o&&(l/=3,l-=r.y,c-=r.x),{top:l+"px",left:c+"px"}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/browser/WindowUtil"),s=e("../../../lib/browser/deviceUtil"),a=e("../utils"),u=3,c=2;n.iosSoftKeyboardFix=r,n.iosSoftKeyboardFixInInnerOverlay=o},{"../../../lib/browser/WindowUtil":154,"../../../lib/browser/deviceUtil":155,"../utils":30}],29:[function(e,t,n){"use strict";function r(e,t){var n=e.deviceType;if(n===i.DeviceType.DESKTOP)return{};var r=s.centredOffset(e,t),o=r.left,a=r.top;return{transform:"scale("+t+")","-ms-transform":"scale("+t+")","-webkit-transform":"scale("+t+")","transform-origin":"0 0","-ms-transform-origin":"0 0","-webkit-transform-origin":"0 0",top:a+"px",left:o+"px","margin-top":"0px","margin-left":"0px","margin-bottom":"0px","margin-right":"0px"}}function o(e,t){var n=e.deviceType;return n===i.DeviceType.DESKTOP?{}:{transform:"scale("+t+")","-ms-transform":"scale("+t+")","-webkit-transform":"scale("+t+")"}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/browser/deviceUtil"),s=e("../utils");n.mobileScalingInOverlays=r,n.mobileScalingInNotifications=o},{"../../../lib/browser/deviceUtil":155,"../utils":30}],30:[function(e,t,n){"use strict";function r(e,t){var n=e.settings,r=e.windowDimensions,o=parseInt(n.dimensions.width,10),i=parseInt(n.dimensions.height,10),s=(r.width-o*t)/2,a=(r.height-i*t)/2;return{left:s,top:a}}function o(e,t){var n=e.settings,r=e.windowDimensions,o=parseInt(n.dimensions.width,10),i=parseInt(n.dimensions.height,10),s=1,a=Math.min(s,Math.min((r.width-2*t.horizontal)/o,(r.height-2*t.vertical)/i));return Math.round(1e4*a)/1e4}function i(e){switch(e){case"Right":case"Left":return"vertical";case"Top":case"Bottom":return"horizontal";default:return"corner"}}function s(e){switch(e){case"Right":case"TopRight":return{vertical:"top",horizontal:"right"};case"Top":case"Left":case"TopLeft":return{vertical:"top",horizontal:"left"};case"BottomRight":return{vertical:"bottom",horizontal:"right"};case"Bottom":case"BottomLeft":return{vertical:"bottom",horizontal:"left"};default:throw new Error("This layout is not valid for the position "+e)}}Object.defineProperty(n,"__esModule",{value:!0}),n.centredOffset=r,n.calculateScaling=o,n.positionEdge=i,n.positionProperties=s},{}],31:[function(e,t,n){"use strict";function r(e){return'[y-id="'+e+'"]'}Object.defineProperty(n,"__esModule",{value:!0}),n.getElementIdSelector=r},{}],32:[function(e,t,n){"use strict";function r(e,t){t instanceof J.CachingObservable&&d.logger.debug({initialValue:t.getCurrentValue()},"Initial value for "+e),t.subscribe(function(t){d.logger.debug({newValue:t},"Updated value for "+e)})}function o(e){return function(t){r("DataLayer("+t+")",e.getValue(t).getObservable())}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./storage/thirdPartySessionStorage"),s=e("./redux/reducers/tab"),a=e("./redux/actions/domain-entity-properties"),u=e("@yieldify/gendry-dragonglass"),c=e("@yieldify/gendry-jsonrpc-clients"),l=e("@yieldify/gendry-browser-compat"),p=e("../lib/utils"),f=e("../lib/browser/CookieUtil"),d=e("../lib/Logger"),g=e("../lib/AsyncWorker"),y=e("./storage/thirdPartyLocalStorage"),h=e("./model/DataLayer"),v=e("../lib/browser/deviceUtil"),m=e("./model/MouseOut"),b=e("./model/DesktopExitIntention"),_=e("./model/MobileExitIntention"),E=e("./model/PageVisibility"),O=e("./model/PageFocus"),S=e("./model/PageUrl"),w=e("./model/CanonicalisedPageUrl"),C=e("./model/page/page-elements/PageElementValueCreator"),P=e("./model/page/PageCreator"),I=e("./redux/reducers/domain-entity-properties"),T=e("./redux/sagas/domainEntityPropertyUpdateDispatcher"),R=e("./tracker/Emitter"),x=e("./tracker/EventTracker"),A=e("./preconditions/ExpressionFactory"),M=e("./triggers/Factory"),L=e("../sandbox/modules/dom/Client"),N=e("./execution-components/ExecutionCollectionCreator"),D=e("./execution-components/ExecutionComponentCreator"),j=e("./execution-components/ExecutionCollectionController"),k=e("./execution-components/CollectionSelector"),V=e("./execution-components/SplitSelector"),U=e("../sandbox/modules/window/Client"),F=e("../sandbox/modules/cookie/Client"),G=e("../sandbox/modules/local-storage/Client"),B=e("../sandbox/modules/iframe/Client"),Y=e("./redux/reducers/last-impression"),H=e("./redux/reducers/last-component-submitted"),W=e("./storage/y2Cookie"),K=e("./storage/yiCookie"),q=e("./model/VisitorType"),J=e("../lib/CachingObservable"),X=e("../lib/Observable"),z=e("../sandbox/remote-windows/RemoteWindow"),Q=e("../sandbox/remote-windows/CrossOriginClient"),Z=e("../lib/RandomSource"),$=e("../lib/TimeProvider"),ee=e("./model/site/PageView"),te=e("./model/form/FormCreator"),ne=e("./model/form/ValidationRuleCreator"),re=e("./redux/reducers/time"),oe=e("./redux/actions/page"),ie=e("./redux/reducers/page"),se=e("./redux/actions/window-dimensions"),ae=e("./redux/actions/log"),ue=e("./redux/actionRelay"),ce=e("./redux/actionListener"),le=e("./redux/reducers/urls-visited"),pe=e("./redux/reducers/user"),fe=e("./redux/reducers/campaign-last-impressions"),de=e("./redux/reducers/session"),ge=e("./redux/reducers/geolocation"),ye=e("./redux/reducers/dynamic-coupons"),he=e("./redux/storage"),ve=e("./storage/cookie"),me=e("./redux/tag"),be=e("../lib/Redux"),_e=e("./redux/sagas/pageViews"),Ee=e("./redux/sagas/session"),Oe=e("./redux/sagas/geolocation"),Se=e("./redux/sagas/saleEventDispatcher"),we=e("./storage/cookieDomainUtils"),Ce=e("./redux/actionTimestamper"),Pe=e("./api/Client"),Ie=e("./redux/actions/exit-intent"),Te=e("./redux/reducers/device"),Re=e("./integrations/analytics/Client"),xe=e("./redux/sagas/domainEntityPropertyUpdateLogger"),Ae=e("./redux/sagas/user-profile"),Me=e("./redux/sagas/dynamic-coupons"),Le=e("./redux/utils");p.initialiseDebugMode(window),p.isDebugMode()&&(d.logger.setLevel(d.Level.DEBUG),d.logger.enableConsoleLogging());try{l.EventTargetUtil.addEventListener(window,"error",function(e){d.logger.error({error:e},"Error in main.ts (global error handler)"),e.preventDefault()});var Ne=new Q.CrossOriginClient(window),De=new L.DOMClient,je=new U.WindowClient,ke=new B.IFrameClient,Ve=new G.LocalStorageClient,Ue=new Pe.APIClient,Fe=new Re.AnalyticsClient,Ge={provide:[De,je,new F.CookieClient,ke,Ve,Ue,Fe]};Ne.connect(window.parent).then(z.RemoteWindow.connect(JSON,Ge)).then(function(e){function t(e,t,n){return{start:function(){
e.publish(t(n.getState()))}}}var n=JSON.parse(e.getConfig());d.logger.debug({initConfig:n},"Parsed InitConfig");var G=JSON.parse(n.websiteConfig);d.logger.debug({websiteConfig:G},"Parsed website configuration");var B=new $.TimeProvider($.TimeProvider.parseSeedFromHash(window.location.hash)),z=e.getModuleByClass(F.CookieClient),Q=we.getCookieDomain(n.location.hostname,G.cookieDomain),Pe=f.CookieUtil.parseCookieStr(n.cookies),Ne=B.currentTime(),Ve=new R.Emitter(document,G.trackerEndpoint),Ge=new x.EventTracker(Ve,B,n.versionInfo.tag),Be=Ce.actionTimestamperMiddleware(B),Ye=ue.actionRelayMiddleware(ue.SANDBOX_SOURCE),He=ce.actionListenerMiddleware(null,function(e,t){Ge.handleAction(e,t),G.gaIntegration&&Re.forwardToAnalytics(Fe,e,t)}),We=null;try{We=localStorage}catch(Ke){d.logger.warn({error:Ke},"Usage of third-party local storage is blocked")}var qe=null;try{qe=sessionStorage}catch(Ke){d.logger.warn({error:Ke},"Usage of third-party session storage is blocked")}var Je=be.createStore(me.tagReducer(),me.initialState({config:G,sandboxConfig:n,cookieDomain:Q,thirdPartyLocalStorage:We,thirdPartySessionStorage:qe,cookieJar:Pe,currentTime:Ne,generateUUID:u.generateUUID,deviceType:v.detectDeviceType(navigator)}),be.reduxDebugEnabledEnhancer(p.isDebugMode())(be.applyMiddleware(Be,Ye,He)));d.logger.subscribe(function(e){return Je.dispatch(ae.logMessage(e))}),d.logger.debug({state:Je.getState()},"Main store initialised"),p.isDebugMode()&&(window.store=Je),he.connectPersistence(Je,y.thirdPartyLocalStorageSerialisedState,y.persistToThirdPartyLocalStorage(We,G.websiteId)),he.connectPersistence(Je,s.thirdPartySessionStorageSerialisedState,i.persistToThirdPartySessionStorage(qe)),he.connectPersistence(Je,K.yiCookieSerialisedState,ve.persistToCookie(K.YI_COOKIE_NAME,z,Q,Pe,n.location.hostname)),he.connectPersistence(Je,W.y2CookieSerialisedState,ve.persistToCookie(W.Y2_COOKIE_NAME,z,Q,Pe,n.location.hostname)),setInterval(re.updateTime(Je,B),re.UPDATE_TIME_INTERVAL_MS),je.observeInnerDimensions().dispatchAs(se.windowDimensionsUpdated,Je);var Xe=[],ze=new h.DataLayer;Ue.start(Je,n.versionInfo);var Qe;if(Te.deviceType(Je.getState())===v.DeviceType.DESKTOP){var Ze=new m.MouseOut(e.getModuleByClass(L.DOMClient));Qe=new b.DesktopExitIntention(Ze,b.IS_FIREFOX_MAC),Xe.push(Ze),Xe.push(Qe)}else{var $e=new E.PageVisibility(document),et=new O.PageFocusGain(e.getModuleByClass(U.WindowClient),$e),tt=new O.PageFocusLoss(e.getModuleByClass(U.WindowClient),$e);Qe=new _.MobileExitIntention(et,tt,B),Xe.push($e),Xe.push(et),Xe.push(tt),Xe.push(Qe)}Qe.dispatchAs(Ie.exitIntent,Je);var nt=new S.PageUrl(e.getModuleByClass(U.WindowClient));nt.dispatchAs(oe.pageUrlUpdated,Je);var rt=new ee.PageView(B,Je),ot=new w.CanonicalisedPageUrl(nt);Xe.push(nt),Xe.push(rt),Xe.push(ot);var it=J.CachingObservable.cache(X.Observable.fromSelector(de.session,Je));if(Xe.push(t(it,de.session,Je)),G.scraping){var st=new C.PageElementValueCreator(De,Je),at=new P.PageCreator(st,Je),ut=at.create(G.scraping.pageTypes);Xe.push(ut)}else d.logger.error({},"No scraping configuration present");var ct=new g.AsyncWorker,lt=new Z.RandomSource,pt=new M.TriggerFactory(Qe),ft=new A.ExpressionFactory(ze),dt=new V.SplitSelector,gt=new k.CollectionSelector(Je,dt),yt=new ne.ValidationRuleCreator,ht=new te.FormCreator(yt,B),vt=new N.ExecutionCollectionCreator(new D.ExecutionComponentCreator(De,je,ke,pt,ft,ht,window,B,Je,n.versionInfo.tag),ft,Te.deviceType(Je.getState())),mt=new j.ExecutionCollectionController(G.campaigns,vt,gt,ct,lt,window.navigator,j.DEVICE_BLACKLIST,Je);Xe.push(mt),mt.connectToStore(Je);var bt=X.Observable.fromSelector(H.lastComponentSubmitted,Je);Xe.push(t(bt,H.lastComponentSubmitted,Je));var _t=new q.VisitorType(it);Xe.push(_t);var Et=o(ze),Ot=X.Observable.fromSelector(ge.geolocationCountry,Je);Xe.push(t(Ot,ge.geolocationCountry,Je));var St=X.Observable.fromSelector(pe.user,Je);Xe.push(t(St,pe.user,Je));var wt=X.Observable.fromSelector(Y.secondsSinceLastImpression,Je);Xe.push(t(wt,Y.secondsSinceLastImpression,Je));var Ct=X.Observable.fromSelector(le.urlsVisitedDataLayerValues,Je);Xe.push(t(Ct,le.urlsVisitedDataLayerValues,Je));var Pt=X.Observable.fromSelector(ie.pageViewsDatalayerValues,Je);Xe.push(t(Pt,ie.pageViewsDatalayerValues,Je));var It=X.Observable.fromSelector(I.domainEntityPropertyVariables,Je);Xe.push(t(It,I.domainEntityPropertyVariables,Je));var Tt=X.Observable.fromSelector(fe.secondsSinceCampaignLastImpressions,Je);Xe.push(t(Tt,fe.secondsSinceCampaignLastImpressions,Je));var Rt=X.Observable.fromSelector(ye.dynamicCouponDataLayerValues,Je);Xe.push(t(Rt,ye.dynamicCouponDataLayerValues,Je));var xt=fe.secondsSinceCampaignLastImpressions(Je.getState());u.entries(xt).forEach(function(e){var t=e.key,n=(e.value,X.Observable.pluck(Tt,t));ze.registerValue(t,J.CachingObservable.cache(n),h.DataLayerType.NUMBER)});var At=X.Observable.fromSelector(Te.deviceType,Je);ze.registerValue("device",J.CachingObservable.cache(At),h.DataLayerType.STRING),Et("device"),ze.registerValue("currentUrl",ot,h.DataLayerType.STRING),Et("currentUrl"),ze.registerValue("session/referrer",J.CachingObservable.cache(X.Observable.pluck(it,"sessionReferrer")),h.DataLayerType.STRING),Et("session/referrer"),ze.registerValue("user/location/country",J.CachingObservable.cache(Ot),h.DataLayerType.STRING),Et("user/location/country"),ze.registerValue("user/hasPurchased",J.CachingObservable.cache(X.Observable.pluck(St,"hasPurchased")),h.DataLayerType.BOOLEAN),Et("user/hasPurchased"),ze.registerValue("user/isLead",J.CachingObservable.cache(X.Observable.pluck(St,"isLead")),h.DataLayerType.BOOLEAN),Et("user/isLead"),ze.registerValue("visitorType",_t,h.DataLayerType.STRING),Et("visitorType"),ze.registerValue("secondsSinceLastImpression",J.CachingObservable.cache(wt),h.DataLayerType.NUMBER),ze.registerValue("lastExecutionComponentSubmitted",J.CachingObservable.cache(bt),h.DataLayerType.STRING),Et("lastExecutionComponentSubmitted");for(var Mt in le.urlsVisitedDataLayerValues(Je.getState()))ze.registerValue(Mt,J.CachingObservable.cache(X.Observable.pluck(Ct,Mt)),h.DataLayerType.BOOLEAN),Et(Mt);for(var Mt in ye.dynamicCouponDataLayerValues(Je.getState()))ze.registerValue(Mt,J.CachingObservable.cache(X.Observable.pluck(Rt,Mt)),h.DataLayerType.BOOLEAN),Et(Mt);for(var Lt=0,Nt=u.keys(ie.pageViewsDatalayerValues(Je.getState()));Lt<Nt.length;Lt++){var Mt=Nt[Lt];ze.registerValue(Mt,J.CachingObservable.cache(X.Observable.pluck(Pt,Mt)),h.DataLayerType.NUMBER),Et(Mt)}var Dt=I.domainEntityPropertyVariables(Je.getState());for(var Mt in Dt){var jt=Dt[Mt];ze.registerValue(I.propertyDatalayerKey(jt),J.CachingObservable.cache(X.Observable.pluck(X.Observable.pluck(It,Mt),"value")),I.propertyDatalayerDataType(jt)),Et(I.propertyDatalayerKey(jt))}for(d.logger.debug({numModels:Xe.length},"Starting models");Xe.length>0;)Xe.pop().start();d.logger.debug({executionCollectionController:mt},"Initialisation complete"),r("session",it),r("executionCollectionControllerEvent",mt.getEventObservable());var kt=c.newJsonRpcClient({gatewayEndpoint:G.gatewayEndpoint,send:l.sendHttpRequest,uuidGenerator:u.generateUUID,version:n.versionInfo.tag});Oe.updateGeolocation(Je,kt),_e.updatePageViews(Je,kt),Me.updateDynamicCouponAvailability(Je,kt),Ee.watchSession(Je),T.domainEntityPropertyUpdateDispatcher(Je,function(e){Je.dispatch(a.domainEntityPropertyUpdated(e))}),Se.saleEventDispatcher(Je,u.generateUUID,function(e){Je.dispatch(e)}),Me.autoApplyCoupon(Je,De),xe.domainEntityPropertyUpdateLogger(Je),Ae.updateUserProfile(Je,kt),Ae.watchUserProfile(Je),Le.onChange(pe.lastSeenCoupon,Je,function(e){return d.logger.debug({code:e},"Last seen coupon updated")})}).then(u.noop,function(e){d.logger.error({error:e},"Error in main.ts (initial promise chain)")})}catch(Be){d.logger.error({error:Be},"Error in main.ts (sync try catch)")}},{"../lib/AsyncWorker":139,"../lib/CachingObservable":142,"../lib/Logger":145,"../lib/Observable":146,"../lib/RandomSource":148,"../lib/Redux":149,"../lib/TimeProvider":151,"../lib/browser/CookieUtil":152,"../lib/browser/deviceUtil":155,"../lib/utils":163,"../sandbox/modules/cookie/Client":167,"../sandbox/modules/dom/Client":169,"../sandbox/modules/iframe/Client":171,"../sandbox/modules/local-storage/Client":174,"../sandbox/modules/window/Client":178,"../sandbox/remote-windows/CrossOriginClient":179,"../sandbox/remote-windows/RemoteWindow":181,"./api/Client":1,"./execution-components/CollectionSelector":4,"./execution-components/ExecutionCollectionController":8,"./execution-components/ExecutionCollectionCreator":9,"./execution-components/ExecutionComponentCreator":11,"./execution-components/SplitSelector":13,"./integrations/analytics/Client":21,"./model/CanonicalisedPageUrl":33,"./model/DataLayer":34,"./model/DesktopExitIntention":35,"./model/MobileExitIntention":36,"./model/MouseOut":37,"./model/PageFocus":38,"./model/PageUrl":39,"./model/PageVisibility":40,"./model/VisitorType":41,"./model/form/FormCreator":44,"./model/form/ValidationRuleCreator":48,"./model/page/PageCreator":50,"./model/page/page-elements/PageElementValueCreator":57,"./model/site/PageView":60,"./preconditions/ExpressionFactory":65,"./redux/actionListener":69,"./redux/actionRelay":70,"./redux/actionTimestamper":71,"./redux/actions/domain-entity-properties":75,"./redux/actions/exit-intent":77,"./redux/actions/log":82,"./redux/actions/page":85,"./redux/actions/window-dimensions":92,"./redux/reducers/campaign-last-impressions":93,"./redux/reducers/device":95,"./redux/reducers/domain-entity-properties":96,"./redux/reducers/dynamic-coupons":97,"./redux/reducers/geolocation":98,"./redux/reducers/last-component-submitted":100,"./redux/reducers/last-impression":101,"./redux/reducers/page":104,"./redux/reducers/session":105,"./redux/reducers/tab":106,"./redux/reducers/time":107,"./redux/reducers/urls-visited":109,"./redux/reducers/user":110,"./redux/sagas/domainEntityPropertyUpdateDispatcher":112,"./redux/sagas/domainEntityPropertyUpdateLogger":113,"./redux/sagas/dynamic-coupons":114,"./redux/sagas/geolocation":115,"./redux/sagas/pageViews":116,"./redux/sagas/saleEventDispatcher":117,"./redux/sagas/session":118,"./redux/sagas/user-profile":120,"./redux/storage":121,"./redux/tag":122,"./redux/utils":123,"./storage/cookie":125,"./storage/cookieDomainUtils":126,"./storage/thirdPartyLocalStorage":127,"./storage/thirdPartySessionStorage":128,"./storage/y2Cookie":130,"./storage/yiCookie":131,"./tracker/Emitter":132,"./tracker/EventTracker":133,"./triggers/Factory":137,"@yieldify/gendry-browser-compat":189,"@yieldify/gendry-dragonglass":212,"@yieldify/gendry-jsonrpc-clients":235}],33:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/CachingObservable"),i=e("../../lib/browser/UrlUtil"),s=function(e){function t(t){var n=e.call(this)||this;return n.pageUrl=t,n}return r(t,e),t.prototype.start=function(){var e=this;this.pageUrl.subscribe(function(t){e.process(t)})},t.prototype.process=function(e){this.publish(i.UrlUtil.canonicalise(e))},t}(o.CachingObservable);n.CanonicalisedPageUrl=s},{"../../lib/CachingObservable":142,"../../lib/browser/UrlUtil":153}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){e[e.STRING=0]="STRING",e[e.NUMBER=1]="NUMBER",e[e.BOOLEAN=2]="BOOLEAN"}(r=n.DataLayerType||(n.DataLayerType={}));var o=function(){function e(){this.values={}}return e.prototype.registerValue=function(e,t,n){if(this.values[e])throw new Error("Key already has an assigned observable: "+e);this.values[e]=new i(t,n)},e.prototype.getValue=function(e){return this.values[e]||void 0},e}();n.DataLayer=o;var i=function(){function e(e,t){this.observable=e,this.type=t}return e.prototype.getObservable=function(){return this.observable},e.prototype.getType=function(){return this.type},e}();n.DataLayerValue=i},{}],35:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable");n.IS_FIREFOX_MAC=window.navigator&&"string"==typeof window.navigator.appVersion&&window.navigator.appVersion.indexOf("Macintosh")>=0&&"string"==typeof window.navigator.userAgent&&window.navigator.userAgent.indexOf("Firefox")>=0,n.MAX_CLIENT_Y=4;var i=function(e){function t(t,n){var r=e.call(this)||this;return r.mouseOut=t,r.blockSelectBoxes=n,r}return r(t,e),t.prototype.start=function(){var e=this;this.mouseOut.filter(function(t){return(!e.blockSelectBoxes||!t.target||"SELECT"!==t.target.tagName)&&t.clientY<=n.MAX_CLIENT_Y}).subscribe(this.publish.bind(this))},t}(o.Observable);n.DesktopExitIntention=i},{"../../lib/Observable":146}],36:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable");n.FOCUSLOSS_THRESHOLD_SECONDS=5;var i=function(e){function t(t,n,r){var o=e.call(this)||this;return o.pageFocusGain=t,o.pageFocusLoss=n,o.timeProvider=r,o}return r(t,e),t.prototype.start=function(){var e=this;this.pageFocusLoss.subscribe(this.setFocusLossTimestamp.bind(this)),this.pageFocusGain.filter(function(){return e.isValidExitIntent()}).subscribe(this.publish.bind(this))},t.prototype.setFocusLossTimestamp=function(){this.focusLossTimestamp=this.timeProvider.currentTime()},t.prototype.isValidExitIntent=function(){if("undefined"!=typeof this.focusLossTimestamp){var e=(this.timeProvider.currentTime()-this.focusLossTimestamp)/1e3;if(e>=n.FOCUSLOSS_THRESHOLD_SECONDS)return!0}return!1},t}(o.Observable);n.MobileExitIntention=i},{"../../lib/Observable":146}],37:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable"),i=function(e){function t(t){var n=e.call(this)||this;return n.dom=t,n}return r(t,e),t.prototype.start=function(){this.dom.listen("html","mouseout").subscribe(this.publish.bind(this))},t}(o.Observable);n.MouseOut=i},{"../../lib/Observable":146}],38:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable"),i=function(e){function t(t,n){var r=e.call(this)||this;return r.windowClient=t,r.pageVisibility=n,r}return r(t,e),t}(o.Observable),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.start=function(){var e=this;this.windowClient.listen("blur").subscribe(this.publish.bind(this)),this.pageVisibility.filter(function(){return e.pageVisibility.isHidden()}).subscribe(this.publish.bind(this))},t}(i);n.PageFocusLoss=s;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.start=function(){var e=this;this.windowClient.listen("focus").subscribe(this.publish.bind(this)),this.pageVisibility.filter(function(){return!e.pageVisibility.isHidden()}).subscribe(this.publish.bind(this))},t}(i);n.PageFocusGain=a},{"../../lib/Observable":146}],39:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/CachingObservable"),i=function(e){function t(t){var n=e.call(this)||this;return n.windowClient=t,n}return r(t,e),t.prototype.start=function(){var e=this;this.windowClient.observeLocation().subscribe(function(t){e.publish(t.href)})},t}(o.CachingObservable);n.PageUrl=i},{"../../lib/CachingObservable":142}],40:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("@yieldify/gendry-browser-compat"),i=e("../../lib/Observable"),s="Unrecognized Page Visibility API",a=function(e){function t(t){var n=e.call(this)||this;return n.documentLike=t,n.setup(),n}return r(t,e),t.isStandardsDocumentLike=function(e){return"undefined"!=typeof e.hidden},t.isMozDocumentLike=function(e){return"undefined"!=typeof e.mozHidden},t.isMsDocumentLike=function(e){return"undefined"!=typeof e.msHidden},t.isWebkitDocumentLike=function(e){return"undefined"!=typeof e.webkitHidden},t.prototype.start=function(){o.EventTargetUtil.addEventListener(this.documentLike,this.visibilityChangeEvent,this.publish.bind(this))},t.prototype.isHidden=function(){var e=this.documentLike;if(t.isStandardsDocumentLike(e))return e.hidden;if(t.isMozDocumentLike(e))return e.mozHidden;if(t.isMsDocumentLike(e))return e.msHidden;if(t.isWebkitDocumentLike(e))return e.webkitHidden;throw new Error(s)},t.prototype.setup=function(){var e=this.documentLike;if(t.isStandardsDocumentLike(e))this.visibilityChangeEvent="visibilitychange";else if(t.isMozDocumentLike(e))this.visibilityChangeEvent="mozvisibilitychange";else if(t.isMsDocumentLike(e))this.visibilityChangeEvent="msvisibilitychange";else{if(!t.isWebkitDocumentLike(e))throw new Error(s);this.visibilityChangeEvent="webkitvisibilitychange"}},t}(i.Observable);n.PageVisibility=a},{"../../lib/Observable":146,"@yieldify/gendry-browser-compat":189}],41:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/CachingObservable"),i=e("../redux/reducers/session");n.VISITOR_TYPE={NEW:"new",RETURNING:"returning"};var s=function(e){function t(t){var n=e.call(this)||this;return n.session=t,n}return r(t,e),t.prototype.start=function(){var e=this;this.session.subscribe(function(t){e.detectVisitorType(t)})},t.prototype.detectVisitorType=function(e){var t=this.isReturningUser(e)?n.VISITOR_TYPE.RETURNING:n.VISITOR_TYPE.NEW;this.publishIfChanged(t)},t.prototype.isReturningUser=function(e){return e.sessionCount>i.STARTING_SESSION_COUNT},t}(o.CachingObservable);n.VisitorType=s},{"../../lib/CachingObservable":142,"../redux/reducers/session":105}],42:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./FormInput"),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.errorStyle={background:"#C62828","box-shadow":"0px 0px 6px 0px #C62828","border-radius":"2px"},t}return r(t,e),t.prototype.fetchValue=function(){return this.domClient.getCheckedState(this.selector)},t}(o.FormInput);n.Checkbox=i},{"./FormInput":45}],43:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../execution-components/events/FormSubmissionEvent"),i=e("../../../lib/Observable"),s=e("../../../lib/Logger"),a=function(e){function t(t,n,r,o){var i=e.call(this)||this;return i.inputs=t,i.cta=n,i.submitting=!1,i.timeProvider=r,i.ctaAction=o,i}return r(t,e),t.prototype.start=function(){var e=this;this.cta.subscribe(function(){s.logger.debug({form:e},"Submitting form"),e.submit()}),this.inputs.map(function(e){return e.setup()}),this.focusObservable=i.Observable.merge(this.inputs.map(function(e){return e.getFocusObservable()}))},t.prototype.getInputs=function(){return this.inputs},t.prototype.getFocusObservable=function(){return this.focusObservable},t.prototype.submit=function(){var e=this;if(!this.submitting)return this.submitting=!0,this.getInputValues().then(function(t){s.logger.debug({form:e},"Form submited"),e.publish(new o.FormSubmissionEvent(null,e.timeProvider,e,t,e.ctaAction)),e.submitting=!1},function(t){return e.submitting=!1,Promise.reject(t)})},t.prototype.getInputValues=function(){return Promise.all(this.inputs.map(function(e){return e.getValue()}))},t}(i.Observable);n.Form=a},{"../../../lib/Logger":145,"../../../lib/Observable":146,"../../execution-components/events/FormSubmissionEvent":16}],44:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Form"),i=e("./TextField"),s=e("./Checkbox"),a=e("../../execution-components/EventListenerObservable"),u=e("../../../lib/Creator"),c=e("../../../lib/Observable"),l=e("../../../lib/events/DOMEventType"),p=e("../../lib/utils"),f=function(e){function t(t,n){var r=e.call(this)||this;return r.ruleCreator=t,r.timeProvider=n,r}return r(t,e),t.prototype.create=function(e,t){var n=this,r=e.children.filter(function(e){return"cta"===e.type});if(1!==r.length)throw new Error("There must be one CTA for form. Got: "+r.length);var u=new a.EventListenerObservable(l.DOMEventType.SUBMIT,"form",t,(!0)),f=new a.EventListenerObservable(l.DOMEventType.CLICK,p.getElementIdSelector(r[0].id),t,(!0)),d=c.Observable.merge([u,f]);u.start();var g=e.children.filter(function(e){return"input"===e.type||"checkbox"===e.type}).map(function(e){switch(e.type){case"input":return new i.TextField(e.id,e.name,e.validationRules.map(function(e){return n.ruleCreator.create(e)}),t);case"checkbox":return new s.Checkbox(e.id,e.name,e.validationRules.map(function(e){return n.ruleCreator.create(e)}),t);default:throw new Error("Unsupported field type in form")}});return new o.Form(g,d,this.timeProvider,r[0].onClick)},t}(u.Creator);n.FormCreator=f},{"../../../lib/Creator":143,"../../../lib/Observable":146,"../../../lib/events/DOMEventType":156,"../../execution-components/EventListenerObservable":6,"../../lib/utils":31,"./Checkbox":42,"./Form":43,"./TextField":46}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=e("../../lib/utils"),i=e("../../../lib/Observable"),s=e("../../../lib/Logger"),a=e("@yieldify/gendry-dragonglass");!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ERROR=1]="ERROR"}(r||(r={}));var u=function(){function e(e,t,n,i){this.id=e,this.selector=o.getElementIdSelector(e),this.name=t,this.validationRules=n,this.domClient=i,this.styleState=r.DEFAULT}return e.prototype.setup=function(){var e=this;return this.getDefaultStyle().then(function(t){e.defaultStyle=t})},e.prototype.getValue=function(){var e=this;return this.fetchValue().then(function(t){var n=e.validateValue(t);return n.length>0?e.setErrorState(n[0]).then(function(){return Promise.reject(new Error("validation failed"))}):(e.setDefaultState(),{elementId:e.id,name:e.name,value:t})})},e.prototype.validate=function(){var e=this;return this.fetchValue().then(function(t){var n=e.validateValue(t);return 0===n.length?(e.setDefaultState(),!0):(e.setErrorState(n[0]),!1)})},e.prototype.getFocusObservable=function(){return i.Observable.merge([this.domClient.listen(this.selector,"focus"),this.domClient.listen(this.selector,"blur")])},e.prototype.validateValue=function(e){return this.validationRules.filter(function(t){return!t.validate(e)})},e.prototype.setErrorState=function(e){return this.styleState===r.ERROR?Promise.resolve():(s.logger.debug({field:this,rule:e},"setting FormInput to error state"),this.styleState=r.ERROR,this.applyStylesToElement(this.errorStyle))},e.prototype.setDefaultState=function(){return this.styleState===r.DEFAULT?Promise.resolve():(s.logger.debug({field:this},"setting FormInput to default state"),this.styleState=r.DEFAULT,this.applyStylesToElement(this.defaultStyle))},e.prototype.applyStylesToElement=function(e){var t=[];for(var n in e){var r=e[n];t.push(this.domClient.setStyle(this.selector,n,r))}return Promise.all(t).then(function(){return Promise.resolve()})},e.prototype.getDefaultStyle=function(){var e=[],t=function(t){e.push(n.domClient.getStyle(n.selector,t).then(function(e){return{key:t,value:e}}))},n=this;for(var r in this.errorStyle)t(r);var o=function(e){return void 0!==typeof e.value};return Promise.all(e).then(function(e){return a.dict(a.filter(e,o))})},e}();n.FormInput=u},{"../../../lib/Logger":145,"../../../lib/Observable":146,"../../lib/utils":31,"@yieldify/gendry-dragonglass":212}],46:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./FormInput"),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.errorStyle={"border-right":"4px solid #C62828",color:"#C62828","box-shadow":"0px 0px 6px 0px #C62828"},t}return r(t,e),t.prototype.fetchValue=function(){return this.domClient.getInputValue(this.selector)},t}(o.FormInput);n.TextField=i},{"./FormInput":45}],47:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0}),n.ValidationType={REQUIRED:"required",CHECKED:"checked",REGEX:"regex",EMAIL:"email"};var o=function(){function e(e,t){this.type=e,this.message=t}return e.prototype.getMessage=function(){return this.message},e.prototype.getType=function(){return this.type},e}();n.ValidationRule=o;var i=function(e){function t(t){return e.call(this,n.ValidationType.REQUIRED,t)||this}return r(t,e),t.prototype.validate=function(e){return e.length>0},t}(o);n.RequiredValidationRule=i;var s=function(e){function t(t){return e.call(this,n.ValidationType.CHECKED,t)||this}return r(t,e),t.prototype.validate=function(e){return e===!0},t}(o);n.CheckedValidationRule=s;var a=function(e){function t(t,r){var o=e.call(this,n.ValidationType.REGEX,t)||this;return o.regex=r,o}return r(t,e),t.prototype.validate=function(e){return 0===e.length||null!==e.match(this.regex)},t}(o);n.RegexValidationRule=a},{}],48:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./ValidationRule"),i=e("../../../lib/Creator"),s=e("@yieldify/gendry-validator-util"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(e){switch(e.type){case o.ValidationType.REQUIRED:return new o.RequiredValidationRule(e.message);case o.ValidationType.CHECKED:return new o.CheckedValidationRule(e.message);case o.ValidationType.REGEX:var t=e;return new o.RegexValidationRule(t.message,new RegExp(t.constraint));case o.ValidationType.EMAIL:return new o.RegexValidationRule(e.message,s.EMAIL_REGEXP);default:throw new Error("Unknown ValidationType: "+e.type)}},t}(i.Creator);n.ValidationRuleCreator=a},{"../../../lib/Creator":143,"./ValidationRule":47,"@yieldify/gendry-validator-util":254}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../lib/Logger"),o=function(){function e(e){this.pageTypes=e}return e.prototype.start=function(){for(var e=0,t=this.pageTypes;e<t.length;e++){var n=t[e];n.start()}},e.prototype.getPageTypes=function(){return this.pageTypes},e.prototype.getPageElement=function(e){for(var t=0,n=this.pageTypes;t<n.length;t++){var o=n[t],i=o.getElementById(e);if("undefined"!=typeof i)return i}r.logger.warn({id:e},"Unknown element id")},e}();n.Page=o},{"../../../lib/Logger":145}],50:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../lib/Creator"),i=e("../../../lib/Logger"),s=e("./PageType"),a=e("./Page"),u=function(e){function t(t,n){var r=e.call(this)||this;return r.elementCreator=t,r.store=n,r}return r(t,e),t.prototype.create=function(e){var t=this,n=e.map(function(e){for(var n=[],r=0,o=e.pageElements;r<o.length;r++){var a=o[r];try{"PageElementValue"===a.type&&n.push(t.elementCreator.create(a))}catch(u){i.logger.warn({error:u,element:a},"Error while creating PageElement")}}return new s.PageType(e.name,t.store,n)});return new a.Page(n)},t}(o.Creator);n.PageCreator=u},{"../../../lib/Creator":143,"../../../lib/Logger":145,"./Page":49,"./PageType":51}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../redux/reducers/page-scraping"),o=e("../../redux/utils"),i=function(){function e(e,t,n){this.name=e,this.store=t,this.elements=n.reduce(function(e,t){return e[t.getId()]=t,e},{})}return e.prototype.start=function(){var e=this;o.onChange(r.pageType(this.name),this.store,function(t){t.active?e.activate():e.deactivate()})},e.prototype.getName=function(){return this.name},e.prototype.getElementById=function(e){
return this.elements[e]},e.prototype.deactivate=function(){for(var e in this.elements)this.elements[e].stop()},e.prototype.activate=function(){for(var e in this.elements)this.elements[e].start()},e}();n.PageType=i},{"../../redux/reducers/page-scraping":103,"../../redux/utils":123}],52:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PageElementValue"),i=e("./NumericPageElementValue"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.parse=function(e){try{return e=this.cleanNumber(e),parseFloat(e)}catch(t){throw new Error(o.PARSING_ERROR)}},t}(i.NumericPageElementValue);n.FloatPageElementValue=s},{"./NumericPageElementValue":54,"./PageElementValue":56}],53:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PageElementValue"),i=e("./NumericPageElementValue"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.parse=function(e){try{return e=this.cleanNumber(e),parseInt(e,10)}catch(t){throw new Error(o.PARSING_ERROR)}},t}(i.NumericPageElementValue);n.IntegerPageElementValue=s},{"./NumericPageElementValue":54,"./PageElementValue":56}],54:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PageElementValue"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.cleanNumber=function(e){return e.replace(/\s/g,"").replace(/[.,]([0-9]{3,})/g,"$1").replace(/,([0-9]{0,2})$/,".$1")},t}(o.PageElementValue);n.NumericPageElementValue=i},{"./PageElementValue":56}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){this.id=e,this.type=t}return e.prototype.getId=function(){return this.id},e.prototype.getType=function(){return this.type},e}();n.PageElement=r},{}],56:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../../lib/CachingObservable"),i=e("../../../../lib/Logger"),s=e("./PageElement"),a=e("../../../redux/actions/page-elements");n.WRONG_LENGTH_ERROR="PageElementValue support only one value",n.PARSING_ERROR="PageElementValue value could not be parsed";var u=function(e){function t(t,n,r,i,s,u,c){var l=e.call(this,t,"PageElementValue")||this;return l.selector=n,l.dataType=r,l.setRegex(i),l.attr=s,l.domClient=u,l.value=new o.CachingObservable,l.running=!1,l.store=c,l.value.subscribe(function(e){l.store.dispatch(a.pageElementValueUpdated(l.getId(),e))}),l}return r(t,e),t.prototype.getDataType=function(){return this.dataType},t.prototype.getValue=function(){return this.value},t.prototype.setRegex=function(e){e&&(this.regex=new RegExp(e))},t.prototype.start=function(){var e=this;return this.running?Promise.resolve():(this.running=!0,this.createScraper().then(function(t){e.remoteValueScraper=t,e.remoteValueScraper.getValuesObservable().subscribe(function(t){try{var n=e.parse(e.applyRegex(e.extractElementValue(t)));e.value.publishIfChanged(n),i.logger.debug({pageElementValue:e,value:n},"PageElementValue scraped successfully")}catch(r){i.logger.debug({pageElementValue:e,error:r},"PageElementValue scraping failed"),e.value.publishIfChanged(null)}}),e.remoteValueScraper.start()},function(t){""===e.selector?i.logger.debug({id:e.getId()},"Empty selector for PageElementValue"):i.logger.error({id:e.getId(),selector:e.selector,attr:e.attr,message:t.message},"Unable to create value scraper"),e.value.publishIfChanged(null)}))},t.prototype.stop=function(){var e=this;return"undefined"==typeof this.remoteValueScraper?void this.value.publishIfChanged(null):void(this.running&&(this.running=!1,this.remoteValueScraper.stop().then(function(){e.running||e.value.publishIfChanged(null)})))},t.prototype.toJSON=function(){return{attr:this.attr,dataType:this.dataType,id:this.getId(),running:this.running,selector:this.selector,type:this.getType(),value:this.value}},t.prototype.createScraper=function(){return this.domClient.createValueScraper(this.selector,this.attr)},t.prototype.applyRegex=function(e){if(!this.regex)return e;var t=this.regex.exec(e);if(!t)throw new Error(n.PARSING_ERROR);return t[0]},t.prototype.extractElementValue=function(e){if(1!==e.length)throw new Error(n.WRONG_LENGTH_ERROR);return e[0]},t}(s.PageElement);n.PageElementValue=u},{"../../../../lib/CachingObservable":142,"../../../../lib/Logger":145,"../../../redux/actions/page-elements":84,"./PageElement":55}],57:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../../lib/Creator"),i=e("../../../config"),s=e("./StringPageElementValue"),a=e("./IntegerPageElementValue"),u=e("./FloatPageElementValue"),c=function(e){function t(t,n){var r=e.call(this)||this;return r.domClient=t,r.store=n,r}return r(t,e),t.prototype.create=function(e){switch(e.dataType){case i.ValueSourceDataType.STRING:return new s.StringPageElementValue(e.id,e.selector,e.dataType,e.regex,e.attr,this.domClient,this.store);case i.ValueSourceDataType.INTEGER:return new a.IntegerPageElementValue(e.id,e.selector,e.dataType,e.regex,e.attr,this.domClient,this.store);case i.ValueSourceDataType.FLOAT:return new u.FloatPageElementValue(e.id,e.selector,e.dataType,e.regex,e.attr,this.domClient,this.store);default:throw new Error("Unknown PageElementValue data type in configuration "+e.type)}},t}(o.Creator);n.PageElementValueCreator=c},{"../../../../lib/Creator":143,"../../../config":3,"./FloatPageElementValue":52,"./IntegerPageElementValue":53,"./StringPageElementValue":58}],58:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PageElementValue"),i=e("../../../../lib/Logger");n.MAX_SCRAPED_STRING_LENGTH=256;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.parse=function(e){if(e.length>n.MAX_SCRAPED_STRING_LENGTH)throw i.logger.error({length:e.length,pageElementValue:this},"Scraped string value is longer than the max limit"),new Error("Scraped value is too long");return e},t}(o.PageElementValue);n.StringPageElementValue=s},{"../../../../lib/Logger":145,"./PageElementValue":56}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../../lib/CachingObservable"),o=function(){function e(e,t){this.id=e,this.domClient=t,this.valuesObservable=new r.CachingObservable}return e.prototype.start=function(){var e=this;this.domClient.startScraping(this.id).subscribe(function(t){e.valuesObservable.publishIfChanged(t)})},e.prototype.stop=function(){return this.domClient.stopScraping(this.id)},e.prototype.getValuesObservable=function(){return this.valuesObservable},e}();n.RemoteValueScraper=o},{"../../../../lib/CachingObservable":142}],60:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PageViewEvent"),i=e("../../../lib/CachingObservable"),s=e("../../redux/utils"),a=e("../../redux/reducers/page"),u=e("../../redux/reducers/session"),c=function(e){function t(t,n){var r=e.call(this)||this;return r.timeProvider=t,r.store=n,r}return r(t,e),t.prototype.start=function(){var e=this;s.onChange(a.currentPageUrl,this.store,function(t){e.publish(new o.PageViewEvent(t,e.timeProvider,u.currentReferrer(e.store.getState())))})},t}(i.CachingObservable);n.PageView=c},{"../../../lib/CachingObservable":142,"../../redux/reducers/page":104,"../../redux/reducers/session":105,"../../redux/utils":123,"./PageViewEvent":61}],61:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../execution-components/events/UserJourneyEvent"),i=function(e){function t(t,n,r){var o=e.call(this,null,n)||this;return o.url=t,o.referrer=r,o}return r(t,e),t.prototype.getUrl=function(){return this.url},t.prototype.getReferrer=function(){return this.referrer},t}(o.UserJourneyEvent);n.PageViewEvent=i},{"../../execution-components/events/UserJourneyEvent":19}],62:[function(e,t,n){"use strict";function r(e){return new d(f.AND,e)}function o(e){return new d(f.OR,e)}function i(e){return new d(f.NOT,[e])}function s(){return new p.LiteralExpression((!0))}function a(){return new p.LiteralExpression((!1))}function u(e,t){return new d(f.EQUALS,[e,t])}var c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var l=e("./Expression"),p=e("./LiteralExpression");n.and=r,n.or=o,n.not=i,n.alwaysTrue=s,n.alwaysFalse=a;var f;!function(e){e[e.AND=0]="AND",e[e.OR=1]="OR",e[e.NOT=2]="NOT",e[e.EQUALS=3]="EQUALS"}(f||(f={})),n.equals=u,n.OPERATIONS={equals:u};var d=function(e){function t(t,n){var r=e.call(this,n)||this;if(r.type=t,r.type===f.NOT&&1!==n.length)throw new Error("NOT can only be used with exactly one subexpression.");if(r.type!==f.NOT&&0===n.length)throw new Error("Must specify at least one subexpression.");if(r.type===f.EQUALS&&2!==n.length)throw new Error("EQUALS can only be used with exactly two subexpressions.");return r}return c(t,e),t.isNull=function(e){return null===e||void 0===e},t.prototype.evaluate=function(e){var n=null;switch(this.type){case f.AND:n=!0;for(var r=0,o=e;r<o.length;r++){var i=o[r];if(t.isNull(i))return null;i===!1&&(n=!1)}return n;case f.OR:for(var s=0,a=e;s<a.length;s++){var u=a[s];if(u===!0)return!0;u===!1&&(n=!1)}return n;case f.NOT:var c=e[0];return t.isNull(c)?null:!c;case f.EQUALS:var l=e[0],p=e[1];return t.isNull(l)||t.isNull(p)?null:l===p;default:throw new Error("Unexpected type of: "+this.type)}},t}(l.Expression)},{"./Expression":63,"./LiteralExpression":66}],63:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/CachingObservable"),i=function(e){function t(t){var n=e.call(this)||this;n.subexpressions=t;for(var r=0,o=n.subexpressions;r<o.length;r++){var i=o[r];if(!i)throw new Error("Subexpression objects must not be null")}return n}return r(t,e),t.prototype.start=function(){for(var e=0,t=this.subexpressions;e<t.length;e++){var n=t[e];n.subscribe(this.getObserverFunction()),n.start()}this.eval()},t.prototype.getSubexpressionValues=function(){for(var e=[],t=0,n=this.subexpressions;t<n.length;t++){var r=n[t];e.push(r.getCurrentValue())}return e},t.prototype.getObserverFunction=function(){return this.eval.bind(this)},t.prototype.eval=function(){this.publishIfChanged(this.evaluate(this.getSubexpressionValues()))},t}(o.CachingObservable);n.Expression=i},{"../../lib/CachingObservable":142}],64:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Expression"),i=function(e){function t(t){var n=e.call(this,[])||this;if(!t)throw new Error("adaptee must be not null or undefined");return n.adaptee=t,n}return r(t,e),t.prototype.start=function(){this.adaptee.subscribe(this.getObserverFunction()),e.prototype.start.call(this)},t.prototype.evaluate=function(){return this.adaptee.getCurrentValue()},t}(o.Expression);n.ExpressionAdaptor=i},{"./Expression":63}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./BooleanExpression"),o=e("./NumericExpression"),i=e("./StringExpression"),s=e("../model/DataLayer"),a=e("./ExpressionAdaptor"),u=e("./LiteralExpression"),c=function(){function e(e){this.dataLayer=e}return e.prototype.createExpression=function(e){var t=this;return 0===e.length?r.alwaysTrue():r.and(e.map(function(e){return 0===e.length?r.alwaysTrue():r.or(e.map(function(e){return t.createSubExpression(e)}))}))},e.prototype.createSubExpression=function(e){if("noop"===e.op)return r.alwaysTrue();var t=e.attr,n=e.op,a=e.val,u=0===n.indexOf("not");u&&(n=n.charAt(3).toLowerCase()+n.slice(4));var c=this.dataLayer.getValue(t);if(!c)throw new Error("Unsupported precondition attr: "+t);var l;switch(c.getType()){case s.DataLayerType.STRING:var p=a;l=this.composeExpression(c,n,p,i.OPERATIONS);break;case s.DataLayerType.NUMBER:var f=a;l=this.composeExpression(c,n,f,o.OPERATIONS);break;case s.DataLayerType.BOOLEAN:var d=a;l=this.composeExpression(c,n,d,r.OPERATIONS);break;default:throw new Error("Unsupported DataLayerType of "+c.getType())}return u&&(l=r.not(l)),l},e.prototype.composeExpression=function(e,t,n,r){var o=r[t];if(!o)throw new Error("Unsupported precondition op: "+t);switch(t){case"in":case"between":if(!(n instanceof Array))throw new Error("Expected val to be an array.");break;default:if(n instanceof Array)throw new Error("Expected val to be a literal.")}return o(new a.ExpressionAdaptor(e.getObservable()),new u.LiteralExpression(n))},e}();n.ExpressionFactory=c},{"../model/DataLayer":34,"./BooleanExpression":62,"./ExpressionAdaptor":64,"./LiteralExpression":66,"./NumericExpression":67,"./StringExpression":68}],66:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Expression"),i=function(e){function t(t){var n=e.call(this,[])||this;return n.literalValue=t,n}return r(t,e),t.prototype.evaluate=function(){return this.literalValue},t}(o.Expression);n.LiteralExpression=i},{"./Expression":63}],67:[function(e,t,n){"use strict";function r(e,t){return new f(p.EQUALS,e,t)}function o(e,t){return new f(p.BETWEEN,e,t)}function i(e,t){return new f(p.GREATER_THAN,e,t)}function s(e,t){return new f(p.LESS_THAN,e,t)}function a(e,t){return new f(p.IN,e,t)}var u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var c=e("./Expression"),l=e("../../lib/Logger");n.equals=r,n.between=o,n.greaterThan=i,n.lessThan=s,n.inArray=a,n.OPERATIONS={"in":a,between:o,equals:r,greaterThan:i,lessThan:s};var p;!function(e){e[e.EQUALS=0]="EQUALS",e[e.BETWEEN=1]="BETWEEN",e[e.LESS_THAN=2]="LESS_THAN",e[e.GREATER_THAN=3]="GREATER_THAN",e[e.IN=4]="IN"}(p||(p={}));var f=function(e){function t(t,n,r){var o=e.call(this,[n,r])||this;return o.type=t,o}return u(t,e),t.prototype.evaluate=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(null==r)return null}var o=e[0],i=e[1];switch(this.type){case p.EQUALS:return o===i;case p.LESS_THAN:return o<i;case p.GREATER_THAN:return o>i;case p.BETWEEN:var s=i[0],a=i[1];return"number"!=typeof s||"number"!=typeof a||2!==i.length?(l.logger.error({range:i},"Invalid range for a numeric between expression"),null):s<=o&&o<=a;case p.IN:return i.indexOf(o)>=0;default:throw new Error("Unexpected type of: "+this.type)}},t}(c.Expression)},{"../../lib/Logger":145,"./Expression":63}],68:[function(e,t,n){"use strict";function r(e,t){return new l(c.EQUALS,e,t)}function o(e,t){return new l(c.CONTAINS,e,t)}function i(e,t){return new l(c.STARTS_WITH,e,t)}function s(e,t){return new l(c.IN,e,t)}var a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var u=e("./Expression");n.equals=r,n.contains=o,n.startsWith=i,n.inArray=s,n.OPERATIONS={"in":s,equals:r,contains:o,startsWith:i};var c;!function(e){e[e.EQUALS=0]="EQUALS",e[e.CONTAINS=1]="CONTAINS",e[e.STARTS_WITH=2]="STARTS_WITH",e[e.IN=3]="IN"}(c||(c={}));var l=function(e){function t(t,n,r){var o=e.call(this,[n,r])||this;return o.type=t,o}return a(t,e),t.prototype.evaluate=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(null===r||void 0===r)return null}var o=e[0],i=e[1];switch(this.type){case c.EQUALS:return o===i;case c.CONTAINS:return o.indexOf(i)>=0;case c.STARTS_WITH:return 0===o.indexOf(i);case c.IN:return i.indexOf(o)>=0;default:throw new Error("Unexpected type of: "+this.type)}},t}(u.Expression)},{"./Expression":63}],69:[function(e,t,n){"use strict";function r(e,t){return function(n){return function(r){return function(o){var i=n;e&&e(o,i);var s=r(o);return t&&t(o,i),s}}}}Object.defineProperty(n,"__esModule",{value:!0}),n.actionListenerMiddleware=r},{}],70:[function(e,t,n){"use strict";function r(e,t){return{type:"REMOTE_STORE_CREATED",client:e,id:t}}function o(e){var t=[];return function(r){return function(r){return function(o){if("REMOTE_STORE_CREATED"===o.type)return t.push(o.client),null;o.actionMeta=o.actionMeta||{};var a=o.actionMeta.relay||{source:e,senders:[]};if(a.senders.indexOf(e)!==-1)return null;var u=r(o);if(e===n.SANDBOX_SOURCE&&a.source!==n.SANDBOX_SOURCE)return u;var c=s.shallowClone(o);c.actionMeta.relay=i({},a,{senders:a.senders.concat([e])});for(var l=0,p=t;l<p.length;l++){var f=p[l];f.dispatch(c)}return u}}}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("@yieldify/gendry-dragonglass");n.SANDBOX_SOURCE="sandbox",n.remoteStoreCreated=r,n.actionRelayMiddleware=o},{"@yieldify/gendry-dragonglass":212}],71:[function(e,t,n){"use strict";function r(e){return function(t){return function(t){return function(n){var r=o({},n,{actionMeta:o({},n.actionMeta||{},{timestamp:e.currentTime()})});return t(r)}}}}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.actionTimestamperMiddleware=r},{}],72:[function(e,t,n){"use strict";function r(e){return o({type:"BLOCKED_IMPRESSION"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.blockedImpression=r},{}],73:[function(e,t,n){"use strict";function r(e){return o({type:"CLICK_THROUGH"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.clickThrough=r},{}],74:[function(e,t,n){"use strict";function r(e){return o({type:"CLOSE_EVENT"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.closeEvent=r},{}],75:[function(e,t,n){"use strict";function r(e){return{type:"DOMAIN_ENTITY_PROPERTIES_SYNC",state:e}}function o(e){return{type:"DOMAIN_ENTITY_PROPERTY_UPDATED",entity:e.entity,property:e.property,previousValue:e.previousValue,newValue:e.newValue,dataType:e.dataType}}Object.defineProperty(n,"__esModule",{value:!0}),n.domainEntityPropertiesSync=r,n.domainEntityPropertyUpdated=o},{}],76:[function(e,t,n){"use strict";function r(e){var t=e.availability;return{type:"COUPON_AVAILABILITY_RECEIVED",availability:t}}function o(e,t){return{type:"COUPON_CODE_SEEN",code:e,autoApply:t}}function i(e){return{type:"COUPON_CODE_APPLIED",code:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.couponAvailabilityReceived=r,n.couponCodeSeen=o,n.couponApplied=i},{}],77:[function(e,t,n){"use strict";function r(){return{type:"EXIT_INTENT"}}Object.defineProperty(n,"__esModule",{value:!0}),n.exitIntent=r},{}],78:[function(e,t,n){"use strict";function r(e){return o({type:"FORM_SUBMIT"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.formSubmit=r},{}],79:[function(e,t,n){"use strict";function r(e){return void 0===e&&(e=null),{location:{country:e},type:"GEOLOCATION_RECEIVED"}}Object.defineProperty(n,"__esModule",{value:!0}),n.geolocationReceived=r},{}],80:[function(e,t,n){"use strict";function r(e){return o({type:"IMPRESSION"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.impression=r},{}],81:[function(e,t,n){"use strict";function r(e){return{type:"LAST_COMPONENT_SUBMITTED",componentUuid:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.updateLastComponentSubmitted=r},{}],82:[function(e,t,n){"use strict";function r(e){return{type:"LOG_MESSAGE",log:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.logMessage=r},{}],83:[function(e,t,n){"use strict";function r(e){return{overlayId:e,type:"OVERLAY_LOADING"}}function o(e){return{overlayId:e,type:"OVERLAY_READY"}}function i(e){return{overlayId:e,type:"OVERLAY_ERROR"}}function s(e){return{overlayId:e,type:"OVERLAY_VISIBLE"}}function a(e){return{overlayId:e,type:"OVERLAY_CLOSED"}}Object.defineProperty(n,"__esModule",{value:!0}),n.overlayLoading=r,n.overlayReady=o,n.overlayError=i,n.overlayVisible=s,n.overlayClosed=a},{}],84:[function(e,t,n){"use strict";function r(e,t){return{type:"PAGE_ELEMENT_VALUE_UPDATED",id:e,value:t}}function o(e){return{type:"PAGE_SCRAPING_SYNC",scraping:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.pageElementValueUpdated=r,n.pageScrapingSync=o},{}],85:[function(e,t,n){"use strict";function r(e){return{type:"PAGE_URL_UPDATED",url:e}}function o(e,t){return{type:"PAGE_VIEWS_RECEIVED",url:e,day:t.views.day,hour:t.views.hour,minute:t.views.minute}}function i(e,t){return{type:"PAGE_VIEWS_SYNC",url:e,day:t.day,hour:t.hour,minute:t.minute}}Object.defineProperty(n,"__esModule",{value:!0}),n.pageUrlUpdated=r,n.pageViewsReceived=o,n.pageViewsSync=i},{}],86:[function(e,t,n){"use strict";function r(e){return o({type:"SALE_DETECTED"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.saleDetected=r},{}],87:[function(e,t,n){"use strict";function r(e){return{type:"NEW_SESSION_STARTED",sessionCount:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.newSessionStarted=r},{}],88:[function(e,t,n){"use strict";function r(e){return{type:"TICK",timestamp:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.tick=r},{}],89:[function(e,t,n){"use strict";function r(e){return{type:"TRACKABLE_REQUEST_START",requestId:e}}function o(e){return{type:"TRACKABLE_REQUEST_SUCCESS",requestId:e}}function i(e){return{type:"TRACKABLE_REQUEST_FAIL",requestId:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.trackableRequestStart=r,n.trackableRequestSuccess=o,n.trackableRequestFail=i},{}],90:[function(e,t,n){"use strict";function r(e){return{type:"USER_PROFILE_RECEIVED",profile:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.userProfileReceived=r},{}],91:[function(e,t,n){"use strict";function r(e){return{type:"USER_SYNC",userId:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.userSync=r},{}],92:[function(e,t,n){"use strict";function r(e){return{type:"WINDOW_DIMENSIONS_UPDATED",dimensions:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.windowDimensionsUpdated=r},{}],93:[function(e,t,n){"use strict";function r(e){return"campaigns/byId/"+e+"/secondsSinceLastImpression"}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("@yieldify/gendry-dragonglass"),s=e("./config"),a=e("./time"),u=e("./user"),c=e("./labelled-last-impressions");n.campaignLastImpressionDataLayerKey=r,n.labelledLastImpressionTimestamps=i.selector(c.labelledLastImpressions,function(e){return i.dict(i.map(i.entries(e),function(e){var t=e.key,n=e.value;return{key:c.labelledLastImpressionDatalayerKey(t),value:n}}))}),n.campaignLastImpressionTimestamps=i.mapSelector({targetedIds:s.historicallyTargetedCampaignIds,profileData:u.userProfileCampaigns},function(e){for(var t=e.targetedIds,n=e.profileData,o={},i=0,s=t;i<s.length;i++){var a=s[i],u=r(a);o[u]=n[a]?n[a].lastImpression:null}return o}),n.secondsSinceCampaignLastImpressions=i.mapSelector({labelled:n.labelledLastImpressionTimestamps,ids:n.campaignLastImpressionTimestamps,current:a.time},function(e){var t=e.labelled,n=e.ids,r=e.current,s=o({},t,n);return i.dictMapValues(s,function(e){if(null===e)return r;var t=Math.floor((r-e)/1e3);return t>0?t:0})})},{"./config":94,"./labelled-last-impressions":99,"./time":107,"./user":110,"@yieldify/gendry-dragonglass":212}],94:[function(e,t,n){"use strict";function r(e){return e}function o(e,t){return e}function i(e){return u.distinct(e.reduce(function(e,t){return"dynamic-coupon"===t.type?e.concat([t.couponListId]):e},[]))}function s(e){try{var t=!1;return u.traverseExpression(e,{outOf:function(e){return"variable"!==e.type||"pageviews.m"!==e.name&&"pageviews.h"!==e.name&&"pageviews.d"!==e.name||(t=!0),e}}),t}catch(n){return c.logger.error({error:n,expression:e},"Unable to traverse expression, social proof enabled"),!0}}function a(e){switch(e.type){case"body":case"cta":case"text":case"coupon":case"input":case"checkbox":return void 0!==e.text&&"string"!=typeof e.text&&s(e.text);case"form":return u.some(e.children,a);case"advanced-component":case"dynamic-coupon":return!1;default:return c.logger.error({element:e},"Unrecognised overlay element, social proof enabled"),!0}}Object.defineProperty(n,"__esModule",{value:!0});var u=e("@yieldify/gendry-dragonglass"),c=e("../../../lib/Logger"),l=e("../../../lib/utils");n.HISTORICAL_TARGETING_REGEXP=/^campaigns\/byId\/(\d*)\/secondsSinceLastImpression$/,n.initialConfigState=r,n.configReducer=o,n.tagConfig=function(e){return e.config},n.organisationId=function(e){return e.config.organisationId},n.websiteId=function(e){return e.config.websiteId},n.websiteCurrency=function(e){return e.config.websiteCurrency},n.campaigns=function(e){return e.config.campaigns},n.websiteFlagActive=function(e){return u.selector(n.tagConfig,function(t){return u.some(t.featureFlags,function(t){return t===e})})},n.allCollections=u.selector(n.campaigns,function(e){return u.flatten(u.map(e,function(e){return e.collections}))}),n.allTargetRules=u.selector(n.allCollections,function(e){return u.flatten(u.flatten(u.map(e,function(e){return e.targetRules})))}),n.allOverlays=u.selector(n.allCollections,function(e){return u.flatten(u.map(e,function(e){return e.components.filter(p)}))});var p=function(e){return"Overlay"===e.type};n.allOverlayElements=u.selector(n.allOverlays,function(e){return u.flatten(u.map(e,function(e){return e.settings.overlayElements}))}),n.dynamicCouponListIds=u.selector(n.allOverlayElements,i),n.historicallyTargetedCampaignIds=u.selector(n.allTargetRules,function(e){return u.distinct(u.compact(u.map(e,function(e){var t=e.attr.match(n.HISTORICAL_TARGETING_REGEXP);if(null!==t)return t[1]})))});var f=function(e,t){return u.some(e,function(e){return u.some(e.collections,function(e){return u.some(e.targetRules,function(e){return u.some(e,t)})})})};n.userProfileRequired=function(e){return l.isDebugMode()||f(e.config.campaigns,function(e){return n.HISTORICAL_TARGETING_REGEXP.test(e.attr)})},n.geolocationRequired=function(e){return f(e.config.campaigns,function(e){return"user/location/country"===e.attr})},n.socialProofRequired=function(e){var t=f(e.config.campaigns,function(e){return"pageViews/minuteInterval"===e.attr||"pageViews/hourInterval"===e.attr||"pageViews/dayInterval"===e.attr}),n=u.some(e.config.campaigns,function(e){return u.some(e.collections,function(e){return u.some(e.components,function(e){return"Overlay"===e.type&&u.some(e.settings.overlayElements,a)})})});return t||n},n.pageElementConfig=function(e){return function(t){var n=u.flatten(t.config.scraping.pageTypes.map(function(e){return e.pageElements}));return u.find(n,function(t){
return t.id===e})}}},{"../../../lib/Logger":145,"../../../lib/utils":163,"@yieldify/gendry-dragonglass":212}],95:[function(e,t,n){"use strict";function r(e,t){return e}Object.defineProperty(n,"__esModule",{value:!0}),n.deviceReducer=r,n.deviceType=function(e){return e.device}},{}],96:[function(e,t,n){"use strict";function r(e,t,n){var r;if(n.deps&&(r=n.deps[e]),void 0!==r&&null!==r&&t===r.sc)return r.val}function o(e,t,n){return e.scraping&&e.scraping.domainEntities?O.dict(O.flatten(e.scraping.domainEntities.map(function(e){return e.properties.map(function(o){var i=e.name+"."+o.name,a=r(i,t,n);return{key:i,value:s(i,e.name,o.name,o.dataType,o.valueSources,o.aggregation,a)}})}))):{}}function i(e,t){switch(t){case"String":return"string"==typeof e;case"Float":case"Integer":return"number"==typeof e;default:return!1}}function s(e,t,n,r,o,s,a){switch(void 0===a||null===a||i(a,r)||E.logger.error({value:a,dataType:r},"Persisted domain entity property value does not match configured data type"),r){case"String":return{name:e,entity:t,property:n,dataType:r,sources:o,aggregationType:s,persistedValue:i(a,r)?a:void 0};case"Integer":return{name:e,entity:t,property:n,dataType:r,sources:o,aggregationType:s,persistedValue:i(a,r)?a:void 0};case"Float":return{name:e,entity:t,property:n,dataType:r,sources:o,aggregationType:s,persistedValue:i(a,r)?a:void 0};default:throw new Error("Unknown DomainEntityProperty dataType: "+r)}}function a(e,t){switch(t.type){case"DOMAIN_ENTITY_PROPERTIES_SYNC":return t.state;case"NEW_SESSION_STARTED":var n={};for(var r in e)n[r]=b({},e[r],{persistedValue:void 0});return n;default:return e}}function u(e,t){for(var r=0,o=e;r<o.length;r++){var i=o[r];if(i&&"unknown"===i.type||void 0===i)return n.DEP_VALUE_UNKNOWN}var s=O.distinct(e.filter(S.isKnownValue).map(function(e){return e.value}));return 0===s.length?void 0===t?n.DEP_VALUE_NONE_MISSING:n.depValueKnown(t):s.length>1?n.DEP_VALUE_NONE_CONFLICT:n.depValueKnown(s[0])}function c(e,t){try{return t.map(function(t){var n=e[t.pageElementId];if(void 0===n||"unknown"===n.value.type)return S.PAGE_ELEMENT_VALUE_UNKNOWN;if(!l(t))return n.value;if("known"===n.value.type){var r=O.filter(t.transform,function(e){return e.from===n.value.value});if(1!==r.length)throw new Error("Invalid transforms on the element value source");return{type:"known",value:r[0].to,disappeared:!1}}return n.value})}catch(n){return n}}function l(e){return"transform"===e.type}function p(e,t){for(var r,o=0,i=e;o<i.length;o++){var s=i[o];if(void 0===s||"unknown"===s.type)return n.DEP_VALUE_UNKNOWN;if("known"===s.type){if(!s.disappeared)return n.depValueKnown(s.value);s.disappeared&&void 0===r&&(r=s.value)}}return void 0!==r?n.depValueKnown(r):void 0!==t?n.depValueKnown(t):n.DEP_VALUE_NONE_MISSING}function f(e){return"string"==typeof e}function d(e){return"number"==typeof e}function g(e,t){return null===e||void 0===e||t(e)}function y(e,t){if("known"!==t.type)return t;switch(e.dataType){case"String":return g(t.value,f)?t:n.DEP_VALUE_NONE_INVALID;case"Float":case"Integer":return g(t.value,d)?t:n.DEP_VALUE_NONE_INVALID;default:throw new Error("Unknown domain entity property datatype: "+e.dataType)}}function h(e,t){switch(e.dataType){case"String":return{name:e.name,dataType:e.dataType,value:g(t,f)?t:null};case"Float":return{name:e.name,dataType:e.dataType,value:g(t,d)?t:null};case"Integer":return{name:e.name,dataType:e.dataType,value:g(t,d)?t:null};default:throw new Error("Unknown domain entity property datatype: "+e.dataType)}}function v(e){var t;switch(m(e)){case C.DataLayerType.STRING:t="string";break;case C.DataLayerType.NUMBER:t="number";break;case C.DataLayerType.BOOLEAN:t="boolean";break;default:throw new Error("Unknown DataLayerType")}return"entity/"+t+"/"+e.name}function m(e){switch(e.dataType){case"String":return C.DataLayerType.STRING;case"Float":case"Integer":return C.DataLayerType.NUMBER;default:throw new Error("Unknown dataType for variable")}}var b=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var _=e("./config"),E=e("../../../lib/Logger"),O=e("@yieldify/gendry-dragonglass"),S=e("./page-scraping"),w=e("./session"),C=e("../../model/DataLayer");n.DEP_VALUE_UNKNOWN={type:"unknown"},n.DEP_VALUE_NONE_CONFLICT={type:"none",reason:"conflict"},n.DEP_VALUE_NONE_MISSING={type:"none",reason:"missing"},n.DEP_VALUE_NONE_AMBIGUOUS_TRANSFORMS={type:"none",reason:"ambiguous-transforms"},n.DEP_VALUE_NONE_INVALID={type:"none",reason:"invalid"},n.depValueKnown=function(e){return{type:"known",value:e}},n.initialDomainEntityPropertiesState=o,n.domainEntityPropertiesReducer=a,n.domainEntityProperties=function(e){return e.domainEntityProperties},n.domainEntityProperty=function(e){return function(t){return t.domainEntityProperties[e]}},n.domainEntityPropertyValues=O.mapSelector({elements:S.pageElements,properties:n.domainEntityProperties},function(e){var t=e.elements,r=e.properties;return O.dictMapValues(r,function(e){var r=c(t,e.sources);if(r instanceof Error)return n.DEP_VALUE_NONE_AMBIGUOUS_TRANSFORMS;switch(e.aggregationType){case"consensus":return y(e,u(r,e.persistedValue));case"priority":var o=y(e,p(r,e.persistedValue));return"basket.value"===e.name&&"none"===o.type&&(o=n.depValueKnown(0)),o;default:throw new Error("Unsupported aggregation")}})}),n.domainEntityPropertyVariables=O.mapSelector({values:n.domainEntityPropertyValues,properties:n.domainEntityProperties},function(e){var t=e.values,n=e.properties;return O.dictMapValues(n,function(e){var n=t[e.name];return h(e,"known"===n.type?n.value:null)})}),n.TRANSACTION_CURRENCY_PROPERTY="transaction.currency",n.TRANSACTION_ORDER_ID_PROPERTY="transaction.order-id",n.transactionCurrency=O.mapSelector({variables:n.domainEntityPropertyVariables,configuredCurrency:_.websiteCurrency},function(e){var t=e.configuredCurrency,r=e.variables;if("MC"!==t)return t;var o=r[n.TRANSACTION_CURRENCY_PROPERTY];return void 0===o?null:"String"!==o.dataType?null:o.value||null}),n.transactionOrderId=O.selector(n.domainEntityPropertyVariables,function(e){var t=e[n.TRANSACTION_ORDER_ID_PROPERTY];return void 0===t?null:"String"!==t.dataType?null:void 0===t.value?null:t.value}),n.domainEntityPropertyValue=function(e){return O.selector(n.domainEntityPropertyValues,function(t){return t[e]})},n.persistentDomainEntityPropertiesState=O.mapSelector({values:n.domainEntityPropertyVariables,count:w.sessionCount,props:n.domainEntityProperties},function(e){var t=e.values,n=e.count,r=e.props;return O.dict(O.compact(O.entries(t).map(function(e){var t,o=e.value.value,i=r[e.key].persistedValue;if(O.notMissing(o)){if("boolean"==typeof o)throw new Error("Boolean DEP values not supported");t=o}else{if(!O.notMissing(i))return null;t=i}return{key:e.key,value:{val:t,sc:n}}})))}),n.propertyDatalayerKey=v,n.propertyDatalayerDataType=m},{"../../../lib/Logger":145,"../../model/DataLayer":34,"./config":94,"./page-scraping":103,"./session":105,"@yieldify/gendry-dragonglass":212}],97:[function(e,t,n){"use strict";function r(){return{availability:{}}}function o(e,t){switch(t.type){case"COUPON_AVAILABILITY_RECEIVED":return s.update(e).get("availability").set(function(){return t.availability});default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@yieldify/gendry-dragonglass"),s=e("../../../lib/updater"),a=e("./config");n.initialDynamicCouponsState=r,n.dynamicCouponsReducer=o,n.couponAvailability=function(e){return e.dynamicCoupons.availability},n.dynamicCouponDataLayerValues=i.mapSelector({couponListIds:a.dynamicCouponListIds,availability:n.couponAvailability},function(e){var t=e.couponListIds,n=e.availability;return i.dict(i.map(t,function(e){return{key:"couponLists/"+e+"/hasCoupons",value:"boolean"==typeof n[e]?n[e]:null}}))})},{"../../../lib/updater":162,"./config":94,"@yieldify/gendry-dragonglass":212}],98:[function(e,t,n){"use strict";function r(){return n.DEFAULT_GEOLOCATION_STATE}function o(e,t){switch(t.type){case"GEOLOCATION_RECEIVED":return t.location;default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@yieldify/gendry-dragonglass");n.DEFAULT_GEOLOCATION_STATE={country:null},n.initialGeolocationState=r,n.geolocationReducer=o,n.geolocationCountry=function(e){return e.location.country},n.geolocationVariables=i.selector(n.geolocationCountry,function(e){return[{name:"geolocation.country",dataType:"String",value:e}]})},{"@yieldify/gendry-dragonglass":212}],99:[function(e,t,n){"use strict";function r(e){return/^\d+$/.test(e)}function o(e){return r(e)?e:f[e]}function i(e,t){var r=u.dict(e.campaigns.map(function(e){return{key:e.id.toString(),value:e.cappingLabels.map(function(t){return t===n.ID_LABEL?e.id.toString():t})}})),i=u.flatten(u.values(r)),s=u.dict(i.map(function(e){return{key:e,value:0}}).concat(t?u.entries(t).map(function(e){var t=e.key,n=e.value;return{key:o(t),value:l.getRegularTimestamp(n)}}):[]));return{lastImpressions:s,cappingLabels:r}}function s(e,t){switch(t.type){case"IMPRESSION":return c.update(e).get("lastImpressions").set(c.partial(function(){var n=e.cappingLabels[t.campaignId.toString()];return u.dict(n.map(function(e){return{key:e,value:t.timestamp}}))}));default:return e}}function a(e){var t=r(e)?"id:"+e:e;return"campaigns/byCappingLabel/"+t+"/secondsSinceLastImpression"}Object.defineProperty(n,"__esModule",{value:!0});var u=e("@yieldify/gendry-dragonglass"),c=e("../../../lib/updater"),l=e("../../storage/timestamp"),p=e("../../../lib/utils");n.FREQ_CAP_MAX_KEYS=11,n.ID_LABEL="@id";var f=p.createTranslationTable({overlay:"o"});n.translateLabel=o,n.initialLabelledLastImpressionsState=i,n.labelledLastImpressionsReducer=s,n.labelledLastImpressions=function(e){return e.labelledLastImpressions.lastImpressions},n.persistedLabelledLastImpressionState=u.selector(n.labelledLastImpressions,function(e){return u.dict(u.entries(e).sort(u._compare(function(e){return e.value})).reverse().filter(function(e,t){return t<n.FREQ_CAP_MAX_KEYS}).map(function(e){var t=e.key,n=e.value;return{key:o(t),value:l.getStorableTimestamp(n)}}))}),n.labelledLastImpressionDatalayerKey=a},{"../../../lib/updater":162,"../../../lib/utils":163,"../../storage/timestamp":129,"@yieldify/gendry-dragonglass":212}],100:[function(e,t,n){"use strict";function r(e,t){switch(t.type){case"LAST_COMPONENT_SUBMITTED":return t.componentUuid;default:return e}}Object.defineProperty(n,"__esModule",{value:!0}),n.lastComponentSubmittedReducer=r,n.lastComponentSubmitted=function(e){return e.lastComponentSubmitted}},{}],101:[function(e,t,n){"use strict";function r(e){return e?{timestamp:e.ts,campaignId:e.cpg,collectionId:e.col,componentId:e.cpi,sessionCount:e.sc,control:!!e.c}:null}function o(e,t){switch(t.type){case"IMPRESSION":return{control:t.control,collectionId:t.collectionId,campaignId:t.campaignId,componentId:t.componentId,sessionCount:t.sessionCount,timestamp:t.timestamp};default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@yieldify/gendry-dragonglass"),s=e("./time");n.initialLastImpressionState=r,n.impressionReducer=o,n.lastImpression=function(e){return e.lastImpression},n.persistentLastImpressionState=i.selector(n.lastImpression,function(e){return e?{c:e.control?1:0,col:e.collectionId,cpg:e.campaignId,cpi:e.componentId,sc:e.sessionCount,ts:e.timestamp}:null}),n.secondsSinceLastImpression=i.mapSelector({currentTime:s.time,impression:n.lastImpression},function(e){var t=e.currentTime,n=e.impression;if(!n)return t;var r=Math.floor((t-n.timestamp)/1e3);return r>0?r:0})},{"./time":107,"@yieldify/gendry-dragonglass":212}],102:[function(e,t,n){"use strict";function r(e,t){switch(t.type){case"OVERLAY_LOADING":case"OVERLAY_READY":case"OVERLAY_ERROR":case"OVERLAY_VISIBLE":case"OVERLAY_CLOSED":return a.update(e).get(t.overlayId).set(function(e){return o(e,t)});default:return e}}function o(e,t){void 0===e&&(e=s.LOADING);var n;switch(t.type){case"OVERLAY_LOADING":n=s.LOADING;break;case"OVERLAY_READY":n=s.READY;break;case"OVERLAY_ERROR":n=s.ERROR;break;case"OVERLAY_VISIBLE":n=s.VISIBLE;break;case"OVERLAY_CLOSED":n=s.CLOSED;break;default:return e}return i(e,n)?n:e}function i(e,t){return e<t}Object.defineProperty(n,"__esModule",{value:!0});var s,a=e("../../../lib/updater");!function(e){e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.VISIBLE=3]="VISIBLE",e[e.CLOSED=4]="CLOSED",e[e.ERROR=5]="ERROR"}(s=n.OverlayStatusState||(n.OverlayStatusState={})),n.overlaysReducer=r,n.overlayStatusReducer=function(e){return function(t,n){switch(n.type){case"OVERLAY_LOADING":case"OVERLAY_READY":case"OVERLAY_ERROR":case"OVERLAY_VISIBLE":case"OVERLAY_CLOSED":if(n.overlayId===e)return o(t,n);default:return t}}},n.overlayReady=function(e){return function(t){return t.overlays[e]===s.READY}},n.overlayError=function(e){return function(t){return t.overlays[e]===s.ERROR}},n.ready=function(e){return e.status===s.READY},n.error=function(e){return e.status===s.ERROR},n.loading=function(e){return e.status===s.LOADING},n.visible=function(e){return e.status===s.VISIBLE},n.closed=function(e){return e.status===s.CLOSED}},{"../../../lib/updater":162}],103:[function(e,t,n){"use strict";function r(e,t){return{pageTypes:o(e,t),pageElements:s(e)}}function o(e,t){return e.scraping?g.dict(e.scraping.pageTypes.map(function(e){return{key:e.name,value:i(e.name,e.urlPattern,t,e.pageElements.map(function(e){return e.id}))}})):{}}function i(e,t,n,r){return{name:e,urlPattern:t,active:f(n,t),elementIds:r}}function s(e){var t=e.scraping.pageTypes.map(function(e){return e.pageElements.map(function(t){return{key:t.id.toString(),value:{id:t.id,name:t.name,pageTypeName:e.name,type:t.type,dataType:t.dataType,value:n.PAGE_ELEMENT_VALUE_UNKNOWN}}})});return g.dict(g.flatten(t))}function a(e,t){switch(t.type){case"PAGE_URL_UPDATED":var n=l(e,t);return p(n,e,t);case"PAGE_SCRAPING_SYNC":return y.update(e).set(function(){return t.scraping});case"PAGE_ELEMENT_VALUE_UPDATED":return y.update(e).get("pageElements").get(t.id.toString()).set(function(e){return e?d({},e,{value:c(e.value,t.value)}):e});default:return e}}function u(e){return"string"==typeof e||"number"==typeof e}function c(e,t){var r;return r=u(t)?{type:"known",value:t,disappeared:!1}:null===t?n.PAGE_ELEMENT_VALUE_NONE_MISSING:n.PAGE_ELEMENT_VALUE_UNKNOWN,h.DeepEqual.deepEqual(e,r)?e:null===t&&"known"===e.type?d({},e,{disappeared:!0}):r}function l(e,t){return y.update(e).get("pageTypes").set(g._dictMapValues(function(e){return y.update(e).get("active").set(function(){return f(t.url,e.urlPattern)})}))}function p(e,t,r){return y.update(e).get("pageElements").set(g._dictMapValues(function(r){if("ExternalValue"!==r.type)return r;var o=t.pageTypes[r.pageTypeName].active,i=e.pageTypes[r.pageTypeName].active;return y.update(r).get("value").set(function(e){return o&&i?e:!o&&i?n.PAGE_ELEMENT_VALUE_UNKNOWN:n.PAGE_ELEMENT_VALUE_NONE_INACTIVE})}))}function f(e,t){return null!==t&&0!==t.length&&new RegExp(t).test(e)}var d=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var g=e("@yieldify/gendry-dragonglass"),y=e("../../../lib/updater"),h=e("../../../lib/DeepEqual");n.PAGE_ELEMENT_VALUE_UNKNOWN={type:"unknown"},n.PAGE_ELEMENT_VALUE_NONE_MISSING={type:"none",reason:"missing"},n.PAGE_ELEMENT_VALUE_NONE_INACTIVE={type:"none",reason:"inactive"},n.isKnownValue=function(e){return"known"===e.type},n.initialPageScrapingState=r,n.pageScrapingReducer=a,n.updateValue=c,n.pageScraping=function(e){return e.pageScraping},n.pageTypes=function(e){return e.pageScraping.pageTypes},n.activePageTypes=g.selector(n.pageTypes,function(e){return g.values(e).filter(function(e){return e.active})}),n.pageType=function(e){return function(t){return t.pageScraping.pageTypes[e]}},n.pageElements=function(e){return e.pageScraping.pageElements},n.pageElement=function(e){return function(t){return n.pageElements(t)[e]}},n.pageElementValue=function(e){return g.selector(n.pageElements,function(t){var n=t[e.toString()];if(void 0!==n)return n.value})},n.externalValue=function(e,t){return g.selector(n.pageElements,function(n){return g.find(g.values(n),function(n){return t===n.pageTypeName&&e===n.name&&"ExternalValue"===n.type})})}},{"../../../lib/DeepEqual":144,"../../../lib/updater":162,"@yieldify/gendry-dragonglass":212}],104:[function(e,t,n){"use strict";function r(e,t){return{navigatedAt:t,url:e,views:{minute:null,hour:null,day:null}}}function o(e,t){var n=null;switch(t.actionMeta&&"number"==typeof t.actionMeta.timestamp&&(n=t.actionMeta.timestamp),t.type){case"PAGE_URL_UPDATED":return e.url===t.url?e:i.update(e).set(i.partial(function(e){return{navigatedAt:n,url:t.url,views:{minute:null,hour:null,day:null}}}));case"PAGE_VIEWS_SYNC":case"PAGE_VIEWS_RECEIVED":return t.url!==e.url?e:i.update(e).get("views").set(function(){return{minute:t.minute,hour:t.hour,day:t.day}});default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/updater"),s=e("@yieldify/gendry-dragonglass");n.initialPageState=r,n.pageReducer=o,n.currentPageUrl=function(e){return e.page.url},n.currentPageNavigatedAt=function(e){return e.page.navigatedAt},n.pageViews=function(e){return e.page.views},n.pageViewVariables=s.selector(n.pageViews,function(e){return s.keys(e).map(function(t){var n={name:"pageviews."+t[0],dataType:"Integer",value:e[t]};return n})}),n.pageVariables=s.mapSelector({url:n.currentPageUrl,views:n.pageViews},function(e){var t=e.url,n=e.views,r=s.keys(n).map(function(e){return{name:"page.views."+e,dataType:"Integer",value:n[e]}});return r.concat([{name:"page.url",dataType:"String",value:t}])}),n.pageViewsDatalayerValues=s.selector(n.pageViews,function(e){return{"pageViews/dayInterval":e.day,"pageViews/hourInterval":e.hour,"pageViews/minuteInterval":e.minute}})},{"../../../lib/updater":162,"@yieldify/gendry-dragonglass":212}],105:[function(e,t,n){"use strict";function r(e,t,r,o,s){if(!o){var a=l.first([s.googleAnalytics,s.universalAnalytics,n.STARTING_SESSION_COUNT]);return{lastActivities:[e],sessionCount:a,sessionReferrer:t,currentReferrer:t}}var u=i([e,o.la]),c=o.c+(u?1:0),p=t;return r&&r.count===c&&(p=r.referrer),{lastActivities:[e],sessionCount:c,sessionReferrer:p,currentReferrer:t}}function o(e,t){switch(t.type){case"NEW_SESSION_STARTED":return u({},e,{sessionReferrer:e.currentReferrer,sessionCount:t.sessionCount,lastActivities:[e.lastActivities[0]]});case"TICK":var n=t.timestamp-e.lastActivities[0];return s(n)?c.update(e).get("lastActivities").set(function(e){return a(t.timestamp,e)}):e;default:return e}}function i(e){return!(!e||e.length<2)&&e[0]-e[1]>n.SESSION_CUTOFF}function s(e){return e-n.COOKIE_REFRESH_RATE>0}function a(e,t){return[e,t[0]]}var u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../../lib/updater"),l=e("@yieldify/gendry-dragonglass");n.SESSION_CUTOFF=18e5,n.COOKIE_REFRESH_RATE=6e4,n.STARTING_SESSION_COUNT=1,n.initialSessionState=r,n.sessionReducer=o,n.session=function(e){return e.session},n.sessionCount=l.selector(n.session,function(e){return e.sessionCount}),n.sessionReferrer=l.selector(n.session,function(e){return e.sessionReferrer}),n.currentReferrer=l.selector(n.session,function(e){return e.currentReferrer}),n.lastActivities=l.selector(n.session,function(e){return e.lastActivities}),n.persistentSessionReferrerState=l.selector(n.session,function(e){return{count:e.sessionCount,referrer:e.sessionReferrer}}),n.persistentSessionCountState=l.selector(n.session,function(e){return{c:e.sessionCount,la:e.lastActivities[0]}}),n.isNewSession=i},{"../../../lib/updater":162,"@yieldify/gendry-dragonglass":212}],106:[function(e,t,n){"use strict";function r(e,t,n){if(n){if(e)return s.logger.debug({uuid:e},"Existing tab session detected, using persisted Tab UUID"),e;var r=t();return s.logger.debug({uuid:r},"New tab session detected, generating new Tab UUID"),r}return s.logger.debug(null,"Browser is not session storage capable, so nulling Tab UUID"),null}function o(e,t){return e}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@yieldify/gendry-dragonglass"),s=e("../../../lib/Logger");n.initialTabState=r,n.tabReducer=o,n.tabUUID=function(e){return e.tab},n.thirdPartySessionStorageSerialisedState=i.mapSelector({tabId:n.tabUUID},i.identity)},{"../../../lib/Logger":145,"@yieldify/gendry-dragonglass":212}],107:[function(e,t,n){"use strict";function r(e,t){switch(t.type){case"TICK":return t.timestamp;default:return e}}function o(e,t){return function(){return e.dispatch(i.tick(t.currentTime()))}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../actions/time");n.timeReducer=r,n.time=function(e){return e.time},n.UPDATE_TIME_INTERVAL_MS=1e3,n.updateTime=o},{"../actions/time":88}],108:[function(e,t,n){"use strict";function r(){return{pending:[]}}function o(e,t){switch(t.type){case"TRACKABLE_REQUEST_START":return i.update(e).get("pending").set(s._append(t.requestId));case"TRACKABLE_REQUEST_SUCCESS":case"TRACKABLE_REQUEST_FAIL":return i.update(e).get("pending").set(s._remove(t.requestId));default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/updater"),s=e("@yieldify/gendry-dragonglass");n.initialTrackableState=r,n.trackableReducer=o,n.pendingRequests=function(e){return e.trackable.pending}},{"../../../lib/updater":162,"@yieldify/gendry-dragonglass":212}],109:[function(e,t,n){"use strict";function r(e,t,n,r){t&&t.session===n||(t=void 0);var s={session:n,campaigns:e.campaigns.filter(function(e){return Object.keys(e.urlsVisitedRules).length>0}).reduce(function(e,n){var r=t?t.campaigns[n.id]:void 0;return l({},e,(i={},i[n.id]=o(n.urlsVisitedRules,r),i));var i},{})};return i(s,d.pageUrlUpdated(r))}function o(e,t){var n=y.deepHash(e);return t&&t.rulesHash===n?{rules:e,ruleResults:t.ruleResults}:{rules:e,ruleResults:p.dictMapValues(e,function(e){return a(e)})}}function i(e,t){switch(t.type){case"PAGE_URL_UPDATED":return g.update(e).get("campaigns").set(p._dictMapValues(function(e){return g.update(e).get("ruleResults").set(p._dictMapValues(function(n,r){var o=e.rules[r],i=s(o,f.UrlUtil.canonicalise(t.url));return a(o)?i&&n:i||n}))}));case"NEW_SESSION_STARTED":var n=e.session,r=t.sessionCount;return n===r?e:g.update(e).set(function(){return{session:r,campaigns:g.update(e.campaigns).set(p._dictMapValues(function(e){return o(e.rules,void 0)}))}});default:return e}}function s(e,t){return u(t,e.val,e.op)}function a(e){return/^not/.test(e.op)}function u(e,t,n){switch(n){case"equals":return e===t;case"notEquals":return e!==t;case"contains":return e.indexOf(t)>=0;case"notContains":return e.indexOf(t)<0;case"startsWith":return 0===e.indexOf(t);case"notStartsWith":return 0!==e.indexOf(t);case"in":return t.indexOf(e)>=0;default:throw new Error("Unexpected type of: "+n)}}function c(e){return{rulesHash:y.deepHash(e.rules),ruleResults:e.ruleResults}}var l=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var p=e("@yieldify/gendry-dragonglass"),f=e("../../../lib/browser/UrlUtil"),d=e("../actions/page"),g=e("../../../lib/updater"),y=e("@yieldify/gendry-hash-util"),h="user/hasVisited/";n.initialUrlsVisitedState=r,n.urlsVisitedReducer=i,n.evaluateRule=s;var v=function(e){return e.urlsVisited},m=p.selector(v,function(e){return e.campaigns});n.urlsVisitedDataLayerValues=p.mapSelector({campaigns:m},function(e){var t=e.campaigns,n={};for(var r in t){var o=t[r];for(var i in o.rules){var s=h+i;n[s]=o.ruleResults[i]}}return n}),n.persistentUrlsVisitedState=p.selector(v,function(e){return{session:e.session,campaigns:p.dictMapValues(e.campaigns,c)}})},{"../../../lib/browser/UrlUtil":153,"../../../lib/updater":162,"../actions/page":85,"@yieldify/gendry-dragonglass":212,"@yieldify/gendry-hash-util":227}],110:[function(e,t,n){"use strict";function r(){return{campaigns:{}}}function o(e,t,o){if(e&&e.id){var i=void 0;return i=e.fl?u.fromBitVector(e.fl,n.BIT_VECTOR_KEYS.length):n.BIT_VECTOR_KEYS.map(function(){return!1}),{id:e.id,hasPurchased:i[n.BIT_VECTOR_KEYS.indexOf("hasPurchased")],isLead:i[n.BIT_VECTOR_KEYS.indexOf("isLead")],profile:r(),autoApplyCoupon:t}}return{id:o(),hasPurchased:!1,isLead:!1,profile:r(),autoApplyCoupon:t}}function i(e,t){switch(t.type){case"SALE_DETECTED":return l.update(e).get("hasPurchased").set(function(){return!0});case"FORM_SUBMIT":return l.update(e).get("isLead").set(function(){return!0});case"USER_PROFILE_RECEIVED":return l.update(e).get("profile").get("campaigns").set(function(e){return a({},e,c.dictMapValues(t.profile.campaigns,function(e){return{lastImpression:1e3*e.lastImpression}}))});case"IMPRESSION":return l.update(e).get("profile").get("campaigns").get(String(t.campaignId)).set(function(){return{lastImpression:t.timestamp}});case"COUPON_CODE_SEEN":return t.autoApply?l.update(e).get("autoApplyCoupon").set(function(){return t.code}):e;case"COUPON_CODE_APPLIED":return e.autoApplyCoupon&&e.autoApplyCoupon!==t.code?e:l.update(e).get("autoApplyCoupon").set(function(){});default:return e}}function s(e,t){switch(t.type){case"USER_SYNC":return l.update(e).get("id").set(function(){return t.userId});default:return e}}var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../../lib/utils"),c=e("@yieldify/gendry-dragonglass"),l=e("../../../lib/updater");n.initialUserProfile=r,n.BIT_VECTOR_KEYS=["isLead","hasPurchased"],n.initialUserState=o,n.userReducer=i,n.overlayUserReducer=s,n.user=function(e){return e.user},n.userId=function(e){return e.user.id},n.lastSeenCoupon=function(e){return e.user.autoApplyCoupon},n.persistentUserState=c.selector(n.user,function(e){var t=n.BIT_VECTOR_KEYS.map(function(t){return e[t]});return{id:e.id,fl:u.toBitVector(t)}}),n.userProfile=function(e){return e.user.profile},n.userProfileCampaigns=function(e){return e.user.profile.campaigns}},{"../../../lib/updater":162,"../../../lib/utils":163,"@yieldify/gendry-dragonglass":212}],111:[function(e,t,n){"use strict";function r(e,t){switch(t.type){case"WINDOW_DIMENSIONS_UPDATED":return o.update(e).set(function(){return t.dimensions});default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../lib/updater");n.windowDimensionsReducer=r,n.windowDimensions=function(e){return e.windowDimensions}},{"../../../lib/updater":162}],112:[function(e,t,n){"use strict";function r(e,t){var n=i.domainEntityPropertyValues(e.getState()),r=function(n){var r=s.selector(i.domainEntityPropertyValues,function(e){return e[n]}),u=i.domainEntityProperty(n)(e.getState()),c=u.entity,l=u.property,p=u.persistedValue,f=u.dataType,d=i.DEP_VALUE_UNKNOWN;o.onChange(r,e,function(e){if(!("known"===e.type&&e.value===p&&"unknown"===d.type||"known"!==e.type&&void 0===p&&"unknown"===d.type||a.DeepEqual.deepEqual(e,d))){var n=null;"unknown"!==d.type?n="known"===d.type?d.value:null:void 0!==p&&(n=p),t({entity:c,property:l,previousValue:n,newValue:"known"===e.type?e.value:null,dataType:f}),d=e}})};for(var u in n)r(u)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../utils"),i=e("../reducers/domain-entity-properties"),s=e("@yieldify/gendry-dragonglass"),a=e("../../../lib/DeepEqual");n.domainEntityPropertyUpdateDispatcher=r},{"../../../lib/DeepEqual":144,"../reducers/domain-entity-properties":96,"../utils":123,"@yieldify/gendry-dragonglass":212}],113:[function(e,t,n){"use strict";function r(e){var t=o.domainEntityProperties(e.getState()),n=function(n){var r=t[n];i.onChange(o.domainEntityPropertyValue(r.name),e,function(e){"none"===e.type&&"conflict"===e.reason?s.logger.error({property:r},"Scraped conflicting values for DomainEntityProperty"):"none"===e.type&&"invalid"===e.reason&&s.logger.error({property:r},"Scraped value of incorrect datatype for DomainEntityProperty")})};for(var r in t)n(r)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../reducers/domain-entity-properties"),i=e("../utils"),s=e("../../../lib/Logger");n.domainEntityPropertyUpdateLogger=r},{"../../../lib/Logger":145,"../reducers/domain-entity-properties":96,"../utils":123}],114:[function(e,t,n){"use strict";function r(e,t){var n=a.dynamicCouponListIds(e.getState());if(u.logger.debug({couponListIds:n},"Coupon list ids in config"),n.length>0){var r=i.newDynamicCouponClient(t);l.onChange(f.currentPageUrl,e,function(){u.logger.debug({},"Requesting coupon list availability"),r.couponsAvailable({couponListIds:n}).then(function(t){u.logger.debug({availability:t},"Received coupon availability"),e.dispatch(c.couponAvailabilityReceived(t))},function(e){return u.logger.error({error:e},"Error requesting coupon availability")})})}}function o(e,t){var n=s.find(s.values(p.pageElements(e.getState())),function(e){return"coupon-input"===e.name});if(void 0===n)return Promise.resolve();if("ExternalValue"===n.type)return u.logger.error({couponInputElement:n},"The coupon input element cannot be mapped to an external value"),Promise.resolve();var r=a.pageElementConfig(n.id)(e.getState()),o=s.find(s.values(p.pageElements(e.getState())),function(e){return"coupon-submit"===e.name}),i=void 0===o?void 0:a.pageElementConfig(o.id)(e.getState());if(void 0!==o&&"ExternalValue"===o.type)return u.logger.error({couponSubmitElement:o},"The coupon submit element cannot be mapped to an external value"),Promise.resolve();var f=void 0===i?void 0:i.selector,y=p.pageType("last-price");if(void 0===y(e.getState()))return Promise.resolve();var h=s.mapSelector({input:p.pageElement(n.id),inputPage:y,coupon:d.lastSeenCoupon},s.identity);return new Promise(function(i,s){l.onChange(h,e,function(a){var u=a.input,l=a.inputPage,d=a.coupon;if(l.active&&void 0!==d){var h=u.value;if(p.isKnownValue(h)&&!h.disappeared){var v=r.selector;e.dispatch(c.couponApplied(d)),g({store:e,domClient:t,couponCode:d,lastPricePage:y,inputSelector:v,couponInputElement:n,submitSelector:f,couponSubmitElement:o}).then(i,s)}}},!0)})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@yieldify/gendry-jsonrpc-clients"),s=e("@yieldify/gendry-dragonglass"),a=e("../reducers/config"),u=e("../../../lib/Logger"),c=e("../actions/dynamic-coupons"),l=e("../utils"),p=e("../reducers/page-scraping"),f=e("../reducers/page"),d=e("../reducers/user");n.updateDynamicCouponAvailability=r,n.autoApplyCoupon=o;var g=function(e){var t=e.store,n=e.domClient,r=e.couponCode,o=e.lastPricePage,i=e.inputSelector,a=(e.couponInputElement,e.submitSelector),c=e.couponSubmitElement;return n.getInputValue(i).then(function(e){return""!==e.trim()?Promise.reject(new Error("couldn't auto apply coupon, input already contains a value")):n.setInputValue(i,r)}).then(function(){if(void 0===c)return Promise.resolve();var e=s.mapSelector({submit:p.pageElement(c.id),page:o},s.identity);return new Promise(function(r){var o=!0;l.onChange(e,t,function(e){var t=e.submit,i=e.page;o&&!i.active&&(o=!1,r()),o&&p.isKnownValue(t.value)&&!t.value.disappeared&&(o=!1,n.clickElement(a)["catch"](function(e){u.logger.error({error:e},"Error clicking on autoapply coupon submit button")}).then(r))},!0)})})["catch"](function(e){u.logger.error({error:e},"Error setting autoapply coupon input field")})}},{"../../../lib/Logger":145,"../actions/dynamic-coupons":76,"../reducers/config":94,"../reducers/page":104,"../reducers/page-scraping":103,"../reducers/user":110,"../utils":123,"@yieldify/gendry-dragonglass":212,"@yieldify/gendry-jsonrpc-clients":235}],115:[function(e,t,n){"use strict";function r(e,t){if(!s.geolocationRequired(e.getState()))return void a.logger.debug({},"Geolocation data not required");
var n=o.newGeolocationClient(t);n.getGeolocation({}).then(function(t){"UNKNOWN"===t.country?a.logger.debug({location:t},"Geolocation unknown location"):(a.logger.debug({location:t},"Geolocation data received"),e.dispatch(i.geolocationReceived(t.country)))},function(e){a.logger.error({error:e},"Geolocation error")})}Object.defineProperty(n,"__esModule",{value:!0});var o=e("@yieldify/gendry-jsonrpc-clients"),i=e("../actions/geolocation"),s=e("../reducers/config"),a=e("../../../lib/Logger");n.updateGeolocation=r},{"../../../lib/Logger":145,"../actions/geolocation":79,"../reducers/config":94,"@yieldify/gendry-jsonrpc-clients":235}],116:[function(e,t,n){"use strict";function r(e,t){if(!c.socialProofRequired(e.getState()))return void a.logger.debug({},"Social Proof data not required");var n=s.newSocialProofClient(t);u.onChange(o.currentPageUrl,e,function(t){n.getPageViews({url:t}).then(function(n){a.logger.debug({pageViews:n},"Social Proof data received"),e.dispatch(i.pageViewsReceived(t,n))},function(e){a.logger.error({error:e},"Social Proof error")})})}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../reducers/page"),i=e("../actions/page"),s=e("@yieldify/gendry-jsonrpc-clients"),a=e("../../../lib/Logger"),u=e("../utils"),c=e("../reducers/config");n.updatePageViews=r},{"../../../lib/Logger":145,"../actions/page":85,"../reducers/config":94,"../reducers/page":104,"../utils":123,"@yieldify/gendry-jsonrpc-clients":235}],117:[function(e,t,n){"use strict";function r(e,t,r,o,c){r||(r=0);var l=s.lastImpression(e.getState()),p=a.session(e.getState());return i.logger.debug({lastImpression:l},"Last impression in saleDetector"),null===l?void c(u.saleDetected({collectionId:n.EMPTY_ATTRIBUTE,campaignId:n.EMPTY_ATTRIBUTE,componentId:n.EMPTY_ATTRIBUTE,uuid:t,value:r,currency:o,control:!1})):(i.logger.debug({sessionCount:p.sessionCount,liSessionCount:l.sessionCount},"Session count value in saleDetector"),void c(l.sessionCount===p.sessionCount?u.saleDetected({collectionId:l.collectionId,campaignId:l.campaignId,componentId:l.componentId,uuid:t,value:r,currency:o,control:l.control}):u.saleDetected({collectionId:n.EMPTY_ATTRIBUTE,campaignId:n.EMPTY_ATTRIBUTE,componentId:n.EMPTY_ATTRIBUTE,uuid:t,value:r,currency:o,control:!1})))}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../utils"),i=e("../../../lib/Logger"),s=e("../reducers/last-impression"),a=e("../reducers/session"),u=e("../actions/sale-detected"),c=e("../reducers/domain-entity-properties"),l=e("../reducers/page-scraping"),p=e("@yieldify/gendry-dragonglass");n.EMPTY_ATTRIBUTE=0,n.saleEventDispatcher=function(e,t,n){var s=p.selector(c.domainEntityPropertyVariables,function(e){var t=e["transaction.total"];return"undefined"==typeof t?null:t.value}),a=l.pageType("thankyou");if(!a(e.getState()))return void i.logger.debug({},"No thankyou page available");var u=p.mapSelector({currency:c.transactionCurrency,orderId:c.transactionOrderId,value:s,thankYou:a},function(e){var t=e.currency,n=e.orderId,r=e.value,o=e.thankYou;return{currency:t,orderId:n,value:r,isThankYouPage:o.active}}),f=null;o.onChange(u,e,function(o){o.isThankYouPage?(f||(f=t()),r(e,f,o.value,o.currency,n)):f=null})}},{"../../../lib/Logger":145,"../actions/sale-detected":86,"../reducers/domain-entity-properties":96,"../reducers/last-impression":101,"../reducers/page-scraping":103,"../reducers/session":105,"../utils":123,"@yieldify/gendry-dragonglass":212}],118:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../utils"),o=e("../actions/session"),i=e("../reducers/session");n.watchSession=function(e){r.onChange(i.session,e,n.watchForNewSession(e))},n.watchForNewSession=function(e){return function(t){i.isNewSession(t.lastActivities)&&e.dispatch(o.newSessionStarted(t.sessionCount+1))}}},{"../actions/session":87,"../reducers/session":105,"../utils":123}],119:[function(e,t,n){"use strict";function r(e){var t=new s.Set(i.pendingRequests(e.getState()));return o.waitForState(e,i.pendingRequests,function(e){return 0===t.intersection(new s.Set(e)).size})}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../utils"),i=e("../reducers/trackable"),s=e("../../../lib/Set");n.waitForInFlightTrackables=r},{"../../../lib/Set":150,"../reducers/trackable":108,"../utils":123}],120:[function(e,t,n){"use strict";function r(e){c.onChange(p.userProfile,e,function(e){a.logger.debug({profile:e},"New UserProfile data received")})}function o(e,t){if(!i.userProfileRequired(e.getState()))return void a.logger.debug({},"UserProfile not required");var n=s.newUserProfileClient(t),r=p.user(e.getState()).id;c.onChange(l.currentPageUrl,e,function(){n.getUserProfile({userId:r}).then(function(t){return e.dispatch(u.userProfileReceived(t))},function(e){return a.logger.error({error:e},"UserProfile error")})})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../reducers/config"),s=e("@yieldify/gendry-jsonrpc-clients"),a=e("../../../lib/Logger"),u=e("../actions/user-profile"),c=e("../utils"),l=e("../reducers/page"),p=e("../reducers/user");n.watchUserProfile=r,n.updateUserProfile=o},{"../../../lib/Logger":145,"../actions/user-profile":90,"../reducers/config":94,"../reducers/page":104,"../reducers/user":110,"../utils":123,"@yieldify/gendry-jsonrpc-clients":235}],121:[function(e,t,n){"use strict";function r(e){var t=s.Base64.encode(JSON.stringify(e));return[n.LOCAL_STORAGE_VERSION,t,i(t)].join(":")}function o(e){var t=e.split(":");if(3!==t.length)throw new Error("Malformed raw contents, unable to parse.");var r=t[0],o=t[1],a=t[2];if(!r||r!==n.LOCAL_STORAGE_VERSION)throw new Error("Unexpected version from storage: "+r);var u=i(n.LOCAL_STORAGE_VERSION+":"+o);if(u!==a)throw new Error("Checksum of contents doesn't match calculated checksum");return JSON.parse(s.Base64.decode(o))}function i(e){for(var t=0,n=0;n<e.length;n++)t^=e.charCodeAt(n),t<<=5;return s.Base64.encode(t.toString())}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../lib/Base64");n.LOCAL_STORAGE_VERSION="1",n.connectPersistence=function(e,t,n){var r;e.subscribe(function(){var o=t(e.getState());null!==o&&void 0!==o&&o!==r&&(n(o),r=o)})},n.serialise=r,n.deserialise=o,n.checksum=i},{"../../lib/Base64":140}],122:[function(e,t,n){"use strict";function r(e){var t=e.config,n=e.cookieDomain,r=e.cookieJar,o=e.currentTime,i=e.thirdPartyLocalStorage,s=e.thirdPartySessionStorage,a=e.sandboxConfig,u=e.generateUUID,f=e.deviceType,d=!!s,g=k.thirdPartyLocalStorageInitialState(i,t.websiteId),y=c.thirdPartySessionStorageInitialState(s),h=U.yiCookieInitialState(r,n),v=V.y2CookieInitialState(r,n),b=O.initialSessionState(o,a.referrer,g.session,h.se,p.analyticsSessions(r,o));return{config:m.initialConfigState(t),device:f,page:E.initialPageState(a.location.href,o),pageScraping:D.initialPageScrapingState(t,a.location.href),urlsVisited:I.initialUrlsVisitedState(t,g.urlsVisited,b.sessionCount,a.location.href),domainEntityProperties:L.initialDomainEntityPropertiesState(t,b.sessionCount,g),session:b,overlays:{},labelledLastImpressions:P.initialLabelledLastImpressionsState(t,v.c),time:o,tab:l.initialTabState(y.tabId,u,d),windowDimensions:a.windowDimensions,location:x.initialGeolocationState(),dynamicCoupons:A.initialDynamicCouponsState(),lastImpression:C.initialLastImpressionState(h.li),user:w.initialUserState(h.u,g.lastCoupon,u),trackable:M.initialTrackableState(),lastComponentSubmitted:null}}function o(){return f.combineReducers({config:m.configReducer,device:b.deviceReducer,page:E.pageReducer,pageScraping:D.pageScrapingReducer,domainEntityProperties:L.domainEntityPropertiesReducer,session:O.sessionReducer,overlays:g.overlaysReducer,user:w.userReducer,lastImpression:C.impressionReducer,labelledLastImpressions:P.labelledLastImpressionsReducer,location:x.geolocationReducer,dynamicCoupons:A.dynamicCouponsReducer,urlsVisited:I.urlsVisitedReducer,time:S.timeReducer,tab:l.tabReducer,windowDimensions:j.windowDimensionsReducer,trackable:M.trackableReducer,lastComponentSubmitted:v.lastComponentSubmittedReducer})}function i(e,t){return d.saga(e,t)}function s(e){var t=h.shallowClone(e);return t.actionMeta=u({},t.actionMeta,{relay:{source:y.SANDBOX_SOURCE,senders:[y.SANDBOX_SOURCE]}}),t}function a(e,t){t.dispatch(s(T.pageScrapingSync(D.pageScraping(e)))),t.dispatch(s(_.pageUrlUpdated(E.currentPageUrl(e)))),t.dispatch(s(R.geolocationReceived(x.geolocationCountry(e)))),t.dispatch(s(N.domainEntityPropertiesSync(L.domainEntityProperties(e)))),t.dispatch(s(F.userSync(w.userId(e)))),t.dispatch(s(_.pageViewsSync(E.currentPageUrl(e),E.pageViews(e))))}var u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../storage/thirdPartySessionStorage"),l=e("./reducers/tab"),p=e("../storage/analyticsSessions"),f=e("../../lib/Redux"),d=e("../../lib/saga"),g=e("./reducers/overlay-status"),y=e("./actionRelay"),h=e("@yieldify/gendry-dragonglass"),v=e("./reducers/last-component-submitted"),m=e("./reducers/config"),b=e("./reducers/device"),_=e("./actions/page"),E=e("./reducers/page"),O=e("./reducers/session"),S=e("./reducers/time"),w=e("./reducers/user"),C=e("./reducers/last-impression"),P=e("./reducers/labelled-last-impressions"),I=e("./reducers/urls-visited"),T=e("./actions/page-elements"),R=e("./actions/geolocation"),x=e("./reducers/geolocation"),A=e("./reducers/dynamic-coupons"),M=e("./reducers/trackable"),L=e("./reducers/domain-entity-properties"),N=e("./actions/domain-entity-properties"),D=e("./reducers/page-scraping"),j=e("./reducers/window-dimensions"),k=e("../storage/thirdPartyLocalStorage"),V=e("../storage/y2Cookie"),U=e("../storage/yiCookie"),F=e("./actions/user");n.initialState=r,n.tagReducer=o,n.saga=i,n.replicateDerivedState=a},{"../../lib/Redux":149,"../../lib/saga":161,"../storage/analyticsSessions":124,"../storage/thirdPartyLocalStorage":127,"../storage/thirdPartySessionStorage":128,"../storage/y2Cookie":130,"../storage/yiCookie":131,"./actionRelay":70,"./actions/domain-entity-properties":75,"./actions/geolocation":79,"./actions/page":85,"./actions/page-elements":84,"./actions/user":91,"./reducers/config":94,"./reducers/device":95,"./reducers/domain-entity-properties":96,"./reducers/dynamic-coupons":97,"./reducers/geolocation":98,"./reducers/labelled-last-impressions":99,"./reducers/last-component-submitted":100,"./reducers/last-impression":101,"./reducers/overlay-status":102,"./reducers/page":104,"./reducers/page-scraping":103,"./reducers/session":105,"./reducers/tab":106,"./reducers/time":107,"./reducers/trackable":108,"./reducers/urls-visited":109,"./reducers/user":110,"./reducers/window-dimensions":111,"@yieldify/gendry-dragonglass":212}],123:[function(e,t,n){"use strict";function r(e,t,n){return new Promise(function(r,o){var i=t(e.getState());if(n(i))r(i);else var s=e.subscribe(function(){var o=t(e.getState());n(o)&&(r(o),s())})})}function o(e,t,n,r){void 0===r&&(r=!0);var o=e(t.getState());r&&n(o),t.subscribe(function(){var r=e(t.getState());r!==o&&(o=r,n(o))})}Object.defineProperty(n,"__esModule",{value:!0}),n.waitForState=r,n.onChange=o},{}],124:[function(e,t,n){"use strict";function r(e,t){var r=e[n.GOOGLE_ANALYTICS_COOKIE_KEY]||[],s=e[n.UNIVERSAL_ANALYTICS_COOKIE_KEY]||[];return{googleAnalytics:o(r[0]),universalAnalytics:i(s[0],t)}}function o(e){if(e&&e.content)try{var t=e.content.split(".");if(t.length!==l)return;var n=parseInt(t[0],10),r=parseInt(t[1],10),o=parseInt(t[2],10),i=parseInt(t[3],10),s=parseInt(t[4],10),a=parseInt(t[5],10);if(!(u.isValidNumber(n)&&u.isValidNumber(r)&&u.isValidNumber(o)&&u.isValidNumber(i)&&u.isValidNumber(s)&&u.isValidNumber(a)))return;return a}catch(c){return}}function i(e,t){if(e&&e.content)try{var n=e.content.split(".");if(n.length!==c)return;var r=parseInt(n[1],10),o=parseInt(n[2],10),i=parseInt(n[3],10);if(!u.isValidNumber(r)||!u.isValidNumber(o)||!u.isValidNumber(i))return;return a.isNewSession([t,1e3*i])?s.STARTING_SESSION_COUNT+1:s.STARTING_SESSION_COUNT}catch(l){return}}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../redux/reducers/session"),a=e("../redux/reducers/session"),u=e("../../lib/utils");n.UNIVERSAL_ANALYTICS_COOKIE_KEY="_ga",n.GOOGLE_ANALYTICS_COOKIE_KEY="__utma";var c=4,l=6;n.analyticsSessions=r},{"../../lib/utils":163,"../redux/reducers/session":105}],125:[function(e,t,n){"use strict";function r(e,t,n){try{var r=e[n]||[],o=r.map(function(e){return a(e.content)}),i=u.selectCookie(o,u.calculateDomainDegree(t));return i?JSON.parse(i.data):{}}catch(s){return c.logger.error({error:s},"Error deserialising "+n+" cookie"),{}}}function o(e,t,n,r,o){var a=!1;return function(p){var f={data:JSON.stringify(p),degree:u.calculateDomainDegree(n)};if(t.setCookie({name:e,content:s(f),domain:n||void 0,path:"/"}).then(l.noop,function(t){c.logger.error({error:t},"Error persisting to "+e+" cookie")}),!a){var d=i(e,r,n,o);d.forEach(function(n){t.deleteCookie(e,n).then(l.noop,function(t){c.logger.error({error:t},"Error deleting "+e+" cookie on domain "+n)})}),a=!0}}}function i(e,t,n,r){return l.compact((t[e]||[]).map(function(e){try{return a(e.content).degree}catch(t){return null}})).map(function(e){return e===u.MAX_COOKIE_DEGREE?null:r.split(".").slice(-e).join(".")}).filter(function(e){return e!==n})}function s(e){var t=p.Base64.encode(e.data),r=[n.COOKIE_VERSION,t,f.checksum(t),e.degree].join(":");return r}function a(e){var t=e.split(":");if(t.length<3||t.length>4)throw new Error("Malformed raw contents, unable to parse.");var r=t[0],o=t[1],i=t[2],s=t[3];if(!r||r!==n.COOKIE_VERSION)throw new Error("Unexpected version from storage: "+r);var a=f.checksum(n.COOKIE_VERSION+":"+o);if(a!==i)throw new Error("Checksum of contents doesn't match calculated checksum");return{data:p.Base64.decode(o),degree:u.parseDomainDegree(s)}}Object.defineProperty(n,"__esModule",{value:!0});var u=e("./cookieDomainUtils"),c=e("../../lib/Logger"),l=e("@yieldify/gendry-dragonglass"),p=e("../../lib/Base64"),f=e("../redux/storage");n.COOKIE_VERSION="1",n.cookieInitialState=r,n.persistToCookie=o,n.findRedundantCookieDomains=i,n.serialiseCookieContent=s,n.deserialiseCookieContent=a},{"../../lib/Base64":140,"../../lib/Logger":145,"../redux/storage":121,"./cookieDomainUtils":126,"@yieldify/gendry-dragonglass":212}],126:[function(e,t,n){"use strict";function r(e){return e?e.replace(/^\.+/,"").split(".").length:n.MAX_COOKIE_DEGREE}function o(e){if(!e)return n.MAX_COOKIE_DEGREE;var t=parseInt(e,10);return isNaN(t)?n.MAX_COOKIE_DEGREE:t}function i(e,t){if(0!==e.length){if(e.length<2)return e[0];var n=e.filter(function(e){return e.degree===t})[0];return"undefined"!=typeof n?n:a.sort(e,a._compare(function(e){return e.degree}))[0]}}function s(e,t){if(!t)return null;var n=e.indexOf(t),r=n===e.length-t.length,o=0===n||"."===e[n-1];return n!==-1&&r&&o?t:e}Object.defineProperty(n,"__esModule",{value:!0});var a=e("@yieldify/gendry-dragonglass");n.MAX_COOKIE_DEGREE=99,n.calculateDomainDegree=r,n.parseDomainDegree=o,n.selectCookie=i,n.getCookieDomain=s},{"@yieldify/gendry-dragonglass":212}],127:[function(e,t,n){"use strict";function r(e,t){try{if(!e)return{};var n=e.getItem(t.toString());return n?i.deserialise(n):{}}catch(r){return p.logger.error({error:r},"Error deserialising third party local storage"),{}}}function o(e,t){return function(n){if(e)try{e.setItem(t.toString(),i.serialise(n))}catch(r){p.logger.error({error:r},"Error writing to third party local storage")}}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../redux/storage"),s=e("../redux/reducers/urls-visited"),a=e("../redux/reducers/session"),u=e("../redux/reducers/domain-entity-properties"),c=e("../redux/reducers/user"),l=e("@yieldify/gendry-dragonglass"),p=e("../../lib/Logger");n.thirdPartyLocalStorageInitialState=r,n.thirdPartyLocalStorageSerialisedState=l.mapSelector({urlsVisited:s.persistentUrlsVisitedState,session:a.persistentSessionReferrerState,deps:u.persistentDomainEntityPropertiesState,lastCoupon:c.lastSeenCoupon},l.identity),n.persistToThirdPartyLocalStorage=o},{"../../lib/Logger":145,"../redux/reducers/domain-entity-properties":96,"../redux/reducers/session":105,"../redux/reducers/urls-visited":109,"../redux/reducers/user":110,"../redux/storage":121,"@yieldify/gendry-dragonglass":212}],128:[function(e,t,n){"use strict";function r(e){try{if(!e)return{};var t=e.getItem(a);return t?i.deserialise(t):{}}catch(n){return s.logger.error({error:n},"Error deserialising third party session storage"),{}}}function o(e){return function(t){if(e)try{e.setItem(a,i.serialise(t))}catch(n){s.logger.error({error:n},"Error writing to third party session storage")}}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../redux/storage"),s=e("../../lib/Logger"),a="global";n.thirdPartySessionStorageInitialState=r,n.persistToThirdPartySessionStorage=o},{"../../lib/Logger":145,"../redux/storage":121}],129:[function(e,t,n){"use strict";function r(e){return 1e3*(e+n.YIPOCH)}function o(e){return Math.floor(e/1e3)-n.YIPOCH}Object.defineProperty(n,"__esModule",{value:!0}),n.YIPOCH=1473984e3,n.getRegularTimestamp=r,n.getStorableTimestamp=o},{}],130:[function(e,t,n){"use strict";function r(e,t){return o.cookieInitialState(e,t,n.Y2_COOKIE_NAME)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./cookie"),i=e("@yieldify/gendry-dragonglass"),s=e("../redux/reducers/labelled-last-impressions");n.Y2_COOKIE_NAME="_y2",n.y2CookieInitialState=r,n.y2CookieSerialisedState=i.mapSelector({c:s.persistedLabelledLastImpressionState},i.identity)},{"../redux/reducers/labelled-last-impressions":99,"./cookie":125,"@yieldify/gendry-dragonglass":212}],131:[function(e,t,n){"use strict";function r(e,t){return i.cookieInitialState(e,t,n.YI_COOKIE_NAME)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../redux/reducers/session"),i=e("./cookie"),s=e("../redux/reducers/last-impression"),a=e("../redux/reducers/user"),u=e("@yieldify/gendry-dragonglass");n.YI_COOKIE_NAME="_yi",n.yiCookieSerialisedState=u.mapSelector({li:s.persistentLastImpressionState,se:o.persistentSessionCountState,u:a.persistentUserState},u.identity),n.yiCookieInitialState=r},{"../redux/reducers/last-impression":101,"../redux/reducers/session":105,"../redux/reducers/user":110,"./cookie":125,"@yieldify/gendry-dragonglass":212}],132:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@yieldify/gendry-browser-compat"),o=e("../../lib/Logger"),i=e("../../lib/QueryStringUtil");n.MAX_URL_LENGTH=2083,n.EMITTING_ERROR="Error at emitting the event",n.TOO_BIG_ERROR="Trackable payload is too big";var s=function(){function e(e,t){this.documentLike=e,this.endpoint=t}return e.prototype.sendEvent=function(e){var t=this,s=i.QueryStringUtil.build(e);return new Promise(function(e,i){var a="https://"+t.endpoint+"/i?"+s;if(a.length>n.MAX_URL_LENGTH)return o.logger.error({},n.TOO_BIG_ERROR),void i(new Error(n.TOO_BIG_ERROR));var u=t.documentLike.createElement("img");r.EventTargetUtil.addEventListener(u,"load",e),r.EventTargetUtil.addEventListener(u,"error",function(e){i(new Error(n.EMITTING_ERROR))}),u.src=a})},e}();n.Emitter=s},{"../../lib/Logger":145,"../../lib/QueryStringUtil":147,"@yieldify/gendry-browser-compat":189}],133:[function(e,t,n){"use strict";function r(e,t,r){var f={e:n.EVENT_CATEGORY,ue_px:l.Base64.encode(JSON.stringify(o(r))),tv:n.TRACKER_VERSION,aid:s.websiteId(t),yuid:u.user(t).id,url:a.currentPageUrl(t),dtm:(new Date).getTime(),sc:c.sessionCount(t),trv:e,tuuid:i.tabUUID(t)};return p.logger.debug({payload:f,context:r},"Creating trackable payload"),f}function o(e){return{data:{data:e}}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../redux/reducers/tab"),s=e("../redux/reducers/config"),a=e("../redux/reducers/page"),u=e("../redux/reducers/user"),c=e("../redux/reducers/session"),l=e("../../lib/Base64"),p=e("../../lib/Logger"),f=e("./trackableEvents"),d=e("../redux/actions/trackable");n.EVENT_CATEGORY="ue",n.TRACKER_VERSION="2-0.9.0";var g=function(){function e(e,t,n){this.emitter=e,this.timeProvider=t,this.releaseVersion=n,this.currentEventId=0}return e.prototype.handleAction=function(e,t){var n=f.TRACKABLE_EVENTS[e.type];if(n){this.currentEventId+=1;var r=this.currentEventId;t.dispatch(d.trackableRequestStart(r));var o=this.prepareAction(e,t,n);return this.emitter.sendEvent(o).then(function(){t.dispatch(d.trackableRequestSuccess(r))},function(e){t.dispatch(d.trackableRequestFail(r))})}return null},e.prototype.prepareAction=function(e,t,n){var o=n(e,t.getState(),this.timeProvider),i=r(this.releaseVersion,t.getState(),o);return i},e}();n.EventTracker=g},{"../../lib/Base64":140,"../../lib/Logger":145,"../redux/actions/trackable":89,"../redux/reducers/config":94,"../redux/reducers/page":104,"../redux/reducers/session":105,"../redux/reducers/tab":106,"../redux/reducers/user":110,"./trackableEvents":134}],134:[function(e,t,n){"use strict";function r(e,t,n){var r=u.currentPageNavigatedAt(t),o=null===r?0:n.currentTime()-r;return{et:e,dev:l.deviceType(t),dwell:o,oid:c.organisationId(t),wid:c.websiteId(t)}}function o(e,t,n,o){return s({},r(e,n,o),{cid:t.campaignId,colid:0,comid:0})}function i(e,t,n,r){return s({},o(e,t,n,r),{expid:t.experimentId,expuuid:t.experimentUuid,splid:t.splitId,split:t.experimentSplitType})}var s=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../redux/reducers/domain-entity-properties"),u=e("../redux/reducers/page"),c=e("../redux/reducers/config"),l=e("../redux/reducers/device"),p=e("../redux/reducers/page-scraping"),f=e("../redux/reducers/session"),d=function(e,t,n){var o=p.activePageTypes(t).filter(function(e){return"common"!==e.name}).map(function(e){return e.name}),i=f.currentReferrer(t);return s({},r("PageView",t,n),{dwell:0,ref:i.substring(0,256),pagetype:o})},g=function(e,t,n){return s({},r("Sale",t,n),{value:e.value,currency:a.transactionCurrency(t),cid:e.campaignId,colid:0,comid:0,suuid:e.uuid,iscontrol:e.control,orderId:a.transactionOrderId(t)})},y=function(e,t,n){return s({},o("FormSubmit",e,t,n),{formdata:e.inputValues})},h=function(e,t,n){return i("Impression",e,t,n)},v=function(e,t,n){return i("Click",e,t,n)},m=function(e,t,n){return i("Close",e,t,n)},b=function(e,t,n){return i("BlockedImpression",e,t,n)},_=function(e,t,n){return s({},r("TagLog",t,n),{lvl:e.log.level,msg:e.log.message})},E=function(e,t,n){return r("ExitIntent",t,n)},O=function(e,t,n){return s({},r("DomainEntityPropertyUpdate",t,n),{entity:e.entity,property:e.property,prevval:e.previousValue,newval:e.newValue,type:e.dataType})};n.TRACKABLE_EVENTS={PAGE_URL_UPDATED:d,SALE_DETECTED:g,FORM_SUBMIT:y,IMPRESSION:h,CLICK_THROUGH:v,CLOSE_EVENT:m,BLOCKED_IMPRESSION:b,LOG_MESSAGE:_,EXIT_INTENT:E,DOMAIN_ENTITY_PROPERTY_UPDATED:O}},{"../redux/reducers/config":94,"../redux/reducers/device":95,"../redux/reducers/domain-entity-properties":96,"../redux/reducers/page":104,"../redux/reducers/page-scraping":103,"../redux/reducers/session":105}],135:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable"),i=e("../../lib/Logger"),s=function(e){function t(){var t=e.call(this)||this;return t.state=a.OFF,t}return r(t,e),t.prototype.prepare=function(){this.state===a.OFF&&(i.logger.debug({trigger:this},"Preparing trigger"),this.preparation(),this.state=a.READY)},t.prototype.cancel=function(){this.state===a.READY&&(i.logger.debug({trigger:this},"Cancelling trigger"),this.cancellation(),this.state=a.OFF)},t.prototype.trigger=function(){if(this.state!==a.READY)throw new Error("A trigger can only be triggered when it's in a READY state");this.state=a.TRIGGERED,this.publish(null)},t}(o.Observable);n.Trigger=s;var a;!function(e){e[e.OFF=0]="OFF",e[e.READY=1]="READY",e[e.TRIGGERED=2]="TRIGGERED"}(a=n.TriggerState||(n.TriggerState={}))},{"../../lib/Logger":145,"../../lib/Observable":146}],136:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=function(e){function t(t){var n=e.call(this)||this;return n.exits=t,n}return r(t,e),t.prototype.preparation=function(){var e=this;this.subscription=this.exits.subscribe(function(){e.subscription.dispose(),e.trigger()})},t.prototype.cancellation=function(){this.subscription.dispose()},t}(o.Trigger);n.ExitIntentTrigger=i},{"./Base":135}],137:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./ExitIntentTrigger"),o=e("./TimerTrigger"),i=function(){function e(e){this.exitIntention=e}return e.prototype.create=function(e){switch(e.type){case"Timer":return new o.TimerTrigger(e.settings);case"ExitIntent":return new r.ExitIntentTrigger(this.exitIntention);default:throw new Error("Unknown trigger type")}},e}();n.TriggerFactory=i},{"./ExitIntentTrigger":136,"./TimerTrigger":138}],138:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=function(e){function t(t){var n=e.call(this)||this;return n.timeMs=n.timeToMilliseconds(t.time,t.unit),n}return r(t,e),t.prototype.getTimeoutDuration=function(){return this.timeMs},t.prototype.preparation=function(){var e=this;this.timeout=setTimeout(function(){e.trigger()},this.timeMs)},t.prototype.cancellation=function(){clearTimeout(this.timeout)},t.prototype.timeToMilliseconds=function(e,t){var n={seconds:1e3,minutes:6e4};return e*n[t]},t}(o.Trigger);n.TimerTrigger=i},{"./Base":135}],139:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./Logger"),o=function(){function e(){this.nextCallbackId=0,this.timeoutKey=0,this.timeoutIdMap={}}return e.prototype.performAsyncCallback=function(e,t,n){var r=this,o=++this.timeoutKey;return this.timeoutIdMap[o]=setTimeout(function(){r.executeCallback(o,e,n,n)},t),o},e.prototype.stopCallback=function(e){try{clearTimeout(this.timeoutIdMap[e])}catch(t){r.logger.error({error:t,timeoutKey:e},"Could not stop the callback.")}},e.prototype.cancelPendingCallbacks=function(){this.cancelBeforeId=this.nextCallbackId},e.prototype.executeCallback=function(e,t,n,o){var i=this,s=this.nextCallbackId++;if(!(this.cancelBeforeId&&s<this.cancelBeforeId))try{t()}catch(a){r.logger.error({error:a},"Async callback failed.")}finally{o&&(this.timeoutIdMap[e]=setTimeout(function(){i.executeCallback(e,t,o,o)},n))}},e}();n.AsyncWorker=o},{"./Logger":145}],140:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=function(){function e(){}return e.encode=function(t){var n,o,i,s,a,u,c,l="",p=0;for(t=e.utf8Encode(t);p<t.length;)n=t.charCodeAt(p++),o=t.charCodeAt(p++),i=t.charCodeAt(p++),s=n>>2,a=(3&n)<<4|o>>4,u=(15&o)<<2|i>>6,c=63&i,isNaN(o)?u=c=64:isNaN(i)&&(c=64),l+=r.charAt(s)+r.charAt(a)+r.charAt(u)+r.charAt(c);return l},e.decode=function(t){var n,o,i,s,a,u,c,l="",p=0;if(t.match(/[^A-Za-z0-9\+\/\=]/))throw new Error("Provided string is malformed: "+t);for(;p<t.length;)s=r.indexOf(t.charAt(p++)),a=r.indexOf(t.charAt(p++)),u=r.indexOf(t.charAt(p++)),c=r.indexOf(t.charAt(p++)),n=s<<2|a>>4,o=(15&a)<<4|u>>2,i=(3&u)<<6|c,l+=String.fromCharCode(n),64!==u&&(l+=String.fromCharCode(o)),64!==c&&(l+=String.fromCharCode(i));return l=e.utf8Decode(l)},e.utf8Encode=function(e){for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},e.utf8Decode=function(e){for(var t="",n=0,r=0,o=0,i=0;n<e.length;)r=e.charCodeAt(n),r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(o=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&o),n+=2):(o=e.charCodeAt(n+1),i=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&o)<<6|63&i),n+=3);return t},e}();n.Base64=o},{}],141:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Observable"),i=100,s=function(e){function t(t){void 0===t&&(t=i);var n=e.call(this)||this;return n.buffer=[],n.maxBufferSize=t,n}return r(t,e),t.prototype.publish=function(t){if(0===this.subscribers.length){if(this.buffer.length>=this.maxBufferSize)throw new Error("Max buffered values limit reached");this.buffer.push(t)}else e.prototype.publish.call(this,t)},t.prototype.subscribe=function(t){var n=e.prototype.subscribe.call(this,t);return this.buffer.length>0&&this.flush(),n},t.prototype.flush=function(){var t=this.buffer;this.buffer=[];for(var n=0,r=t;n<r.length;n++){var o=r[n];e.prototype.publish.call(this,o)}},t}(o.Observable);n.BufferingObservable=s},{"./Observable":146}],142:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../lib/Observable"),i=e("../lib/DeepEqual"),s=function(e){function t(){return e.call(this)||this}return r(t,e),t.cache=function(e){var n=new t;return e.subscribe(function(e){n.publishIfChanged(e)}),n},t.prototype.publish=function(t){this.value=t,e.prototype.publish.call(this,t)},t.prototype.publishIfChanged=function(e){return!i.DeepEqual.deepEqual(e,this.getCurrentValue())&&(this.publish(e),!0)},t.prototype.getCurrentValue=function(){return this.value},t.prototype.getValue=function(){var e=this;return new Promise(function(t,n){if("undefined"!=typeof e.value)t(e.value);else var r=e.subscribe(function(e){t(e),r.dispose()})})},t.prototype.toJSON=function(){return{value:this.value}},t}(o.Observable);n.CachingObservable=s},{"../lib/DeepEqual":144,"../lib/Observable":146}],143:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e}();n.Creator=r},{}],144:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.deepEqual=function(t,n){if(null===t||null===n)return t===n;if("undefined"==typeof t||"undefined"==typeof n)return t===n;if(e.isPrimitive(t)||e.isPrimitive(n))return t===n;if(t instanceof Date)return n instanceof Date&&t.getTime()===n.getTime();var r=Object.getOwnPropertyNames(t),o=Object.getOwnPropertyNames(n);if(r.length!==o.length)return!1;r.sort(),o.sort();for(var i=0;i<r.length;i++)if(r[i]!==o[i])return!1;for(var s=0,a=r;s<a.length;s++){
var u=a[s];if(!e.deepEqual(t[u],n[u]))return!1}return!0},e.isPrimitive=function(e){return/boolean|number|string/.test(typeof e)},e}();n.DeepEqual=r},{}],145:[function(e,t,n){"use strict";function r(e){return a.indexOf(e)}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./BufferingObservable"),s=e("@yieldify/gendry-dragonglass");n.Level={DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",FATAL:"FATAL"};var a=["DEBUG","INFO","WARN","ERROR","FATAL"];n.MAX_REMOTE_LOG=20,n.MAX_LOG_PAYLOAD=1500;var u=function(e){function t(){var t=e.call(this)||this;return t.level=n.Level.INFO,t.consoleLogging=!1,t.messageCount=0,t.isRecursing=!1,t}return o(t,e),t.prototype.debug=function(e,t){this.log(n.Level.DEBUG,t,e)},t.prototype.info=function(e,t){this.log(n.Level.INFO,t,e)},t.prototype.warn=function(e,t){this.log(n.Level.WARN,t,e)},t.prototype.error=function(e,t){this.log(n.Level.ERROR,t,e)},t.prototype.fatal=function(e,t){this.log(n.Level.FATAL,t,e)},t.prototype.getLevel=function(){return this.level},t.prototype.setLevel=function(e){this.level=e},t.prototype.enableConsoleLogging=function(){this.consoleLogging=!0},t.prototype.publish=function(t){this.messageCount>=n.MAX_REMOTE_LOG||(e.prototype.publish.call(this,t),this.messageCount++,this.messageCount>=n.MAX_REMOTE_LOG&&(this.consoleLog(n.Level.DEBUG,"Remote log cap reached"),e.prototype.publish.call(this,{level:n.Level.WARN,message:JSON.stringify({msg:"Log message cap reached, log truncated"}),timestamp:(new Date).getTime()})))},t.prototype.log=function(e,t,o){if(!(r(e)<r(this.level))){var i=this.normaliseArgs(o);if(this.consoleLog(e,t,i),this.isRecursing)return void this.consoleLog(n.Level.WARN,"Log message triggered while logging. skipping remote log");this.isRecursing=!0,this.remoteLog(e,t,i),this.isRecursing=!1}},t.prototype.remoteLog=function(e,t,r){t=t||"";var o;try{o=JSON.stringify({msg:t,args:r})}catch(i){return void this.consoleLog(n.Level.WARN,"Couldnt serialise remote log message")}o.length>n.MAX_LOG_PAYLOAD&&(o=JSON.stringify({msg:t.substring(0,n.MAX_LOG_PAYLOAD)}),this.consoleLog(n.Level.WARN,"Log message was truncated before sending remotely")),this.publish({level:e,message:o,timestamp:(new Date).getTime()})},t.prototype.consoleLog=function(e,t,r){if(this.consoleLogging)switch(t+=t.match("\n$")?"":"\n",e){default:case n.Level.DEBUG:console.log(t,r);break;case n.Level.INFO:console.info(t,r);break;case n.Level.WARN:console.warn(t,r);break;case n.Level.ERROR:case n.Level.FATAL:console.error(t,r)}},t.prototype.normaliseArgs=function(e){var t=this;if(e)return s.dictMapValues(e,function(e,n){var r;return r=e instanceof Error?t.serialiseError(e):"undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error?t.serialiseError(e.error):t.serialiseErrorEvent(e):e})},t.prototype.serialiseError=function(e){return{name:e.name,message:e.message,fileName:e.fileName,lineNumber:e.lineNumber,columnNumber:e.columnNumber,stack:e.stack?e.stack.split("\n")[1]:void 0}},t.prototype.serialiseErrorEvent=function(e){return{message:e.message,fileName:e.filename,lineNumber:e.lineno,columnNumber:e.colno}},t}(i.BufferingObservable);n.Logger=u,n.logger=new u},{"./BufferingObservable":141,"@yieldify/gendry-dragonglass":212}],146:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./DeepEqual"),o=function(){function e(){this.subscribers=[],this.publishCount=0}return e.merge=function(t){var n=new e;return t.forEach(function(e){e.subscribe(function(e){n.publish(e)})}),n},e.map=function(t,n){var r=new e;return t.subscribe(function(e){return r.publish(n(e))}),r},e.pluck=function(t,n){return e.map(t,function(e){return e[n]})},e.fromSelector=function(t,n){var r,o=new e;return n.subscribe(function(){var e=t(n.getState());e!==r&&(o.publish(e),r=e)}),o},e.prototype.subscribe=function(e){if(this.subscribers.indexOf(e)!==-1)throw new Error("Cannot subscribe more than once");return this.subscribers.push(e),this.createSubscription(e)},e.prototype.publish=function(e){for(var t=this.subscribers.map(function(e){return e}),n=0;n<t.length;n++)t[n](e);this.publishCount++},e.prototype.filter=function(t){var n=new e,r=this;return this.subscribe(function(e){t(e,r.publishCount,r)&&n.publish(e)}),n},e.prototype.waitFor=function(e){var t=this;return new Promise(function(n){t.subscribe(function(t){r.DeepEqual.deepEqual(t,e)&&n(t)})})},e.prototype.nextValue=function(){var e=this;return new Promise(function(t){var n=e.subscribe(function(e){n.dispose(),t(e)})})},e.prototype.dispatchAs=function(e,t){return this.subscribe(function(n){return t.dispatch(e(n))})},e.prototype.createSubscription=function(e){var t=this;return{dispose:function(){var n=t.subscribers.indexOf(e);n>-1&&t.subscribers.splice(n,1)}}},e}();n.Observable=o},{"./DeepEqual":144}],147:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.build=function(e){var t=new Array;for(var n in e)null!==e[n]?t.push(encodeURIComponent(n)+"="+encodeURIComponent(""+e[n])):t.push(encodeURIComponent(n));return t.join("&")},e.parse=function(e){var t,n;return t={},n=e.split("&").map(function(e){return e.split("=")}),n.forEach(function(e){var n=e[0],r=e[1],o=decodeURIComponent(r);t[decodeURIComponent(n)]="undefined"===o?null:o}),t},e}();n.QueryStringUtil=r},{}],148:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getInteger=function(e){var t=Math.random()*(e+1);return Math.floor(t)},e}();n.RandomSource=r},{}],149:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./redux/createStore");n.createStore=r.createStore;var o=e("./redux/combineReducers");n.combineReducers=o.combineReducers;var i=e("./redux/applyMiddleware");n.applyMiddleware=i.applyMiddleware;var s=e("./redux/reduxDebugEnabledEnhancer");n.reduxDebugEnabledEnhancer=s.reduxDebugEnabledEnhancer},{"./redux/applyMiddleware":157,"./redux/combineReducers":158,"./redux/createStore":159,"./redux/reduxDebugEnabledEnhancer":160}],150:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./DeepEqual"),o=function(){function e(e){this.set=this.unique(e)}return Object.defineProperty(e.prototype,"size",{get:function(){return this.set.length},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this.size},e.prototype.add=function(t){return this.has(t)?this:new e(this.set.concat([t]))},e.prototype["delete"]=function(t){return new e(this.set.filter(function(e){return!r.DeepEqual.deepEqual(t,e)}))},e.prototype.has=function(e){for(var t=0;t<this.size;t++)if(r.DeepEqual.deepEqual(e,this.set[t]))return!0;return!1},e.prototype.values=function(){return this.set.slice()},e.prototype.union=function(t){return new e(t.set.concat(this.set))},e.prototype.intersection=function(t){var n=new e([]);return this.set.forEach(function(e){t.has(e)&&(n=n.add(e))}),n},e.prototype.unique=function(e){function t(e,t){for(var n=0;n<e.length;n++)if(r.DeepEqual.deepEqual(e[n],t))return n;return-1}return e.filter(function(n,r){return t(e,n)===r})},e}();n.Set=o},{"./DeepEqual":144}],151:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../lib/QueryStringUtil");n.YITIME_HASH_PARAMETER="yitime",n.TIME_PROVIDER_THRESHOLD_MS=6e4;var o=function(){function e(e){if(this.offsetMs=0,e){var t=1e3*e-(new Date).getTime();Math.abs(t)>n.TIME_PROVIDER_THRESHOLD_MS&&(this.offsetMs=t)}}return e.parseSeedFromHash=function(e){var t=r.QueryStringUtil.parse(e.substring(1)),o=parseInt(t[n.YITIME_HASH_PARAMETER]||"",10)||0;return o},e.prototype.currentTime=function(){return(new Date).getTime()+this.offsetMs},e}();n.TimeProvider=o},{"../lib/QueryStringUtil":147}],152:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@yieldify/gendry-dragonglass"),o=365,i=864e5,s=function(){function e(){}return e.generateCookieStr=function(t){var n;n=encodeURIComponent(t.content);var r,i=encodeURIComponent(t.name);return r="undefined"!=typeof t.expiration?t.expiration.toUTCString():e.calculateExpiryDate(o).toUTCString(),[i,"=",n,"; expires="+r,t.domain&&"; domain="+t.domain,t.path&&"; path="+t.path,t.httpOnly?"; httpOnly":"",t.secure?"; secure":""].join("")},e.parseCookieStr=function(e){var t=e?e.split("; "):[],n=t.map(function(e){var t=e.split("="),n=t[0],r=t.slice(1).join("=");'"'===r.charAt(0)&&(r=r.slice(1,-1));try{r=decodeURIComponent(r)}catch(o){}return{name:n,content:r}});return r.groupBy(n,function(e){return e.name})},e.calculateExpiryDate=function(e){var t=new Date;return t.setMilliseconds(t.getMilliseconds()+e*i),t},e}();n.CookieUtil=s},{"@yieldify/gendry-dragonglass":212}],153:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.canonicalise=function(e){return encodeURIComponent(decodeURIComponent(this.removeLeadingSlashes(this.removeProtocol(this.trim(this.lower(e))))))},e.trim=function(e){return e.trim()},e.removeProtocol=function(e){return e.replace(/^https?:/,"")},e.removeLeadingSlashes=function(e){return e.replace(/^\/\//,"")},e.lower=function(e){return e.toLowerCase()},e}();n.UrlUtil=r},{}],154:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@yieldify/gendry-browser-compat"),o=e("../Observable"),i=e("../CachingObservable");n.URL_PUBLISH_INTERVAL_MILLISECONDS=500,n.WINDOW_DIMENSION_CHECK_INTERVAL_MILLISECONDS=1e3;var s="complete";n.IS_IOS_11=window.navigator&&"string"==typeof window.navigator.appVersion&&window.navigator.appVersion.indexOf("iPhone OS 11")>=0;var a=function(){function e(e){this.windowLike=e}return e.prototype.listen=function(e){var t=new o.Observable,n=function(e){t.publish(e)};return r.EventTargetUtil.addEventListener(this.windowLike,e,n),t},e.prototype.observeLocation=function(){var e=this;if(!this.locationObservable){this.locationObservable=new i.CachingObservable;var t=function(){e.locationObservable.publishIfChanged(e.getLocation())};setInterval(t,n.URL_PUBLISH_INTERVAL_MILLISECONDS)}return this.locationObservable},e.prototype.getLocation=function(){return{hash:this.windowLike.location.hash,host:this.windowLike.location.host,hostname:this.windowLike.location.hostname,href:this.windowLike.location.href,pathname:this.windowLike.location.pathname,port:this.windowLike.location.port,protocol:this.windowLike.location.protocol,search:this.windowLike.location.search}},e.prototype.getInnerDimensions=function(){var e={height:this.windowLike.innerHeight,width:this.windowLike.innerWidth,deviceScale:this.windowLike.devicePixelRatio||1};return n.IS_IOS_11&&(e._iOS11_top=this.windowLike.scrollY),e},e.prototype.observeInnerDimensions=function(){var e=this;if(!this.dimensionsObservable){this.dimensionsObservable=new i.CachingObservable;var t=function(){e.dimensionsObservable.publishIfChanged(e.getInnerDimensions())};this.listen("resize").subscribe(t),n.IS_IOS_11&&this.listen("scroll").subscribe(t),setInterval(t,n.WINDOW_DIMENSION_CHECK_INTERVAL_MILLISECONDS)}return this.dimensionsObservable},e.prototype.assetsLoaded=function(){var e=this;return new Promise(function(t){e.windowLike.document.readyState===s?t(void 0):e.listen("load").subscribe(function(e){t(void 0)})})},e.prototype.redirect=function(e){this.windowLike.location.href=e},e}();n.WindowUtil=a},{"../CachingObservable":142,"../Observable":146,"@yieldify/gendry-browser-compat":189}],155:[function(e,t,n){"use strict";function r(e){for(var t in e)if(e[t])return!0;return!1}function o(e){var t=e.userAgent,o=r({Android:/Android/i.test(t)&&/mobile|Mobile/i.test(t),BlackBerry:/BlackBerry/i.test(t)||/BB10; Touch/.test(t),iOS:/iPhone|iPod/i.test(t),Opera:/Opera Mini/i.test(t),Windows:/IEMobile/i.test(t)||/webOS/i.test(t)}),i=r({Android:/Android/i.test(t)&&!/mobile|Mobile/i.test(t),iOS:/iPad/i.test(t),Windows:t.toLowerCase().indexOf("windows nt")!==-1&&t.toLowerCase().indexOf("touch")!==-1,Kindle:t.toLowerCase().indexOf("kindle")!==-1||t.toLowerCase().indexOf("silk")!==-1});return o?n.DeviceType.MOBILE:i?n.DeviceType.TABLET:n.DeviceType.DESKTOP}Object.defineProperty(n,"__esModule",{value:!0}),n.DeviceType={MOBILE:"mobile",TABLET:"tablet",DESKTOP:"desktop"},n.detectDeviceType=o},{}],156:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DOMEventType={CLICK:"click",SUBMIT:"submit"}},{}],157:[function(e,t,n){"use strict";function r(e){return 0===e.length?function(e){return e}:1===e.length?e[0]:e.reduce(function(e,t){return function(n){return e(t(n))}})}function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return function(n,o,s){var a=t(n,o,s),u=a.dispatch,c={getState:a.getState,dispatch:function(e){return u(e)}},l=e.map(function(e){return e(c)});return u=r(l)(a.dispatch),i({},a,{dispatch:u})}}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.applyMiddleware=o},{}],158:[function(e,t,n){"use strict";function r(e,t){var n=t&&t.type,r=n&&'"'+n.toString()+'"'||"an action";return"Given action "+r+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function o(e){return function(t,n){void 0===t&&(t={});var o=!1,i={};for(var s in e){var a=e[s],u=t[s],c=a(u,n);if("undefined"==typeof c)throw new Error(r(s,n));i[s]=c,o=o||c!==u}return o?i:t}}Object.defineProperty(n,"__esModule",{value:!0}),n.combineReducers=o},{}],159:[function(e,t,n){"use strict";function r(e,t,o){function s(){g===d&&(g=d.slice())}function a(){return f}function u(e){if("function"!=typeof e)throw new Error("Expected listener to be a function.");var t=!0;return s(),g.push(e),function(){if(t){t=!1,s();var n=g.indexOf(e);g.splice(n,1)}}}function c(e){if(!i(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if("undefined"==typeof e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(y)throw new Error("Reducers may not dispatch actions.");try{y=!0,f=p(f,e)}finally{y=!1}for(var t=d=g,n=0;n<t.length;n++){var r=t[n];r()}return e}if("undefined"!=typeof o){if("function"!=typeof o)throw new Error("Expected the enhancer to be a function.");var l=o(r);return l(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var p=e,f=t,d=[],g=d,y=!1;return c({type:n.ActionTypes.INIT}),{dispatch:c,getState:a,subscribe:u}}function o(e){return null!=e&&"object"==typeof e}function i(e){if(!o(e)||"[object Object]"!==a.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=s.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)===c}Object.defineProperty(n,"__esModule",{value:!0}),n.ActionTypes={INIT:"@@redux/INIT"},n.createStore=r;var s=Object.prototype.hasOwnProperty,a=Object.prototype.toString,u=Function.prototype.toString,c=u.call(Object)},{}],160:[function(e,t,n){"use strict";function r(e){return window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__&&e?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({actionsBlacklist:["TICK"]}):o.identity}Object.defineProperty(n,"__esModule",{value:!0});var o=e("@yieldify/gendry-dragonglass");n.reduxDebugEnabledEnhancer=r},{"@yieldify/gendry-dragonglass":212}],161:[function(e,t,n){"use strict";function r(){function e(e){return n=u.append(n,e),function(){n=u.remove(n,e)}}function t(e){n.forEach(function(t){t(e)})}var n=[];return{subscribe:e,emit:t}}function o(e,t){var n=""+c;return c+=1,{name:e,run:t,id:n}}function i(e){function t(e){if(!o)throw new Error("Can't run a saga before applying the middleware");return n.callSaga(e)}var n,o=!1,i=function(t){var i=r();return n=e({getState:t.getState,dispatch:t.dispatch,actionBus:i,stack:[]}),o=!0,function(e){return function(t){var n=e(t);return i.emit(t),n}}};return{middleware:i,runSaga:t}}function s(e){function t(e){return new Promise(function(t){var n=d.subscribe(function(r){e(r)&&(n(),t(r))})})}function n(e){return new Promise(function(t){f(e),t()})}function r(e){return e(p())}function o(e){return new Promise(function(t){setTimeout(t,e)})}function i(e,t){return void 0!==t?e(t):e()}function u(t){return t.run(s(a({},e,{stack:g.concat([t.name])})))}function c(e,t){return u(e(t))}var l,p=e.getState,f=e.dispatch,d=e.actionBus,g=e.stack;return l={take:t,put:n,select:r,delay:o,call:i,callSaga:u,callSagaWith:c}}var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("@yieldify/gendry-dragonglass"),c=0;n.saga=o,n.sagaMiddlewareFactory=i,n.runtimeInterpreter=s},{"@yieldify/gendry-dragonglass":212}],162:[function(e,t,n){"use strict";function r(e){function t(e,n){function r(r){function o(e,t){return void 0===t&&(t=!1),n(function(n){var o=e(a);return o===a?n:!t&&s.DeepEqual.deepEqual(o,a)?n:i({},n,(u={},u[r]=o,u));var u},!0)}var a=e[r];return{get:t(a,o),set:o}}return r}var n=function(t,n){return void 0===n&&(n=!1),t(e)};return{get:t(e,n),set:n}}function o(e){return function(t){return i({},t,e(t))}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./DeepEqual");n.update=r,n.partial=o},{"./DeepEqual":144}],163:[function(e,t,n){"use strict";function r(e){return"number"==typeof e&&!isNaN(e)}function o(e){h=new RegExp("(^#|.*&)"+m+"($|&.*)").test(e.location.hash)}function i(){h=!1}function s(){return h}function a(e){return h===!1?e:e.indexOf("#")>=0?e+"&"+m:e+"#"+m}function u(e){return e.location.hash?e.location.hash.substring(1):""}function c(e,t){return t?e.indexOf("#")>=0?e+"&"+t:e+"#"+t:e}function l(e){var t={};for(var n in e){if(e[n]in e)throw new Error('Value "'+e[n]+'" is already a key in the lookup table');t[n]=e[n],t[e[n]]=n}return t}function p(e){if(!e||0===e.length)return"";var t=e.reduce(function(e,t){return e+(t===!0?"1":"0")},""),n=parseInt(t,2),r=n.toString(36);return r}function f(e,t){if(""===e){if(0!==t)throw new Error("More bits than expected are encoded");return[]}var n=parseInt(e,36),r=n.toString(2),o=r.split("").map(function(e){return"1"===e}),i=t-o.length;if(isNaN(n))throw new Error("Input not parsable into base 36");if(i<0)throw new Error("More bits than expected are encoded");var s=d(i,!1);return s.concat(o)}function d(e,t){var n=Array.apply(null,Array(e));return n.map(function(){return t})}function g(e){var t=v.map(v.entries(e),function(e){return e.key+":"+e.value});return t.join(";")}function y(e,t,n){return void 0===n&&(n="Promise timed out after "+e+"ms"),Promise.race([t,new Promise(function(t,r){setTimeout(function(){r(new Error(n))},e)})])}Object.defineProperty(n,"__esModule",{value:!0});var h,v=e("@yieldify/gendry-dragonglass"),m="yidebug";n.isValidNumber=r,n.initialiseDebugMode=o,n.resetDebugMode=i,n.isDebugMode=s,n.addDebugParameter=a,n.getHash=u,n.addHashParameters=c,n.createTranslationTable=l,n.toBitVector=p,n.fromBitVector=f,n.generateCssText=g,n.timeout=y},{"@yieldify/gendry-dragonglass":212}],164:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){this.registry=void 0}return e.methodNotImplemented=function(e){return function(){return Promise.reject(new Error(e+" is not implemented by this module"))}},e.prototype.setRegistry=function(e){this.registry=e},e.prototype.invokeMethod=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.validateCall(e),!this.registry)throw new Error("Registry has not been defined");return(r=this.registry).invokeMethod.apply(r,[this.getRoutingLabel(),e].concat(t));var r},e.prototype.invokeStream=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.validateCall(e),!this.registry)throw new Error("Registry has not been defined");return(r=this.registry).invokeStream.apply(r,[this.getRoutingLabel(),e].concat(t));var r},e.prototype.toJSON=function(){return{label:this.getRoutingLabel()}},e.prototype.validateCall=function(e){if("function"!=typeof this["interface"]()[e])throw new Error("Invoked method is not part of the interface")},e}();n.BaseModule=r},{}],165:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){this.modules={}}return e.prototype.register=function(e){var t=e.getRoutingLabel();if(t in this.modules)throw new Error("Cannot register two modules with the same routing label: "+t);this.modules[e.getRoutingLabel()]=e,e.setRegistry(this)},e.prototype.registerAll=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.register(r)}},e.prototype.getModuleByClass=function(e){for(var t in this.modules){var n=this.getModuleByLabel(t);if(n instanceof e)return n}},e.prototype.getModuleByLabel=function(e){return this.modules[e]},e.prototype.toJSON=function(){return{modules:this.modules}},e}();n.ModuleRegistry=r},{}],166:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"cookie"},t.prototype["interface"]=function(){return{getCookie:this.getCookie,getCookies:this.getCookies,setCookie:this.setCookie,deleteCookie:this.deleteCookie}},t}(o.BaseModule);n.CookieBase=i},{"../BaseModule":164}],167:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCookie=function(e){return this.invokeMethod("getCookie",e)},t.prototype.getCookies=function(e){return this.invokeMethod("getCookies",e)},t.prototype.setCookie=function(e){return this.invokeMethod("setCookie",e)},t.prototype.deleteCookie=function(e,t){return this.invokeMethod("deleteCookie",e,t)},t}(o.CookieBase);n.CookieClient=i},{"./Base":166}],168:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"dom"},t.prototype["interface"]=function(){return{draw:this.draw,setStyle:this.setStyle,getStyle:this.getStyle,modifyAttribute:this.modifyAttribute,listen:this.listen,createValueScraper:this.createValueScraper,startScraping:this.startScraping,stopScraping:this.stopScraping,getInputValue:this.getInputValue,setInputValue:this.setInputValue,getCheckedState:this.getCheckedState,clickElement:this.clickElement,getReferrer:this.getReferrer,getBoundingClientRect:this.getBoundingClientRect}},t}(o.BaseModule);n.DOMBase=i},{"../BaseModule":164}],169:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=e("../../../app/model/page/scraper/RemoteValueScraper"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.draw=function(e,t){return this.invokeMethod("draw",e,t.trim())},t.prototype.setStyle=function(e,t,n){return this.invokeMethod("setStyle",e,t,n)},t.prototype.getStyle=function(e,t){return this.invokeMethod("getStyle",e,t)},t.prototype.modifyAttribute=function(e,t,n){return this.invokeMethod("modifyAttribute",e,t,n)},t.prototype.listen=function(e,t,n){return this.invokeStream("listen",e,t,n)},t.prototype.createValueScraper=function(e,t){var n=this;return this.invokeMethod("createValueScraper",e,t).then(function(e){return new i.RemoteValueScraper(e,n)})},t.prototype.startScraping=function(e){return this.invokeStream("startScraping",e)},t.prototype.stopScraping=function(e){return this.invokeMethod("stopScraping",e)},t.prototype.getInputValue=function(e){return this.invokeMethod("getInputValue",e)},t.prototype.setInputValue=function(e,t){return this.invokeMethod("setInputValue",e,t)},t.prototype.getCheckedState=function(e){return this.invokeMethod("getCheckedState",e)},t.prototype.clickElement=function(e){return this.invokeMethod("clickElement",e)},t.prototype.getReferrer=function(){return this.invokeMethod("getReferrer")},t.prototype.getBoundingClientRect=function(e){return this.invokeMethod("getBoundingClientRect",e)},t}(o.DOMBase);n.DOMClient=s},{"../../../app/model/page/scraper/RemoteValueScraper":59,"./Base":168}],170:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule");n.CREATE_IFRAME_METHOD="createIFrame",n.START_PROXYING_METHOD="startProxying",n.SEND_METHOD="send",n.RECEIVE_METHOD="receive";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"iframe"},t}(o.BaseModule);n.IFrameBase=i},{"../BaseModule":164}],171:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../lib/Logger"),i=e("../BaseModule"),s=e("./Base"),a=e("./ProxiedConnection"),u=function(e){function t(){var t=e.call(this)||this;return t.connections={},t}return r(t,e),t.prototype.createIFrame=function(e){var t=this;return this.invokeMethod(s.CREATE_IFRAME_METHOD,e).then(function(e){var n=new a.ProxiedConnection(e,t);return t.connections[e]=n,t.invokeMethod(s.START_PROXYING_METHOD,e),n})},t.prototype.send=function(e,t){return this.invokeMethod(s.SEND_METHOD,e,t)},t.prototype.receive=function(e,t){var n=this.connections[e];return n?(n.receiveProxiedMessage(t),Promise.resolve()):(o.logger.error({connectionId:e,data:t},"Received data for connection with unknown id"),Promise.reject(new Error("Non-existent proxy connection id")))},t.prototype["interface"]=function(){var e=this;return t={},t[s.RECEIVE_METHOD]=function(t,n){return e.receive(t,n)},t[s.SEND_METHOD]=i.BaseModule.methodNotImplemented(s.SEND_METHOD),t[s.CREATE_IFRAME_METHOD]=i.BaseModule.methodNotImplemented(s.CREATE_IFRAME_METHOD),t[s.START_PROXYING_METHOD]=i.BaseModule.methodNotImplemented(s.START_PROXYING_METHOD),t;var t},t}(s.IFrameBase);n.IFrameClient=u},{"../../../lib/Logger":145,"../BaseModule":164,"./Base":170,"./ProxiedConnection":172}],172:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../remote-windows/connection/Connection"),i=function(e){function t(t,n){var r=e.call(this)||this;return r.id=t,r.iframeClient=n,r}return r(t,e),t.prototype.send=function(e){this.iframeClient.send(this.id,e)},t.prototype.receiveProxiedMessage=function(e){this.receivedMessage(e)},t}(o.Connection);n.ProxiedConnection=i},{"../../remote-windows/connection/Connection":183}],173:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"localStorage"},t.prototype["interface"]=function(){return{getItem:this.getItem,setItem:this.setItem,removeItem:this.removeItem}},t}(o.BaseModule);n.LocalStorageBase=i},{"../BaseModule":164}],174:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getItem=function(e){return this.invokeMethod("getItem",e)},t.prototype.setItem=function(e,t){return this.invokeMethod("setItem",e,t)},t.prototype.removeItem=function(e){return this.invokeMethod("removeItem",e)},t}(o.LocalStorageBase);n.LocalStorageClient=i},{"./Base":173}],175:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Client"),i=function(e){function t(t){var n=e.call(this)||this;return n.store=t,n}return r(t,e),t.prototype["interface"]=function(){var e=this;return{dispatch:function(t){return e.receiveAction(t)}}},t.prototype.receiveAction=function(e){return this.store.dispatch(e),Promise.resolve()},t}(o.ReduxStoreClient);n.ReduxStoreAgent=i},{"./Client":176}],176:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){
e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.dispatch=function(e){return this.invokeMethod("dispatch",e)},t.prototype.getRoutingLabel=function(){return"redux-store"},t.prototype["interface"]=function(){return{dispatch:this.dispatch}},t}(o.BaseModule);n.ReduxStoreClient=i},{"../BaseModule":164}],177:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"window"},t.prototype["interface"]=function(){return{listen:this.listen,observeLocation:this.observeLocation,getInnerDimensions:this.getInnerDimensions,observeInnerDimensions:this.observeInnerDimensions,redirect:this.redirect}},t}(o.BaseModule);n.WindowBase=i},{"../BaseModule":164}],178:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.listen=function(e){return this.invokeStream("listen",e)},t.prototype.observeLocation=function(){return this.invokeStream("observeLocation")},t.prototype.getInnerDimensions=function(){return this.invokeMethod("getInnerDimensions")},t.prototype.observeInnerDimensions=function(){return this.invokeStream("observeInnerDimensions")},t.prototype.redirect=function(e){return this.invokeMethod("redirect",e)},t}(o.WindowBase);n.WindowClient=i},{"./Base":177}],179:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./HandshakeMessage"),o=e("./connection/CrossOriginConnection"),i=function(){function e(e){this.source=e}return e.prototype.connect=function(e){var t=new o.CrossOriginConnection(this.source,e),n=t.awaitMessage(r.HandshakeMessage.READY);return e.postMessage(r.HandshakeMessage.CONNECT,o.ORIGIN_WILDCARD),n},e}();n.CrossOriginClient=i},{"./HandshakeMessage":180,"./connection/CrossOriginConnection":184}],180:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HandshakeMessage={CONNECT:"CONNECT",READY:"READY"}},{}],181:[function(e,t,n){"use strict";function r(){var e=null,t=null,n=new Promise(function(n,r){e=n,t=r});return{promise:n,resolve:e,reject:t}}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../lib/Observable"),s=e("../../lib/Logger"),a=e("./RemoteWindowMessage"),u=e("./connection/JSONConnection"),c=e("../modules/ModuleRegistry"),l=function(e){function t(t){var n=e.call(this)||this;return n.responseCallbacks={},n.connection=t,n.messageId=0,n.config=void 0,n.startReceived=!1,n}return o(t,e),t.connect=function(e,n){return void 0===n&&(n={}),function(r){var o=new u.JSONConnection(e,r),i=new t(o);return n.provide&&i.registerAll(n.provide),i.start(n.initConfig)}},t.prototype.start=function(e){var t=this;return new Promise(function(n,r){t.connection.receive(function(e){if(t.startReceived)t.handler(e);else try{t.parseStartMessage(e),n(t)}catch(o){r(o)}}),t.connection.send({id:0,type:a.MessageType.START,target:"-",method:"-",data:e})})},t.prototype.getConfig=function(){return this.config},t.prototype.invokeMethod=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var i=r();return this.invoke.apply(this,[i,e,t].concat(n)),i.promise},t.prototype.invokeStream=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=new i.Observable;return this.invoke.apply(this,[o,e,t].concat(n)),o},t.prototype.toJSON=function(){return{config:this.config}},t.prototype.invoke=function(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var i=this.nextMessageId();this.connection.send({id:i,type:a.MessageType.CALL,target:t,method:n,data:r}),this.responseCallbacks[i]=e},t.prototype.parseStartMessage=function(e){if(e.type!==a.MessageType.START)throw new Error("Received a non-START message while waiting for START");this.startReceived=!0,this.config=e.data},t.prototype.respond=function(e,t){this.connection.send({id:e.id,type:a.MessageType.RESPONSE,target:e.target,method:e.method,data:t})},t.prototype.respondError=function(e,t){this.connection.send({id:e.id,type:a.MessageType.ERROR,target:e.target,method:e.method,data:t.message})},t.prototype.handleCall=function(e){var t=this;this.validateCall(e);var n=this.getModuleByLabel(e.target),r=n["interface"]()[e.method].apply(n,e.data),o=function(n){t.respond(e,n)},a=function(n){s.logger.debug({error:n},"Call resulted in an error"),t.respondError(e,n)};if(r instanceof Promise){var u=r;u.then(o,a)}else if(r instanceof i.Observable){var c=r;c.subscribe(o)}},t.prototype.handleResponse=function(e){this.validateResponse(e);var t=this.responseCallbacks[e.id];if(t instanceof i.Observable){var n=t;n.publish(e.data)}else delete this.responseCallbacks[e.id],t.resolve(e.data)},t.prototype.handleError=function(e){this.validateResponse(e);var t=this.responseCallbacks[e.id];t instanceof i.Observable?s.logger.error({message:e},"Cant pass error message to observable"):(t.reject(new Error(e.data)),delete this.responseCallbacks[e.id])},t.prototype.handler=function(e){if(e.type===a.MessageType.CALL)this.handleCall(e);else if(e.type===a.MessageType.RESPONSE)this.handleResponse(e);else{if(e.type!==a.MessageType.ERROR)throw new Error("Invalid message type");this.handleError(e)}},t.prototype.nextMessageId=function(){return this.messageId+=1},t.prototype.validateCall=function(e){if(!e.id||isNaN(e.id))throw new Error("message does not contain a valid id");if(!e.target)throw new Error("message does not contain a valid target");if(!this.getModuleByLabel(e.target))throw new Error("message does not contain a valid target of: "+e.target);if("function"!=typeof this.getModuleByLabel(e.target)["interface"]()[e.method])throw new Error("method should be a valid function: "+e.method)},t.prototype.validateResponse=function(e){if(!e.id||isNaN(e.id))throw new Error("message does not contain a valid id")},t}(c.ModuleRegistry);n.RemoteWindow=l},{"../../lib/Logger":145,"../../lib/Observable":146,"../modules/ModuleRegistry":165,"./RemoteWindowMessage":182,"./connection/JSONConnection":185}],182:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){e[e.START=0]="START",e[e.CALL=1]="CALL",e[e.RESPONSE=2]="RESPONSE",e[e.ERROR=3]="ERROR"}(r=n.MessageType||(n.MessageType={}))},{}],183:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../lib/BufferingObservable"),o=e("../../../lib/DeepEqual"),i=function(){function e(){this.messages=new r.BufferingObservable}return e.prototype.receive=function(e){return this.messages.subscribe(e)},e.prototype.awaitMessage=function(e){var t=this;return new Promise(function(n,r){var i=t.receive(function(s){o.DeepEqual.deepEqual(e,s)?(n(t),i.dispose()):r(new Error("Unexpected message received: "+s))})})},e.prototype.receivedMessage=function(e){this.messages.publish(e)},e}();n.Connection=i},{"../../../lib/BufferingObservable":141,"../../../lib/DeepEqual":144}],184:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("@yieldify/gendry-browser-compat"),i=e("./Connection"),s=e("../../../lib/Logger");n.ORIGIN_WILDCARD="*",n.MSG_PREFIX="/* yieldify */ ";var a=function(e){function t(t,n){var r=e.call(this)||this;return r.target=n,o.EventTargetUtil.addEventListener(t,"message",function(e){r.messageHandler(e)},!1),r}return r(t,e),t.prototype.send=function(e){var t=n.MSG_PREFIX+e;this.target.postMessage(t,n.ORIGIN_WILDCARD)},t.prototype.messageHandler=function(e){var t,r=e.origin,o=e.data;if(e.source===this.target)if("string"!=typeof o)s.logger.warn({origin:r},"CrossOriginConnection received a message with non-string data"),s.logger.debug({message:o},"Message with non-string data");else{var i=o.slice(0,n.MSG_PREFIX.length);i!==n.MSG_PREFIX?(s.logger.warn({origin:r},"CrossOriginConnection received a message without a prefix"),s.logger.debug({message:o},"Message without a prefix")):(t=o.slice(n.MSG_PREFIX.length),this.receivedMessage(t))}},t}(i.Connection);n.CrossOriginConnection=a},{"../../../lib/Logger":145,"./Connection":183,"@yieldify/gendry-browser-compat":189}],185:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../lib/Logger"),i=e("./Connection"),s=function(e){function t(t,n){var r=e.call(this)||this;return r.json=t,r.underlyingConnection=n,r.underlyingConnection.receive(function(e){r.stringMessageHandler(e)}),r}return r(t,e),t.prototype.send=function(e){this.underlyingConnection.send(this.json.stringify(e))},t.prototype.stringMessageHandler=function(e){var t;try{t=this.json.parse(e)}catch(n){return void o.logger.error({message:e},"Unable to parse received message as JSON")}this.receivedMessage(t)},t}(i.Connection);n.JSONConnection=s},{"../../../lib/Logger":145,"./Connection":183}],186:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){this.eventName="Event",this.eventConstructor=Event,this.eventType="test",this.canBubble=!0,this.cancelBubble=!0,this.isCancelable=!0}return e.prototype.setEventConstructor=function(e,t){return this.eventName=e,this.eventConstructor=t,this},e.prototype.setEventType=function(e){return this.eventType=e,this},e.prototype.setCanBubble=function(e){return this.canBubble=e,this},e.prototype.setIsCancelable=function(e){return this.isCancelable=e,this},e.prototype.initNewEvent=function(){return new this.eventConstructor(this.eventType)},e.prototype.initOldEvent=function(e){e.initEvent(this.eventType,this.canBubble,this.isCancelable)},e.prototype.build=function(){try{return this.initNewEvent()}catch(e){var t=document.createEvent(this.eventName);return this.initOldEvent(t),t}},e}();n.EventBuilder=r},{}],187:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.addEventListener=function(t,n,r,o){if(e.isStandardsEventTarget(t))t.addEventListener(n,r,o);else{if(!e.isMSEventTarget(t))throw new TypeError("object is not an EventTarget");t.attachEvent("on"+n,r)}},e.removeEventListener=function(t,n,r,o){if(e.isStandardsEventTarget(t))t.removeEventListener(n,r,o);else{if(!e.isMSEventTarget(t))throw new TypeError("object is not an EventTarget");t.detachEvent("on"+n,r)}},e.dispatchEvent=function(t,n){if(e.isStandardsEventTarget(t))t.dispatchEvent(n);else{if(!e.isMSEventTarget(t))throw new TypeError("object is not an EventTarget");t.fireEvent(n.type,n)}},e.isStandardsEventTarget=function(e){return"object"==typeof e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener&&"function"==typeof e.dispatchEvent},e.isMSEventTarget=function(e){return"object"==typeof e&&"function"==typeof e.attachEvent&&"function"==typeof e.detachEvent&&"function"==typeof e.fireEvent},e}();n.EventTargetUtil=r},{}],188:[function(e,t,n){"use strict";function r(e){return new s.Promise(function(t,n){var r=new XMLHttpRequest;if(r.open(e.method,e.uri),null!=e.headers)for(var u=0,c=s.keys(e.headers);u<c.length;u++){var l=c[u];r.setRequestHeader(l,e.headers[l])}a.EventTargetUtil.addEventListener(r,"load",o(r,t,n)),a.EventTargetUtil.addEventListener(r,"error",i(r,n)),"POST"===e.method?r.send(e.data):r.send()})}function o(e,t,n){return function(){if(/2\d\d/.test(e.status.toString())){var r=e.responseText;t(r)}else n(new Error(e.statusText))}}function i(e,t){return function(){t(new Error("Network Error"))}}Object.defineProperty(n,"__esModule",{value:!0});var s=e("@yieldify/gendry-dragonglass"),a=e("./EventTargetUtil");n.sendHttpRequest=r},{"./EventTargetUtil":187,"@yieldify/gendry-dragonglass":194}],189:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(e("./EventTargetUtil")),r(e("./EventBuilder")),r(e("./httpUtil"))},{"./EventBuilder":186,"./EventTargetUtil":187,"./httpUtil":188}],190:[function(e,t,n){"use strict";function r(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t}function o(e,t){void 0===t&&(t=n.lastValueWins);for(var r={},o=0,i=e;o<i.length;o++){var s=i[o];void 0!==r[s.key]&&(s=t({key:s.key,value:r[s.key]},s)),r[s.key]=s.value}return r}function i(e){var t=e.map(function(e){var t=e.key,n=e.value;return{key:t,value:[n]}});return o(t,function(e,t){return{key:e.key,value:e.value.concat(t.value)}})}function s(e){var t=[];for(var n in e)for(var r=0,o=e[n];r<o.length;r++){var i=o[r];t.push({key:n,value:i})}return t}function a(e,t){return o(r(e).map(t))}function u(e,t){return a(e,function(e){var n=e.key,r=e.value;return{key:n,value:t(r,n)}})}Object.defineProperty(n,"__esModule",{value:!0}),n.entries=r,n.lastValueWins=function(e,t){return t},n.dict=o,n.multiDict=i,n.multiDictEntries=s,n.dictMap=a,n._dictMap=function(e){return function(t){return a(t,e)}},n.dictMapValues=u,n._dictMapValues=function(e){return function(t){return u(t,e)}}},{}],191:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./function"),o=function(){function e(e){var t=this;if(this.status=i.PENDING,this.queue=[],"function"==typeof e)try{e(function(e){t.resolve(e)},function(e){t.reject(e)})}catch(n){this.reject(n)}}return e.resolve=function(t){return new e(function(n,r){"undefined"==typeof t?n(void 0):t instanceof e?t.then(n,r):n(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.all=function(t){return 0===t.length?e.resolve([]):new e(function(e,n){var r=[],o=0;t.forEach(function(i,s){i.then(function(n){r[s]=n,o+=1,o===t.length&&e(r)},function(e){n(e)})})})},e.race=function(t){return new e(function(e,n){var r=!1;for(var o in t)t[o].then(function(t){r||(r=!0,e(t))},function(e){r||(r=!0,n(e))})})},e.prototype.then=function(t,n){var r={onFulfilled:t,onRejected:n,promise:new e};return this.queue.push(r),this.status===i.FULFILLED?this.resolve(this.resolution):this.status===i.REJECTED&&this.reject(this.error),r.promise},e.prototype["catch"]=function(e){return this.then(r.identity,e)},e.prototype.resolve=function(e){this.status=i.FULFILLED,this.resolution=e;var t=this.queue.shift();try{for(;t;){var n=t.onFulfilled(e);this.resolveValue(n,t),t=this.queue.shift()}}catch(r){setTimeout(function(){return t.promise.reject(r)},0)}},e.prototype.reject=function(e){this.status=i.REJECTED,this.error=e;var t=this.queue.shift();try{for(;t;){if("function"==typeof t.onRejected){var n=t.onRejected(e);this.resolveValue(n,t)}else setTimeout(t.promise.reject.bind(t.promise,e),0);t=this.queue.shift()}}catch(e){setTimeout(function(){return t.promise.reject(e)},0)}},e.prototype.timeout=function(t,n){return void 0===n&&(n="Promise timed out after "+t+"ms"),e.race([this,new e(function(e,r){setTimeout(function(){r(new Error(n))},t)})])},e.prototype.resolveValue=function(t,n){t instanceof e?t.then(function(e){setTimeout(n.promise.resolve.bind(n.promise,e),0)},function(e){setTimeout(n.promise.reject.bind(n.promise,e),0)}):setTimeout(n.promise.resolve.bind(n.promise,t),0)},e}();n.Promise=o;var i;!function(e){e[e.PENDING=0]="PENDING",e[e.REJECTED=1]="REJECTED",e[e.FULFILLED=2]="FULFILLED"}(i||(i={}))},{"./function":193}],192:[function(e,t,n){"use strict";function r(e){return function(t){if(m.isMissing(t))return null;var n=e(t);return m.isMissing(n)?null:n}}function o(e){return function(t){for(var n in t)if(m.isMissing(t[n]))return null;var r=e(t);return m.isMissing(r)?null:r}}function i(e,t,n){var r=b.mapValues(e,t);return v.mapSelector(r,o(n))}function s(e,t,n){var o=e.map(t);return v.selector(a(o),r(n))}function a(e){if(0===e.length)return function(){return[]};var t=e[0],n=a(e.slice(1));return v.mapSelector({head:t,tail:n},o(function(e){var t=e.head,n=e.tail;return[t].concat(n)}))}function u(e){return v.selector(e,r(function(e){var t=Math.max(e,0),n=function(e){return Math.floor(e)===e},r=n(t)?t.toFixed(0):t.toFixed(2);return r}))}function c(e){switch(e.dataType){case"string":return p(e);case"number":return f(e);case"boolean":return d(e);default:throw new Error("Unknown expression data type")}}function l(e){switch(e.dataType){case"string":return p(e);case"number":return u(f(e));default:throw new Error("Unknown expression data type")}}function p(e){switch(e.type){case"variable":return S(e.name);case"string-literal":return function(t){return e.value};case"concat":return s(e.value,l,function(e){return e.join("")});case"if":return g(d(e.condition),p(e.then),p(e["else"]));default:throw new Error("Unknown string expression type")}}function f(e){switch(e.type){case"variable":return w(e.name);case"numeric-literal":return function(t){return e.value};case"arithmetic":return i({lhs:e.lhs,rhs:e.rhs},f,function(e){var t=e.lhs,n=e.rhs;return t-n});case"if":return g(d(e.condition),f(e.then),f(e["else"]));case"add":return i({lhs:e.lhs,rhs:e.rhs},f,function(e){var t=e.lhs,n=e.rhs;return t+n});case"subtract":return i({lhs:e.lhs,rhs:e.rhs},f,function(e){var t=e.lhs,n=e.rhs;return t-n});case"multiply":return i({lhs:e.lhs,rhs:e.rhs},f,function(e){var t=e.lhs,n=e.rhs;return t*n});case"divide":return i({lhs:e.lhs,rhs:e.rhs},f,function(e){var t=e.lhs,n=e.rhs;return 0===n?null:t/n});default:throw new Error("Unknown numeric expression type")}}function d(e){switch(e.type){case"variable":return C(e.name);case"equals":return i({lhs:e.lhs,rhs:e.rhs},c,function(e){var t=e.lhs,n=e.rhs;return t===n});case"not":return i({val:e.value},d,function(e){var t=e.val;return!t});case"not-equals":return i({lhs:e.lhs,rhs:e.rhs},c,function(e){var t=e.lhs,n=e.rhs;return t!==n});case"greater-than":return i({lhs:e.lhs,rhs:e.rhs},c,function(e){var t=e.lhs,n=e.rhs;return t>n});case"less-than":return i({lhs:e.lhs,rhs:e.rhs},c,function(e){var t=e.lhs,n=e.rhs;return t<n});default:throw new Error("Unknown boolean expression type")}}function g(e,t,n){return v.mapSelector({condition:e,thenVal:t,elseVal:n},function(e){var t=e.condition,n=e.thenVal,r=e.elseVal;return m.isMissing(t)?null:t?m.isMissing(n)?null:n:m.isMissing(r)?null:r})}function y(e,t){var n=t.get(e);return n.map(function(e,n){return _.composeLens(t,_.listElement(n))})}function h(e){switch(e.type){case"arithmetic":return[_.property("lhs"),_.property("rhs")];case"add":return[_.property("lhs"),_.property("rhs")];case"subtract":return[_.property("lhs"),_.property("rhs")];case"multiply":return[_.property("lhs"),_.property("rhs")];case"divide":return[_.property("lhs"),_.property("rhs")];case"concat":return y(e,_.property("value"));case"if":return[_.property("condition"),_.property("then"),_.property("else")];case"equals":case"not-equals":return[_.property("lhs"),_.property("rhs")];case"greater-than":case"less-than":return[_.property("lhs"),_.property("rhs")];case"not":return[_.property("value")];case"numeric-literal":case"string-literal":case"variable":return[];default:throw new Error("Traversal not implemented for "+e.type+" expressions")}}Object.defineProperty(n,"__esModule",{value:!0});var v=e("./selector"),m=e("./typeGuards"),b=e("./object"),_=e("./lens"),E=e("./tree"),O=function(e){return function(t){return t[e]}},S=function(e){return v.selector(O(e),r(function(t){if("String"===t.dataType)return t.value;throw new Error("Expected Variable "+e+" to be a String")}))},w=function(e){return v.selector(O(e),r(function(t){if("Float"===t.dataType||"Integer"===t.dataType)return t.value;throw new Error("Expected Variable "+e+" to be a Float or Integer")}))},C=function(e){return v.selector(O(e),r(function(t){if("Boolean"===t.dataType)return t.value;throw new Error("Expected Variable "+e+" to be a Boolean")}))};n.buildExpression=c,n.stringLikeExpression=l,n.stringExpression=p,n.numericExpression=f,n.booleanExpression=d,n.subExpressions=h,n.traverseExpression=E.traverseTree(h)},{"./lens":195,"./object":197,"./selector":198,"./tree":200,"./typeGuards":201}],193:[function(e,t,n){"use strict";function r(e){return e}function o(){}Object.defineProperty(n,"__esModule",{value:!0}),n.identity=r,n.noop=o},{}],194:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(e("./Dictionary")),r(e("./Promise")),r(e("./list")),r(e("./function")),r(e("./object")),r(e("./selector")),r(e("./expression")),r(e("./string")),r(e("./url")),r(e("./uuid")),r(e("./tree")),r(e("./typeGuards")),r(e("./lens"))},{"./Dictionary":190,"./Promise":191,"./expression":192,"./function":193,"./lens":195,"./list":196,"./object":197,"./selector":198,"./string":199,"./tree":200,"./typeGuards":201,"./url":202,"./uuid":203}],195:[function(e,t,n){"use strict";function r(e){return{get:function(t){return t[e]},set:function(t,n){return t[e]===n?t:g({},t,(r={},r[e]=n,r));var r}}}function o(e){return{get:function(t){return t[e]},set:function(t,n){return t[e]===n?t:t.slice(0,e).concat([n],t.slice(e+1))}}}function i(e,t){return{get:function(n){return t.get(e.get(n))},set:function(n,r){return e.set(n,t.set(e.get(n),r))}}}function s(){return{get:function(e){return y.stableStringify(e)},set:function(e,t){return JSON.parse(t)}}}function a(){return{get:function(e){return JSON.parse(e)},set:function(e,t){return y.stableStringify(t)}}}function u(){return{get:function(e){return e},set:function(e,t){return t}}}function c(e,t){return{get:function(n){return e(n)?t:n},set:function(e,t){return t}}}function l(e,t){return e.get(t)}function p(e,t,n){return e.set(n,t)}function f(e,t,n){return p(e,t(l(e,n)),n)}function d(e){return void 0!==e?v().chain(e):v()}var g=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var y=e("@yieldify/gendry-hash-util"),h=e("./typeGuards");n.property=r,n.listElement=o,n.composeLens=i,n.stringify=s,n.parse=a,n.identityLens=u,n.defaultIf=c,n.defaultIfNull=function(e){return c(h.isNull,e)},n.defaultIfUndefined=function(e){return c(h.isUndefined,e)},n.defaultIfMissing=function(e){return c(h.isMissing,e)},n.get=l,n._get=function(e){return function(t){return l(e,t)}},n.set=p,n._set=function(e,t){return function(n){return p(e,t,n)}},n.modify=f,n._modify=function(e,t){return function(n){return f(e,t,n)}};var v=function(){return m(u())},m=function(e){return{chain:function(t){return m(i(e,t))},done:function(){return e}}};n.lens=d},{"./typeGuards":201,"@yieldify/gendry-hash-util":205}],196:[function(e,t,n){"use strict";function r(e){for(var t=[],n=0,r=e;n<r.length;n++)for(var o=r[n],i=0,s=o;i<s.length;i++){var a=s[i];t.push(a)}return t}function o(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];t=i instanceof Array?t.concat(o(i)):t.concat([i])}return t}function i(e){return v(e,H.notMissing)}function s(e,t){return e.map(t)}function a(e){return function(t){return t.map(e)}}function u(e,t){var n=e.indexOf(t);return n===-1?e:(e=e.slice(),e.splice(n,1),e)}function c(e){return function(t){return u(t,e)}}function l(e,t){return f(e,[t])}function p(e){return d([e])}function f(e,t){return e.concat(t)}function d(e){return function(t){return t.concat(e)}}function g(e,t){for(var n=0,r=e.length;n<r&&t(e[n]);)n++;return n}function y(e,t){return e.slice(g(e,t),e.length)}function h(e,t){return e.slice(0,g(e,t))}function v(e,t){return e.filter(t)}function m(e){return function(t){return t.filter(e)}}function b(e,t){if(0!==e.length){var n=y(e,function(e){return!t(e)});return E(n)}}function _(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}function E(e){return e[0]}function O(e){return e.slice(1)}function S(e){return e.length>0?e[e.length-1]:void 0}function w(e){return e.slice(0,e.length-1)}function C(e){return i(e)[0]}function P(e){return 0===e.length}function I(e){return e.slice(0).reverse()}function T(e,t){return e.slice(0,t)}function R(e){return function(t){return T(t,e)}}function x(e,t){for(var n=[],r=0;r<t;r++)n.push(e);return n}function A(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}function M(e,t){return!A(e,function(e){return!t(e)})}function L(e){for(var t=Math.max.apply(Math,e.map(function(e){return e.length})),n=[],r=0;r<t;r++){for(var o=[],i=0,s=e;i<s.length;i++){var a=s[i];o.push(a[r])}n.push(o)}return n}function N(e,t){return G.dict(e.map(function(e){return{key:t(e),value:e}}))}function D(e,t){return G.dict(e.map(function(e){return{key:t(e),value:[e]}}),function(e,t){return{key:e.key,value:e.value.concat(t.value)}})}function j(e,t){return e.slice(0).sort(t)}function k(e){return function(t,n){var r=e(t),o=e(n);return r<o?-1:r>o?1:0}}function V(e,t){return W.values({lowerBound:e,upperBound:t})}function U(e,t){return void 0===t&&(t=F),B.values(N(e,t))}function F(e){var t=Y.stableStringify(e);return void 0===t?"undefined":t}Object.defineProperty(n,"__esModule",{value:!0});var G=e("./Dictionary"),B=e("./object"),Y=e("@yieldify/gendry-hash-util"),H=e("./typeGuards");n.flatten=r,n.deepFlatten=o,n.compact=i,n.map=s,n._map=a,n.remove=u,n._remove=c,n.append=l,n._append=p,n.concat=f,n._concat=d,n.dropWhile=y,n.takeWhile=h,n.filter=v,n._filter=m,n.find=b,n.findIndex=_,n.head=E,n.tail=O,n.last=S,n.init=w,n.first=C,n.isEmpty=P,n.reverse=I,n.take=T,n._take=R,n.repeat=x,n.some=A,n.every=M,n.zip=L,n.indexBy=N,n._indexBy=function(e){return function(t){return N(t,e)}},n.groupBy=D,n._groupBy=function(e){return function(t){return D(t,e)}},n.sort=j,n._sort=function(e){return function(t){return j(t,e)}},n._compare=k;var W={values:function(e){for(var t=[],n=e.lowerBound;n<e.upperBound;n++)t.push(n);return t}};n.range=V,n.distinct=U},{"./Dictionary":190,"./object":197,"./typeGuards":201,"@yieldify/gendry-hash-util":205}],197:[function(e,t,n){"use strict";function r(e){return Object.keys(e)}function o(e){return r(e).map(function(t){return e[t]})}function i(e,t){var n={};return r(e).forEach(function(r){n[r]=t(e[r])}),n}function s(e){return null!==e&&"object"==typeof e?e instanceof Array?e.slice():a({},e):e}var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.keys=r,n.values=o,n.mapValues=i,n._mapValues=function(e){return function(t){return i(t,e)}},n.shallowClone=s},{}],198:[function(e,t,n){"use strict";function r(e,t){return e}function o(e,t){return e===t}function i(e){return function(t,n){if(t===n)return!0;for(var r=h.keys(t).concat(h.keys(n)),o=0,i=r;o<i.length;o++){var s=i[o];if(!e(t[s],n[s]))return!1}return!0}}function s(e){return function(t,n){if(t===n)return!0;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0}}function a(e,t){var n,r,o=function(o){return void 0!==n&&t(o,n)||(r=e(o)),n=o,r};return o}function u(e,t,n,r){var o=0,i=n(function(e){return o++,t(e)},r),s=e(i);return s.resultFunc=t,s.recomputations=function(){return o},s.resetRecomputations=function(){o=0},s}function c(e,t,n,r){return void 0===n&&(n=a),void 0===r&&(r=o),u(function(t){return function(n){return t(e(n))}},t,n,r)}function l(e,t,n,r){return void 0===n&&(n=a),void 0===r&&(r=i(o)),u(function(t){return function(n){var r={};for(var o in e)r[o]=e[o](n);return t(r)}},t,n,r)}function p(e,t,n,r){return void 0===n&&(n=a),void 0===r&&(r=s(o)),u(function(t){return function(n){var r=e.map(function(e){return e(n)});return t(r)}},t,n,r)}function f(e,t){return l({state:function(e){return e},input:e},t,a,function(e,t){return e.input===t.input})}function d(e,t,n,r){void 0===n&&(n=a),void 0===r&&(r=o);var i={};return f(e,function(o){var s=o.state,a=o.input,u={},l=h.keys(i),p=function(o){void 0===i[o]&&(i[o]=c(function(t){return e(t)[o]},t,n,r)),u[o]=i[o](s)};for(var f in a)p(f);for(var d=0,g=l;d<g.length;d++){var f=g[d];void 0===a[f]&&delete i[f]}return u})}function g(e,t){return l({index:e,map:t},function(e){for(var t=e.index,n=e.map,r=[],o=0,i=t;o<i.length;o++){var s=i[o];r.push(n[s])}return r})}function y(e,t){return l({key:e,obj:t},function(e){var t=e.key,n=e.obj;return n[t]})}Object.defineProperty(n,"__esModule",{value:!0});var h=e("./object");n.noopMemoise=r,n.strictEqualityCheck=o,n.objectEqualityCheck=i,n.listEqualityCheck=s,n.defaultMemoise=a,n.memoisedSelector=u,n.selector=c,n.mapSelector=l,n.listSelector=p,n.mapSelectorValues=d,n.materialise=g,n.pluck=y},{"./object":197}],199:[function(e,t,n){"use strict";function r(e,t){return 0===t.indexOf(e)}function o(e,t){return t.length>=e.length&&t.lastIndexOf(e)===t.length-e.length}Object.defineProperty(n,"__esModule",{value:!0}),n.startsWith=r,n._startWith=function(e){return function(t){return r(e,t)}},n.endsWith=o,n._endsWith=function(e){return function(t){return o(e,t)}}},{}],200:[function(e,t,n){"use strict";function r(e,t,n){var o=t.leftToRight,i=t.into,s=t.outOf;e=i(e);var a=n(e);o||a.reverse();for(var u=0;u<a.length;u++){var c=a[u].get(e),l=r(c,t,n);l!==c&&(e=a[u].set(e,l))}return s(e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.traverseTree=function(e){return function(t,n){var i={leftToRight:!0,into:function(e){return e},outOf:function(e){return e}};return r(t,o({},i,n),e)}}},{}],201:[function(e,t,n){"use strict";function r(e){return null===e}function o(e){return void 0===e}function i(e){return null===e||void 0===e}function s(e){return null!==e}function a(e){return void 0!==e}function u(e){return null!==e&&void 0!==e}function c(e){return"string"==typeof e}function l(e){return"number"==typeof e}function p(e){throw new Error("Unexpected value: "+e)}Object.defineProperty(n,"__esModule",{value:!0}),n.isNull=r,n.isUndefined=o,n.isMissing=i,n.notNull=s,n.notUndefined=a,n.notMissing=u,n.isString=c,n.isNumber=l,n.assertNever=p},{}],202:[function(e,t,n){"use strict";function r(e){var t=h.exec(e);if(null===t)throw new Error("Invalid URL");var n=(t[0],t[1],t[2]),r=t[3],i=t[4],s=(t[5],t[6]),a=t[7],u=t[8],c=t[9],l=t[10];if([n,s,u].forEach(function(e){if("string"!=typeof e)throw new Error("Invalid URL")}),"http:"!==n.toLowerCase()&&"https:"!==n.toLowerCase())throw new Error("Only http and https urls supported");
return{protocol:n.slice(0,-1),username:r,password:i,hostname:s,port:a,path:u,query:o(c),fragment:o(l)}}function o(e){if(void 0!==e)return e.substring(1)}function i(e){return p(e)+y(e)+u(e)+f(e)+d(e)+g(e)}function s(e){return""===e?[]:e.split("&").map(function(e){var t=e.split("="),n=decodeURIComponent(t[0]),r=1===t.length?null:decodeURIComponent(t.slice(1).join("="));return{key:n,value:r}})}function a(e){return e.map(function(e){var t=e.key,n=e.value;return null===n?encodeURIComponent(t):encodeURIComponent(t)+"="+encodeURIComponent(n)}).join("&")}function u(e){return void 0!==e.port?e.hostname+":"+e.port:e.hostname}function c(e){return p(e)+u(e)}function l(e){return void 0===e.query?[]:s(e.query)}function p(e){if("http"!==e.protocol&&"https"!==e.protocol)throw new Error("Only http and https protocols are supported");return e.protocol+"://"}function f(e){return e.path}function d(e){return void 0===e.query?"":"?"+e.query}function g(e){return void 0!==e.fragment?"#"+e.fragment:""}function y(e){return void 0!==e.username?(void 0!==e.password?e.username+":"+e.password:e.username)+"@":""}Object.defineProperty(n,"__esModule",{value:!0});var h=/^(?:(?:(([^:\/#\?]+:)?(?:(?:\/\/)(?:(?:(?:([^:@\/#\?]+)(?:\:([^:@\/#\?]*))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((?:\/?(?:[^\/\?#]+\/+)*)(?:[^\?#]*)))?(\?[^#]*)?)(#.*)?/;n.parseUrl=r,n.stringifyUrl=i,n.parseQueryParameters=s,n.stringifyQueryParameters=a,n.getHost=u,n.getOrigin=c,n.getQueryParameters=l},{}],203:[function(e,t,n){"use strict";function r(e){return e&c|l}function o(){return i.replace(s,function(e){var t=Math.random()*u|0,n=e===a?r(t):t;return n.toString(u)})}Object.defineProperty(n,"__esModule",{value:!0});var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",s=/[xy]/g,a="y",u=16,c=3,l=8;n.generateUUID=o},{}],204:[function(e,t,n){"use strict";function r(e){var t=i.stableStringify(e);if(t)return o.murmur32(t,s)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./murmurHash"),i=e("./stableStringify"),s=5297;n.deepHash=r},{"./murmurHash":206,"./stableStringify":207}],205:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(e("./deepHash")),r(e("./murmurHash")),r(e("./stableStringify"))},{"./deepHash":204,"./murmurHash":206,"./stableStringify":207}],206:[function(e,t,n){"use strict";function r(e,t){if("undefined"==typeof e)throw new Error("key must be a valid string");if(t<1)throw new Error("seed must be a positive integer");if(e.split("").some(function(e){return e.charCodeAt(0)>127}))throw new Error("key must be an ascii string");for(var n,r,o=3&e.length,i=e.length-o,s=t,a=3432918353,u=461845907,c=0;c<i;)n=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=(65535&n)*a+(((n>>>16)*a&65535)<<16)&4294967295,n=n<<15|n>>>17,n=(65535&n)*u+(((n>>>16)*u&65535)<<16)&4294967295,s^=n,s=s<<13|s>>>19,r=5*(65535&s)+((5*(s>>>16)&65535)<<16)&4294967295,s=(65535&r)+27492+(((r>>>16)+58964&65535)<<16);switch(n=0,o){case 3:n^=(255&e.charCodeAt(c+2))<<16;case 2:n^=(255&e.charCodeAt(c+1))<<8;case 1:n^=255&e.charCodeAt(c),n=(65535&n)*a+(((n>>>16)*a&65535)<<16)&4294967295,n=n<<15|n>>>17,n=(65535&n)*u+(((n>>>16)*u&65535)<<16)&4294967295,s^=n}return s^=e.length,s^=s>>>16,s=2246822507*(65535&s)+((2246822507*(s>>>16)&65535)<<16)&4294967295,s^=s>>>13,s=3266489909*(65535&s)+((3266489909*(s>>>16)&65535)<<16)&4294967295,s^=s>>>16,s>>>0}Object.defineProperty(n,"__esModule",{value:!0}),n.MURMUR_32_MAX_VALUE=4294967295,n.murmur32=r},{}],207:[function(e,t,n){"use strict";function r(e,t){if(void 0===t&&(t=[]),e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),"undefined"!=typeof e){if(null===e)return"null";if("object"!=typeof e)return JSON.stringify(e);if(t.indexOf(e)!==-1)throw new TypeError("Converting circular structure to JSON");try{if(t.push(e),o(e)){var n=e.map(function(e){var n=r(e,t)||"null";return n});return"["+n.join(",")+"]"}for(var i=Object.keys(e).sort(),s=[],a=0;a<i.length;a++){var u=i[a],c=r(e[u],t);c&&s.push(JSON.stringify(u)+":"+c)}return"{"+s.join(",")+"}"}finally{t.pop()}}}function o(e){return Array.isArray(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.stableStringify=r},{}],208:[function(e,t,n){arguments[4][190][0].apply(n,arguments)},{dup:190}],209:[function(e,t,n){arguments[4][191][0].apply(n,arguments)},{"./function":211,dup:191}],210:[function(e,t,n){"use strict";function r(e){return function(t){if(m.isMissing(t))return null;var n=e(t);return m.isMissing(n)?null:n}}function o(e){return function(t){for(var n in t)if(m.isMissing(t[n]))return null;var r=e(t);return m.isMissing(r)?null:r}}function i(e,t,n){var r=b.mapValues(e,t);return v.mapSelector(r,o(n))}function s(e,t,n){var o=e.map(t);return v.selector(a(o),r(n))}function a(e){if(0===e.length)return function(){return[]};var t=e[0],n=a(e.slice(1));return v.mapSelector({head:t,tail:n},o(function(e){var t=e.head,n=e.tail;return[t].concat(n)}))}function u(e){return v.selector(e,r(function(e){var t=Math.max(e,0),n=function(e){return Math.floor(e)===e},r=n(t)?t.toFixed(0):t.toFixed(2);return r}))}function c(e){switch(e.dataType){case"string":return p(e);case"number":return f(e);case"boolean":return d(e);default:throw new Error("Unknown expression data type")}}function l(e){switch(e.dataType){case"string":return p(e);case"number":return u(f(e));default:throw new Error("Unknown expression data type")}}function p(e){switch(e.type){case"variable":return w(e.name);case"string-literal":return function(t){return e.value};case"concat":return s(e.value,l,function(e){return e.join("")});case"if":return g(d(e.condition),p(e.then),p(e["else"]));default:throw new Error("Unknown string expression type")}}function f(e){switch(e.type){case"variable":return C(e.name);case"numeric-literal":return function(t){return e.value};case"arithmetic":return i({lhs:e.lhs,rhs:e.rhs},f,function(e){var t=e.lhs,n=e.rhs;return t-n});case"if":return g(d(e.condition),f(e.then),f(e["else"]));case"add":return i({lhs:e.lhs,rhs:e.rhs},f,function(e){var t=e.lhs,n=e.rhs;return t+n});case"subtract":return i({lhs:e.lhs,rhs:e.rhs},f,function(e){var t=e.lhs,n=e.rhs;return t-n});case"multiply":return i({lhs:e.lhs,rhs:e.rhs},f,function(e){var t=e.lhs,n=e.rhs;return t*n});case"divide":return i({lhs:e.lhs,rhs:e.rhs},f,function(e){var t=e.lhs,n=e.rhs;return 0===n?null:t/n});case"max":return s(e.values,f,function(e){return 0===e.length?null:Math.max.apply(Math,e)});case"min":return s(e.values,f,function(e){return 0===e.length?null:Math.min.apply(Math,e)});default:throw new Error("Unknown numeric expression type")}}function d(e){switch(e.type){case"variable":return P(e.name);case"equals":return i({lhs:e.lhs,rhs:e.rhs},c,function(e){var t=e.lhs,n=e.rhs;return t===n});case"not":return i({val:e.value},d,function(e){var t=e.val;return!t});case"not-equals":return i({lhs:e.lhs,rhs:e.rhs},c,function(e){var t=e.lhs,n=e.rhs;return t!==n});case"greater-than":return i({lhs:e.lhs,rhs:e.rhs},c,function(e){var t=e.lhs,n=e.rhs;return t>n});case"less-than":return i({lhs:e.lhs,rhs:e.rhs},c,function(e){var t=e.lhs,n=e.rhs;return t<n});case"contains":return i({str:e.string,query:e.query},p,function(e){var t=e.str,n=e.query;return _.stringContains(n,t)});case"starts-with":return i({str:e.string,query:e.query},p,function(e){var t=e.str,n=e.query;return _.startsWith(n,t)});default:throw new Error("Unknown boolean expression type")}}function g(e,t,n){return v.mapSelector({condition:e,thenVal:t,elseVal:n},function(e){var t=e.condition,n=e.thenVal,r=e.elseVal;return m.isMissing(t)?null:t?m.isMissing(n)?null:n:m.isMissing(r)?null:r})}function y(e,t){var n=t.get(e);return n.map(function(e,n){return E.composeLens(t,E.listElement(n))})}function h(e){switch(e.type){case"arithmetic":return[E.property("lhs"),E.property("rhs")];case"add":return[E.property("lhs"),E.property("rhs")];case"subtract":return[E.property("lhs"),E.property("rhs")];case"multiply":return[E.property("lhs"),E.property("rhs")];case"divide":return[E.property("lhs"),E.property("rhs")];case"concat":return y(e,E.property("value"));case"if":return[E.property("condition"),E.property("then"),E.property("else")];case"contains":case"starts-with":return[E.property("query"),E.property("string")];case"equals":case"not-equals":return[E.property("lhs"),E.property("rhs")];case"greater-than":case"less-than":return[E.property("lhs"),E.property("rhs")];case"not":return[E.property("value")];case"min":case"max":return y(e,E.property("values"));case"numeric-literal":case"string-literal":case"variable":return[];default:throw new Error("Traversal not implemented for "+e.type+" expressions")}}Object.defineProperty(n,"__esModule",{value:!0});var v=e("./selector"),m=e("./typeGuards"),b=e("./object"),_=e("./string"),E=e("./lens"),O=e("./tree"),S=function(e){return function(t){return t[e]}},w=function(e){return v.selector(S(e),r(function(t){if("String"===t.dataType)return t.value;throw new Error("Expected Variable "+e+" to be a String")}))},C=function(e){return v.selector(S(e),r(function(t){if("Float"===t.dataType||"Integer"===t.dataType)return t.value;throw new Error("Expected Variable "+e+" to be a Float or Integer")}))},P=function(e){return v.selector(S(e),r(function(t){if("Boolean"===t.dataType)return t.value;throw new Error("Expected Variable "+e+" to be a Boolean")}))};n.buildExpression=c,n.stringLikeExpression=l,n.stringExpression=p,n.numericExpression=f,n.booleanExpression=d,n.subExpressions=h,n.traverseExpression=O.traverseTree(h)},{"./lens":213,"./object":215,"./selector":216,"./string":217,"./tree":218,"./typeGuards":219}],211:[function(e,t,n){arguments[4][193][0].apply(n,arguments)},{dup:193}],212:[function(e,t,n){arguments[4][194][0].apply(n,arguments)},{"./Dictionary":208,"./Promise":209,"./expression":210,"./function":211,"./lens":213,"./list":214,"./object":215,"./selector":216,"./string":217,"./tree":218,"./typeGuards":219,"./url":220,"./uuid":221,dup:194}],213:[function(e,t,n){arguments[4][195][0].apply(n,arguments)},{"./typeGuards":219,"@yieldify/gendry-hash-util":223,dup:195}],214:[function(e,t,n){arguments[4][196][0].apply(n,arguments)},{"./Dictionary":208,"./object":215,"./typeGuards":219,"@yieldify/gendry-hash-util":223,dup:196}],215:[function(e,t,n){arguments[4][197][0].apply(n,arguments)},{dup:197}],216:[function(e,t,n){arguments[4][198][0].apply(n,arguments)},{"./object":215,dup:198}],217:[function(e,t,n){"use strict";function r(e,t){return 0===t.indexOf(e)}function o(e,t){return t.length>=e.length&&t.lastIndexOf(e)===t.length-e.length}function i(e,t){return t.indexOf(e)!==-1}Object.defineProperty(n,"__esModule",{value:!0}),n.startsWith=r,n._startWith=function(e){return function(t){return r(e,t)}},n.endsWith=o,n._endsWith=function(e){return function(t){return o(e,t)}},n.stringContains=i,n._stringContains=function(e){return function(t){return i(e,t)}}},{}],218:[function(e,t,n){arguments[4][200][0].apply(n,arguments)},{dup:200}],219:[function(e,t,n){arguments[4][201][0].apply(n,arguments)},{dup:201}],220:[function(e,t,n){arguments[4][202][0].apply(n,arguments)},{dup:202}],221:[function(e,t,n){arguments[4][203][0].apply(n,arguments)},{dup:203}],222:[function(e,t,n){arguments[4][204][0].apply(n,arguments)},{"./murmurHash":224,"./stableStringify":225,dup:204}],223:[function(e,t,n){arguments[4][205][0].apply(n,arguments)},{"./deepHash":222,"./murmurHash":224,"./stableStringify":225,dup:205}],224:[function(e,t,n){arguments[4][206][0].apply(n,arguments)},{dup:206}],225:[function(e,t,n){arguments[4][207][0].apply(n,arguments)},{dup:207}],226:[function(e,t,n){arguments[4][204][0].apply(n,arguments)},{"./murmurHash":228,"./stableStringify":229,dup:204}],227:[function(e,t,n){arguments[4][205][0].apply(n,arguments)},{"./deepHash":226,"./murmurHash":228,"./stableStringify":229,dup:205}],228:[function(e,t,n){arguments[4][206][0].apply(n,arguments)},{dup:206}],229:[function(e,t,n){"use strict";function r(e,t){if(void 0===t&&(t=[]),e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),"undefined"!=typeof e){if(null===e)return"null";if("object"!=typeof e)return JSON.stringify(e);if(t.indexOf(e)!==-1)throw new TypeError("Converting circular structure to JSON");if(t.push(e),o(e)){var n=e.map(function(e){var n=r(e,t)||"null";return n});return"["+n.join(",")+"]"}for(var i=Object.keys(e).sort(),s=[],a=0;a<i.length;a++){var u=i[a],c=r(e[u],t);c&&s.push(JSON.stringify(u)+":"+c)}return t.splice(t.indexOf(e),1),"{"+s.join(",")+"}"}}function o(e){return Array.isArray(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.stableStringify=r},{}],230:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="dynamic-coupon";n.newDynamicCouponClient=function(e){return{getCoupon:function(t){return e(r,"getCoupon",t)},couponsAvailable:function(t){return e(r,"couponsAvailable",t)},couponListStatus:function(t){return e(r,"couponListStatus",t)}}}},{}],231:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="geolocation";n.newGeolocationClient=function(e){return{getGeolocation:function(t){return e(r,"getGeolocation",t)},getGeolocationByIp:function(t){return e(r,"getGeolocationByIp",t)}}}},{}],232:[function(e,t,n){"use strict";function r(e,t){return e+"/"+t+"/rpc"}function o(e,t,n){var r={_metadata:{ts:Math.floor(Date.now()/1e3),version:t.version}};return{id:t.uuidGenerator(),jsonrpc:"2.0",method:e,params:i({},n,r)}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("@yieldify/gendry-dragonglass");n.newJsonRpcClient=function(e){return function(t,n,i){try{return e.send({method:"POST",data:JSON.stringify(o(n,e,i)),uri:r(e.gatewayEndpoint,t),headers:e.headers}).then(function(e){var t=JSON.parse(e),n=t,r=t;if(n.result)return n.result;throw new Error(JSON.stringify(r.error))})}catch(a){return s.Promise.reject(a)}}}},{"@yieldify/gendry-dragonglass":240}],233:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="socialproof";n.newSocialProofClient=function(e){return{getPageViews:function(t){return e(r,"getPageViews",t)}}}},{}],234:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="profile";n.newUserProfileClient=function(e){return{getUserProfile:function(t){return e(r,"getUserProfile",t)}}}},{}],235:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(e("./clients/JsonRpcClient")),r(e("./clients/DynamicCouponClient")),r(e("./clients/GeolocationClient")),r(e("./clients/SocialProofClient")),r(e("./clients/UserProfileClient"))},{"./clients/DynamicCouponClient":230,"./clients/GeolocationClient":231,"./clients/JsonRpcClient":232,"./clients/SocialProofClient":233,"./clients/UserProfileClient":234}],236:[function(e,t,n){arguments[4][190][0].apply(n,arguments)},{dup:190}],237:[function(e,t,n){arguments[4][191][0].apply(n,arguments)},{"./function":239,dup:191}],238:[function(e,t,n){arguments[4][192][0].apply(n,arguments)},{"./lens":241,"./object":243,"./selector":244,"./tree":246,"./typeGuards":247,dup:192}],239:[function(e,t,n){arguments[4][193][0].apply(n,arguments)},{dup:193}],240:[function(e,t,n){arguments[4][194][0].apply(n,arguments)},{"./Dictionary":236,"./Promise":237,"./expression":238,"./function":239,"./lens":241,"./list":242,"./object":243,"./selector":244,"./string":245,"./tree":246,"./typeGuards":247,"./url":248,"./uuid":249,dup:194}],241:[function(e,t,n){arguments[4][195][0].apply(n,arguments)},{"./typeGuards":247,"@yieldify/gendry-hash-util":251,dup:195}],242:[function(e,t,n){arguments[4][196][0].apply(n,arguments)},{"./Dictionary":236,"./object":243,"./typeGuards":247,"@yieldify/gendry-hash-util":251,dup:196}],243:[function(e,t,n){arguments[4][197][0].apply(n,arguments)},{dup:197}],244:[function(e,t,n){arguments[4][198][0].apply(n,arguments)},{"./object":243,dup:198}],245:[function(e,t,n){arguments[4][199][0].apply(n,arguments)},{dup:199}],246:[function(e,t,n){arguments[4][200][0].apply(n,arguments)},{dup:200}],247:[function(e,t,n){arguments[4][201][0].apply(n,arguments)},{dup:201}],248:[function(e,t,n){arguments[4][202][0].apply(n,arguments)},{dup:202}],249:[function(e,t,n){arguments[4][203][0].apply(n,arguments)},{dup:203}],250:[function(e,t,n){arguments[4][204][0].apply(n,arguments)},{"./murmurHash":252,"./stableStringify":253,dup:204}],251:[function(e,t,n){arguments[4][205][0].apply(n,arguments)},{"./deepHash":250,"./murmurHash":252,"./stableStringify":253,dup:205}],252:[function(e,t,n){arguments[4][206][0].apply(n,arguments)},{dup:206}],253:[function(e,t,n){arguments[4][207][0].apply(n,arguments)},{dup:207}],254:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(e("./validation-reg-exp"))},{"./validation-reg-exp":255}],255:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EMAIL_REGEXP=/^[a-zA-Z0-9$!#%&'*+\/=?^_`{|}~-]+(?:\.[a-zA-Z0-9$!#%&'*+\/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/},{}]},{},[32]);}()},{"../lib/Promise":2}],2:[function(e,t,n){/*
 * The MIT License (MIT) applies to:
 *   promise-polyfill, Copyright (c) 2014 Taylor Hakes, Forbes Lindesay
 * -----------------------------------------------------------------------
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
;var r=function f(){function noop(){}function bind(e,t){return function(){e.apply(t,arguments)}}function Promise(e){if(!(this instanceof Promise))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(e,this)}function handle(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void Promise._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null===n)return void(1===e._state?resolve:reject)(t.promise,e._value);var r;try{r=n(e._value)}catch(o){return void reject(t.promise,o)}resolve(t.promise,r)}))}function resolve(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof Promise)return e._state=3,e._value=t,void finale(e);if("function"==typeof n)return void doResolve(bind(n,t),e)}e._state=1,e._value=t,finale(e)}catch(r){reject(e,r)}}function reject(e,t){e._state=2,e._value=t,finale(e)}function finale(e){for(var t=0,n=e._deferreds.length;t<n;t++)handle(e,e._deferreds[t]);e._deferreds=null}function Handler(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function doResolve(e,t){var n=!1;try{e(function(e){n||(n=!0,resolve(t,e))},function(e){n||(n=!0,reject(t,e))})}catch(r){if(n)return;n=!0,reject(t,r)}}var e=setTimeout;return Promise.prototype["catch"]=function(e){return this.then(null,e)},Promise.prototype.then=function(e,t){var n=new this.constructor(noop);return handle(this,new Handler(e,t,n)),n},Promise.prototype["finally"]=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})},Promise.all=function(e){return new Promise(function(t,n){function res(e,i){try{if(i&&("object"==typeof i||"function"==typeof i)){var u=i.then;if("function"==typeof u)return void u.call(i,function(t){res(e,t)},n)}r[e]=i,0===--o&&t(r)}catch(f){n(f)}}if(!e||"undefined"==typeof e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return t([]);for(var o=r.length,i=0;i<r.length;i++)res(i,r[i])})},Promise.resolve=function(e){return e&&"object"==typeof e&&e.constructor===Promise?e:new Promise(function(t){t(e)})},Promise.reject=function(e){return new Promise(function(t,n){n(e)})},Promise.race=function(e){return new Promise(function(t,n){for(var r=0,o=e.length;r<o;r++)e[r].then(t,n)})},Promise._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(t){e(t,0)},Promise}();
window/* ---------------------End of MIT licensed code------------------------ */
,t.exports=r},{}]},{},[1]);</script></body></html>